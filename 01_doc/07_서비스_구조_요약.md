# ì„œë¹„ìŠ¤ êµ¬ì¡° ë° ì—­í•  ìš”ì•½ (Condensed Service Structure)

**ìµœì¢… ìˆ˜ì •ì¼**: 2025-12-30
**ë²„ì „**: v2.1
**ëª©ì **: ë³µì¡í•œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ êµ¬ì¡°ë¥¼ ì—­í• (Role) ì¤‘ì‹¬ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ ìš”ì•½.

---

## 1. í”„ë¡ íŠ¸ì—”ë“œ ì„œë¹„ìŠ¤ (Frontend Services)

| ì„œë¹„ìŠ¤ëª… | ê¸°ìˆ  ìŠ¤íƒ | ë°°í¬ ë°©ì‹ | ì—­í•  ë° íŠ¹ì§• |
| :--- | :--- | :--- | :--- |
| **Main Dashboard** | React (SPA) | Nginx Static Serving (`/var/www/react-main`) | ì‚¬ìš©ì ë©”ì¸ ì¸í„°í˜ì´ìŠ¤, í™˜ì ê´€ë¦¬, AI ê²°ê³¼ ì¡°íšŒ |
| **PACS Viewer** | **Custom OHIF v3** | Nginx Static Serving (`/var/www/ohif-dist`) | **HTJ2K WASM ë””ì½”ë”©** íƒ‘ì¬, AI ê²°ê³¼ ì‹œê°í™” íŒ¨ë„ í¬í•¨, **ë³„ë„ ë¹Œë“œ** (Multi-SPA ì „ëµ) |

**í•µì‹¬ ë³€ê²½ (v2.1)**: React Mainê³¼ OHIF Viewerë¥¼ **ë³„ë„ë¡œ ë¹Œë“œ**í•˜ì—¬ ì˜ì¡´ì„± ì¶©ëŒ ë°©ì§€ ë° ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ.

---

## 2. ë°±ì—”ë“œ ì„œë¹„ìŠ¤ (Backend Services)

| ì„œë¹„ìŠ¤ëª… | í¬íŠ¸ | ê¸°ìˆ  ìŠ¤íƒ | ì—­í•  ë° íŠ¹ì§• |
| :--- | :--- | :--- | :--- |
| **Main API** | 8000 | Django REST Framework | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ì¸ì¦(JWT), ë°ì´í„° ì¡°ìœ¨, **Smart Proxy (X-Accel-Redirect)** |
| **AI Core** | - | FastAPI | ê³ ì„±ëŠ¥ AI ì¶”ë¡  (Brain Tumor Seg), **HTJ2K ë””ì½”ë”© ì „ì²˜ë¦¬** í¬í•¨ |
| **Task Factory** | - | **Celery Workers** | **ì´ë¯¸ì§€ ë³€í™˜(Rawâ†’HTJ2K)**, AI ì‘ì—… íŠ¸ë¦¬ê±°, ë°ì´í„° ë™ê¸°í™” ìˆ˜í–‰ |

**í•µì‹¬ ë³€ê²½ (v2.1)**: Djangoê°€ **Secure Proxy** ì—­í•  ìˆ˜í–‰ - JWT ê²€ì¦ í›„ Nginxì—ê²Œ ì „ì†¡ ìœ„ì„.

---

## 3. ë°ì´í„° ë° ì¸í”„ë¼ (Data & Infra)

| ì„œë¹„ìŠ¤ëª… | í¬íŠ¸ | ì—­í•  | ë³´ì•ˆ ì •ì±… (v2.1) |
| :--- | :--- | :--- | :--- |
| **Nginx** | 80 | Integrated Gateway + **X-Accel-Redirect** | React, OHIF, API ë¼ìš°íŒ… + `/internal-orthanc/*` ë‚´ë¶€ ì „ìš© ë¼ìš°íŠ¸ |
| **Orthanc** | 8042 | PACS Server | **ì™¸ë¶€ ì§ì ‘ ì ‘ì† ì°¨ë‹¨**, Nginx ë‚´ë¶€ ë¼ìš°íŒ…ìœ¼ë¡œë§Œ ì ‘ê·¼ ê°€ëŠ¥ |
| **MySQL** | 3306 | RDBMS | í™˜ì/ì˜¤ë”/ì‚¬ìš©ì ë©”íƒ€ë°ì´í„° ì €ì¥ |
| **Redis** | 6379 | Broker & Cache | Celery ë©”ì‹œì§€ ë¸Œë¡œì»¤ ë° API ìºì‹± |
| **HAPI FHIR / OpenEMR** | 8080 | Interoperability | ì˜ë£Œ ë°ì´í„° í‘œì¤€(HL7 FHIR) í˜¸í™˜ì„±, **ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ ì „ìš©** |

**í•µì‹¬ ë³€ê²½ (v2.1)**: ëª¨ë“  ë°±ì—”ë“œ ì„œë¹„ìŠ¤(Orthanc, FHIR, OpenEMR)ëŠ” **ì™¸ë¶€ ì§ì ‘ ì ‘ì† ì°¨ë‹¨**, Djangoë¥¼ í†µí•´ì„œë§Œ ì ‘ê·¼.

---

## ğŸ”‘ í•µì‹¬ ì°¨ë³„ì 

### v2.1 (2025-12-30) - Secure Proxy & Multi-SPA

1.  **Secure Proxy Pattern**:
    *   OHIF â†’ Django Proxy â†’ Nginx (`X-Accel-Redirect`) â†’ Orthanc (Internal)
    *   ë³´ì•ˆ: ëª¨ë“  DICOM ë°ì´í„° ì ‘ê·¼ì´ JWT ì¸ì¦ í†µê³¼
    *   ì„±ëŠ¥: DjangoëŠ” í—¤ë”ë§Œ ë°˜í™˜, Nginxê°€ íŒŒì¼ ì „ì†¡ (Zero-Copy)

2.  **Multi-SPA Build Strategy**:
    *   Main React Appê³¼ OHIF Viewerë¥¼ **ì™„ì „íˆ ë¶„ë¦¬**í•˜ì—¬ ë¹Œë“œ ë° ë°°í¬
    *   ì˜ì¡´ì„± ì¶©ëŒ ë°©ì§€ (React ë²„ì „, íŒ¨í‚¤ì§€ ë²„ì „ ë…ë¦½ ê´€ë¦¬)

3.  **Network Segmentation**:
    *   ì™¸ë¶€ ë…¸ì¶œ: Nginxë§Œ (React, OHIF, Django API)
    *   ë‚´ë¶€ ì „ìš©: Orthanc, MySQL, Redis, FHIR, OpenEMR

### v2.0 (2025-12-30) - HTJ2K Pipeline

1.  **ë·°ì–´ ë…ë¦½ì„±**: OHIF ViewerëŠ” ë³„ë„ì˜ Node.js ì„œë²„ ì—†ì´ **ì™„ì „ ì •ì (Static)**ìœ¼ë¡œ ë°°í¬ë˜ë©°, ë¸Œë¼ìš°ì €ì˜ ìì›(WASM)ì„ í™œìš©í•©ë‹ˆë‹¤.
2.  **ë³€í™˜ ê³µì¥(Celery)**: ì—…ë¡œë“œëœ ëª¨ë“  ì´ë¯¸ì§€ëŠ” Celeryì— ì˜í•´ ì¦‰ì‹œ **ì›¹ ìµœì í™” í¬ë§·(HTJ2K)**ìœ¼ë¡œ ë³€í™˜ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤.
3.  **AIì˜ HTJ2K ì´í•´**: AI ëª¨ë¸ ì„œë²„(FastAPI)ë„ ì›ë³¸ ëŒ€ì‹  **ì••ì¶•ëœ HTJ2K**ë¥¼ ì§ì ‘ ì½ê³  í•´ì„í•  ìˆ˜ ìˆë„ë¡ íŒŒì´í”„ë¼ì¸ì´ ìµœì í™”ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ğŸ“‹ ì„œë¹„ìŠ¤ ì‹¤í–‰ ìˆœì„œ (Local Development)

### 1. Infrastructure (Docker)
```bash
# Redis
cd NeuroNova_02_back_end/07_redis
docker-compose up -d

# Orthanc PACS
cd ../05_orthanc_pacs
docker-compose up -d

# OpenEMR (Optional)
cd ../03_openemr_server
docker-compose up -d
```

### 2. Backend Services (Local venv)
```bash
# Terminal 1: Django
cd NeuroNova_02_back_end/02_django_server
venv\Scripts\python manage.py runserver

# Terminal 2: Celery Worker
venv\Scripts\celery -A cdss_backend worker -l info --concurrency=4

# Terminal 3: Celery Beat
venv\Scripts\celery -A cdss_backend beat -l info
```

### 3. Frontend (Development)
```bash
# React Main (WSL ê¶Œì¥)
cd NeuroNova_03_front_end_react/00_test_client
npm start  # Port 3001

# OHIFëŠ” ë³„ë„ ë¹Œë“œ í›„ Nginx Static Serving
```

---

## ğŸ”— ì£¼ìš” ë¼ìš°íŒ… ê·œì¹™ (Nginx v2.1)

| ê²½ë¡œ | íƒ€ê²Ÿ | ì„¤ëª… |
| :--- | :--- | :--- |
| `/` | React SPA (Static) | ë©”ì¸ ëŒ€ì‹œë³´ë“œ |
| `/pacs-viewer/` | OHIF Build (Static) | DICOM Viewer |
| `/api/*` | Django :8000 | REST API (JWT ì¸ì¦) |
| `/internal-orthanc/*` | Orthanc :8042 | **ë‚´ë¶€ ì „ìš©**, X-Accel-Redirectë¡œë§Œ ì ‘ê·¼ |

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

*   **ìƒì„¸ ì•„í‚¤í…ì²˜**: [06_ì‹œìŠ¤í…œ_ì•„í‚¤í…ì²˜_v2.md](06_ì‹œìŠ¤í…œ_ì•„í‚¤í…ì²˜_v2.md)
*   **ë°°í¬ ê°€ì´ë“œ**: [12_GCP_ë°°í¬_ê°€ì´ë“œ.md](12_GCP_ë°°í¬_ê°€ì´ë“œ.md)
*   **ë¹ ë¥¸ ì˜¨ë³´ë”©**: [REF_CLAUDE_ONBOARDING_QUICK.md](REF_CLAUDE_ONBOARDING_QUICK.md)

---

**ë¬¸ì„œ ë²„ì „**: v2.1
**ìµœì¢… ìˆ˜ì •**: 2025-12-30
**ì‘ì„±ì**: NeuroNova Development Team
