# ì„œë¹„ìŠ¤ êµ¬ì¡° ë° ì—­í•  ìš”ì•½ (Condensed Service Structure)

**ìµœì¢… ìˆ˜ì •ì¼**: 2025-12-31
**ë²„ì „**: v3.0
**ëª©ì **: ë³µì¡í•œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ êµ¬ì¡°ë¥¼ ì—­í• (Role) ì¤‘ì‹¬ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ ìš”ì•½.

---

## 1. í”„ë¡ íŠ¸ì—”ë“œ ì„œë¹„ìŠ¤ (Frontend Services)

| ì„œë¹„ìŠ¤ëª… | ê¸°ìˆ  ìŠ¤íƒ | ë°°í¬ ë°©ì‹ | ì—­í•  ë° íŠ¹ì§• |
| :--- | :--- | :--- | :--- |
| **Unified React App** | React (SPA) + **OHIF Viewer (@ohif/viewer)** | Nginx Static Serving (`/var/www/react-build`) | ì‚¬ìš©ì ë©”ì¸ ì¸í„°í˜ì´ìŠ¤, í™˜ì ê´€ë¦¬, AI ê²°ê³¼ ì¡°íšŒ, **DICOM Viewer í†µí•©** |

**í•µì‹¬ ë³€ê²½ (v3.0)**: OHIF Viewerë¥¼ npm íŒ¨í‚¤ì§€ë¡œ React í”„ë¡œì íŠ¸ì— í†µí•©í•˜ì—¬ **ë‹¨ì¼ ë¹Œë“œ ë°°í¬**. ì˜ì¡´ì„± ê´€ë¦¬ ê°„ì†Œí™” ë° ë¼ìš°íŒ… í†µí•©.

---

## 2. ë°±ì—”ë“œ ì„œë¹„ìŠ¤ (Backend Services)

| ì„œë¹„ìŠ¤ëª… | í¬íŠ¸ | ê¸°ìˆ  ìŠ¤íƒ | ì—­í•  ë° íŠ¹ì§• |
| :--- | :--- | :--- | :--- |
| **Main API** | 8000 | Django REST Framework | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ì¸ì¦(JWT), ë°ì´í„° ì¡°ìœ¨, **Smart Proxy (X-Accel-Redirect)** |
| **AI Core** | - | FastAPI | ê³ ì„±ëŠ¥ AI ì¶”ë¡  (Brain Tumor Seg), **HTJ2K ë””ì½”ë”© ì „ì²˜ë¦¬** í¬í•¨ |
| **Task Factory** | - | **Celery Workers** | **ì´ë¯¸ì§€ ë³€í™˜(Rawâ†’HTJ2K)**, AI ì‘ì—… íŠ¸ë¦¬ê±°, ë°ì´í„° ë™ê¸°í™” ìˆ˜í–‰ |

**í•µì‹¬ ë³€ê²½ (v2.1)**: Djangoê°€ **Secure Proxy** ì—­í•  ìˆ˜í–‰ - JWT ê²€ì¦ í›„ Nginxì—ê²Œ ì „ì†¡ ìœ„ì„.

---

## 3. ë°ì´í„° ë° ì¸í”„ë¼ (Data & Infra)

| ì„œë¹„ìŠ¤ëª… | í¬íŠ¸ | ì—­í•  | ë³´ì•ˆ ì •ì±… (v2.1) |
| :--- | :--- | :--- | :--- |
| **Nginx** | 80 | Integrated Gateway + **X-Accel-Redirect** | React, OHIF, API ë¼ìš°íŒ… + `/internal-orthanc/*` ë‚´ë¶€ ì „ìš© ë¼ìš°íŠ¸ |
| **Orthanc** | 8042 | PACS Server | **ì™¸ë¶€ ì§ì ‘ ì ‘ì† ì°¨ë‹¨**, Nginx ë‚´ë¶€ ë¼ìš°íŒ…ìœ¼ë¡œë§Œ ì ‘ê·¼ ê°€ëŠ¥ |
| **MySQL** | 3306 | RDBMS | í™˜ì/ì˜¤ë”/ì‚¬ìš©ì ë©”íƒ€ë°ì´í„° ì €ì¥ |
| **Redis** | 6379 | Broker & Cache | Celery ë©”ì‹œì§€ ë¸Œë¡œì»¤ ë° API ìºì‹± |
| **HAPI FHIR / OpenEMR** | 8080 | Interoperability | ì˜ë£Œ ë°ì´í„° í‘œì¤€(HL7 FHIR) í˜¸í™˜ì„±, **ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ ì „ìš©** |

**í•µì‹¬ ë³€ê²½ (v2.1)**: ëª¨ë“  ë°±ì—”ë“œ ì„œë¹„ìŠ¤(Orthanc, FHIR, OpenEMR)ëŠ” **ì™¸ë¶€ ì§ì ‘ ì ‘ì† ì°¨ë‹¨**, Djangoë¥¼ í†µí•´ì„œë§Œ ì ‘ê·¼.

---

## ğŸ”‘ í•µì‹¬ ì°¨ë³„ì 

### v3.0 (2025-12-31) - Unified React + OHIF Integration

1.  **Secure Proxy Pattern** (ìœ ì§€):
    *   React (OHIF í¬í•¨) â†’ Django Proxy â†’ Nginx (`X-Accel-Redirect`) â†’ Orthanc (Internal)
    *   ë³´ì•ˆ: ëª¨ë“  DICOM ë°ì´í„° ì ‘ê·¼ì´ JWT ì¸ì¦ í†µê³¼
    *   ì„±ëŠ¥: DjangoëŠ” í—¤ë”ë§Œ ë°˜í™˜, Nginxê°€ íŒŒì¼ ì „ì†¡ (Zero-Copy)

2.  **Single Build Strategy** (ì‹ ê·œ):
    *   OHIF Viewerë¥¼ **@ohif/viewer npm íŒ¨í‚¤ì§€**ë¡œ React í”„ë¡œì íŠ¸ ë‚´ì— í†µí•©
    *   ë¼ìš°íŒ… í†µí•©: React Routerë¡œ `/viewer/:studyId` ê²½ë¡œ ê´€ë¦¬
    *   ì˜ì¡´ì„± ì¼ì›í™”: ë‹¨ì¼ package.jsonìœ¼ë¡œ ë²„ì „ ê´€ë¦¬

3.  **Network Segmentation** (ìœ ì§€):
    *   ì™¸ë¶€ ë…¸ì¶œ: Nginxë§Œ (React, Django API)
    *   ë‚´ë¶€ ì „ìš©: Orthanc, MySQL, Redis, FHIR, OpenEMR

### v2.0 (2025-12-30) - HTJ2K Pipeline

1.  **ë·°ì–´ ë…ë¦½ì„±**: OHIF ViewerëŠ” ë³„ë„ì˜ Node.js ì„œë²„ ì—†ì´ **ì™„ì „ ì •ì (Static)**ìœ¼ë¡œ ë°°í¬ë˜ë©°, ë¸Œë¼ìš°ì €ì˜ ìì›(WASM)ì„ í™œìš©í•©ë‹ˆë‹¤.
2.  **ë³€í™˜ ê³µì¥(Celery)**: ì—…ë¡œë“œëœ ëª¨ë“  ì´ë¯¸ì§€ëŠ” Celeryì— ì˜í•´ ì¦‰ì‹œ **ì›¹ ìµœì í™” í¬ë§·(HTJ2K)**ìœ¼ë¡œ ë³€í™˜ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤.
3.  **AIì˜ HTJ2K ì´í•´**: AI ëª¨ë¸ ì„œë²„(FastAPI)ë„ ì›ë³¸ ëŒ€ì‹  **ì••ì¶•ëœ HTJ2K**ë¥¼ ì§ì ‘ ì½ê³  í•´ì„í•  ìˆ˜ ìˆë„ë¡ íŒŒì´í”„ë¼ì¸ì´ ìµœì í™”ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ğŸ“‹ ì„œë¹„ìŠ¤ ì‹¤í–‰ ìˆœì„œ (Local Development)

### 1. Infrastructure (Docker)
```bash
# Redis
cd NeuroNova_02_back_end/07_redis
docker-compose up -d

# Orthanc PACS
cd ../05_orthanc_pacs
docker-compose up -d

# OpenEMR (Optional)
cd ../03_openemr_server
docker-compose up -d
```

### 2. Backend Services (Local venv)
```bash
# Terminal 1: Django
cd NeuroNova_02_back_end/02_django_server
venv\Scripts\python manage.py runserver

# Terminal 2: Celery Worker
venv\Scripts\celery -A cdss_backend worker -l info --concurrency=4

# Terminal 3: Celery Beat
venv\Scripts\celery -A cdss_backend beat -l info
```

### 3. Frontend (Development)
```bash
# Unified React App with OHIF (WSL ê¶Œì¥)
cd NeuroNova_03_front_end_react/00_test_client
npm start  # Port 3000 (React Dev Server)
# OHIF ViewerëŠ” /viewer/:studyId ê²½ë¡œë¡œ ì ‘ê·¼
```

---

## ğŸ”— ì£¼ìš” ë¼ìš°íŒ… ê·œì¹™ (Nginx v3.0)

| ê²½ë¡œ | íƒ€ê²Ÿ | ì„¤ëª… |
| :--- | :--- | :--- |
| `/` | React SPA (Static) | ë©”ì¸ ëŒ€ì‹œë³´ë“œ |
| `/viewer/:studyId` | React SPA (OHIF í†µí•©) | **DICOM Viewer (React Router ë‚´ë¶€ ë¼ìš°íŒ…)** |
| `/api/*` | Django :8000 | REST API (JWT ì¸ì¦) |
| `/internal-orthanc/*` | Orthanc :8042 | **ë‚´ë¶€ ì „ìš©**, X-Accel-Redirectë¡œë§Œ ì ‘ê·¼ |

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

*   **ìƒì„¸ ì•„í‚¤í…ì²˜**: [06_ì‹œìŠ¤í…œ_ì•„í‚¤í…ì²˜_v2.md](06_ì‹œìŠ¤í…œ_ì•„í‚¤í…ì²˜_v2.md)
*   **ë°°í¬ ê°€ì´ë“œ**: [12_GCP_ë°°í¬_ê°€ì´ë“œ.md](12_GCP_ë°°í¬_ê°€ì´ë“œ.md)
*   **ë¹ ë¥¸ ì˜¨ë³´ë”©**: [REF_CLAUDE_ONBOARDING_QUICK.md](REF_CLAUDE_ONBOARDING_QUICK.md)

---

## ğŸ“ ë³€ê²½ ì´ë ¥

### v3.0 (2025-12-31)
- OHIF Viewerë¥¼ React í”„ë¡œì íŠ¸ì— npm íŒ¨í‚¤ì§€ë¡œ í†µí•©
- ë³„ë„ ë¹Œë“œ ì „ëµ íê¸°, ë‹¨ì¼ React ë¹Œë“œë¡œ í†µí•©
- ë¼ìš°íŒ… ê·œì¹™ ê°„ì†Œí™” (`/viewer/:studyId`)

### v2.1 (2025-12-30)
- Secure Proxy Pattern ì ìš©
- Multi-SPA Build Strategy ë„ì…
- Network Segmentation ê°•í™”

---

**ë¬¸ì„œ ë²„ì „**: v3.0
**ìµœì¢… ìˆ˜ì •**: 2025-12-31
**ì‘ì„±ì**: NeuroNova Development Team
