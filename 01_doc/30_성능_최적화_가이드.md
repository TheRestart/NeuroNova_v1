# 성능 최적화 가이드 (Performance Optimization Guide)

**최종 수정일**: 2025-12-29
**목적**: 시스템 응답 시간 단축 및 리소스 효율성 극대화를 위한 가이드

---

## 1. 개요

대규모 의료 데이터를 처리하는 CDSS 환경에서 데이터베이스 부하를 줄이고 사용자 경험을 개선하기 위한 기술적 전략입니다.

## 2. 데이터베이스 최적화 (Django ORM)

### 2.1 N+1 문제 해결
- **`select_related`**: 1:1, 1:N 관계에서 JOIN을 사용하여 한 번에 쿼리.
- **`prefetch_related`**: M:N, 역참조 관계에서 별도의 쿼리 후 Python 레벨에서 조합.

### 2.2 지연 로딩 (Lazy Loading) 방지
- 필요한 필드만 가져오기: `.only('field1', 'field2')` 또는 `.defer('big_field')`.
- 값만 필요한 경우: `.values()` 또는 `.values_list()`.

## 3. 캐싱 전략 (Redis)

### 3.1 API 결과 캐싱
- 변화가 적고 조회가 빈번한 데이터 (예: 마스터 코드, 환자 기본 정보)를 Redis에 캐싱.
- **TTL (Time To Live)** 설정: 데이터의 성격에 따라 5분 ~ 1시간 설정.

### 3.2 계산 결과 캐싱
- 복잡한 AI 분석 결과나 통계 데이터를 미리 계산하여 캐싱.

## 4. 비동기 처리 (RabbitMQ/Celery)

### 4.1 무거운 작업 분리
- AI 분석, 메일 발송, FHIR 데이터 동기화 등 실시간 응답이 필요 없는 작업을 백그라운드로 전환.

## 5. 인덱싱 (Indexing)

- 자주 검색되는 필드(`patient_id`, `ssn`, `status`)에 복합 인덱스 설정.
- 과도한 인덱스는 쓰기 성능을 저하시키므로 주의.

## 6. 정적 파일 및 기타
- 미디어 파일(DICOM 이미지) 로드 시 Django 프록시를 통한 스트리밍 및 캐시 헤더 설정.

## 7. 성능 모니터링 연동 (Phase 3)
- `django-silk` 또는 `django-debug-toolbar`를 통한 병목 지점 확인.
- Prometheus/Grafana를 통한 시스템 메트릭 수집 연동 계획.

## 8. 실행 체크리스트
- [ ] `select_related`를 통해 쿼리 수가 단일화되었는가?
- [ ] Redis 캐싱 적용 시 데이터 정합성(Cache Eviction)을 고려했는가?
- [ ] 대용량 테이블에 적절한 인덱스가 걸려있는가?
