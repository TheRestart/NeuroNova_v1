# ì—ëŸ¬ í•¸ë“¤ë§ ê°€ì´ë“œ (Error Handling Guide)

**ìµœì¢… ìˆ˜ì •ì¼**: 2025-12-28
**ëª©ì **: API í‘œì¤€ ì—ëŸ¬ ì‘ë‹µ ê·œê²© ë° ì˜ˆì™¸ ì²˜ë¦¬ ì „ëµ ì •ì˜

---

## ğŸ“‹ ëª©ì°¨

1. [í‘œì¤€ ì—ëŸ¬ ì‘ë‹µ í˜•ì‹](#1-í‘œì¤€-ì—ëŸ¬-ì‘ë‹µ-í˜•ì‹)
2. [HTTP ìƒíƒœ ì½”ë“œ ì‚¬ìš© ê·œì¹™](#2-http-ìƒíƒœ-ì½”ë“œ-ì‚¬ìš©-ê·œì¹™)
3. [ì—ëŸ¬ ì½”ë“œ ì‹œìŠ¤í…œ](#3-ì—ëŸ¬-ì½”ë“œ-ì‹œìŠ¤í…œ)
4. [Django ì˜ˆì™¸ ì²˜ë¦¬ ì „ëµ](#4-django-ì˜ˆì™¸-ì²˜ë¦¬-ì „ëµ)
5. [í”„ë¡ íŠ¸ì—”ë“œ ì—ëŸ¬ í•¸ë“¤ë§ ê°€ì´ë“œ](#5-í”„ë¡ íŠ¸ì—”ë“œ-ì—ëŸ¬-í•¸ë“¤ë§-ê°€ì´ë“œ)
6. [ë¡œê¹… í†µí•©](#6-ë¡œê¹…-í†µí•©)

---

## 1. í‘œì¤€ ì—ëŸ¬ ì‘ë‹µ í˜•ì‹

### 1.1 ê¸°ë³¸ êµ¬ì¡°

ëª¨ë“  API ì—ëŸ¬ ì‘ë‹µì€ ë‹¤ìŒ JSON í˜•ì‹ì„ ë”°ë¦…ë‹ˆë‹¤:

```json
{
  "error": {
    "code": "ERR_001",
    "message": "ì‚¬ìš©ìì—ê²Œ í‘œì‹œí•  ì—ëŸ¬ ë©”ì‹œì§€",
    "detail": "ê°œë°œìë¥¼ ìœ„í•œ ìƒì„¸ ì •ë³´ (ì„ íƒ)",
    "field": "field_name (ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨ ì‹œ)",
    "timestamp": "2025-12-28T10:30:00Z"
  }
}
```

### 1.2 í•„ë“œ ì„¤ëª…

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|------|------|------|------|
| `code` | string | O | ì—ëŸ¬ ì½”ë“œ (ERR_XXX í˜•ì‹) |
| `message` | string | O | ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€ |
| `detail` | string | X | ê°œë°œìë¥¼ ìœ„í•œ ìƒì„¸ ì •ë³´ (ë””ë²„ê¹…ìš©) |
| `field` | string | X | ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨í•œ í•„ë“œëª… |
| `timestamp` | datetime | O | ì—ëŸ¬ ë°œìƒ ì‹œê° (ISO 8601) |

### 1.3 ì˜ˆì œ

#### ì¸ì¦ ì‹¤íŒ¨
```json
{
  "error": {
    "code": "ERR_001",
    "message": "ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.",
    "timestamp": "2025-12-28T10:30:00Z"
  }
}
```

#### ê¶Œí•œ ì—†ìŒ
```json
{
  "error": {
    "code": "ERR_002",
    "message": "í•´ë‹¹ ì‘ì—…ì„ ìˆ˜í–‰í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.",
    "detail": "Required role: Doctor, Current role: Nurse",
    "timestamp": "2025-12-28T10:30:00Z"
  }
}
```

#### ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨
```json
{
  "error": {
    "code": "ERR_101",
    "message": "ì…ë ¥ê°’ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.",
    "field": "email",
    "detail": "ì´ë©”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.",
    "timestamp": "2025-12-28T10:30:00Z"
  }
}
```

#### ë¦¬ì†ŒìŠ¤ ì—†ìŒ
```json
{
  "error": {
    "code": "ERR_201",
    "message": "ìš”ì²­í•œ í™˜ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
    "detail": "Patient ID: 12345",
    "timestamp": "2025-12-28T10:30:00Z"
  }
}
```

---

## 2. HTTP ìƒíƒœ ì½”ë“œ ì‚¬ìš© ê·œì¹™

### 2.1 ì„±ê³µ ì‘ë‹µ (2xx)

| ì½”ë“œ | ì‚¬ìš© ì‹œì  |
|------|----------|
| `200 OK` | GET, PUT, PATCH ì„±ê³µ |
| `201 Created` | POST ì„±ê³µ (ë¦¬ì†ŒìŠ¤ ìƒì„±) |
| `204 No Content` | DELETE ì„±ê³µ |

### 2.2 í´ë¼ì´ì–¸íŠ¸ ì—ëŸ¬ (4xx)

| ì½”ë“œ | ì‚¬ìš© ì‹œì  | ì—ëŸ¬ ì½”ë“œ ì˜ˆì‹œ |
|------|----------|---------------|
| `400 Bad Request` | ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨, ì˜ëª»ëœ ìš”ì²­ | ERR_101 ~ ERR_199 |
| `401 Unauthorized` | ì¸ì¦ ì‹¤íŒ¨, í† í° ë§Œë£Œ | ERR_001 |
| `403 Forbidden` | ê¶Œí•œ ì—†ìŒ | ERR_002 |
| `404 Not Found` | ë¦¬ì†ŒìŠ¤ ì—†ìŒ | ERR_201 ~ ERR_299 |
| `409 Conflict` | ì¤‘ë³µ, ì¶©ëŒ (ë½í‚¹, ë©±ë“±ì„±) | ERR_301 ~ ERR_399 |
| `422 Unprocessable Entity` | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê²€ì¦ ì‹¤íŒ¨ | ERR_401 ~ ERR_499 |

### 2.3 ì„œë²„ ì—ëŸ¬ (5xx)

| ì½”ë“œ | ì‚¬ìš© ì‹œì  | ì—ëŸ¬ ì½”ë“œ ì˜ˆì‹œ |
|------|----------|---------------|
| `500 Internal Server Error` | ì˜ˆìƒì¹˜ ëª»í•œ ì„œë²„ ì˜¤ë¥˜ | ERR_500 |
| `502 Bad Gateway` | ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ë™ ì‹¤íŒ¨ (OpenEMR, Orthanc) | ERR_501 ~ ERR_599 |
| `503 Service Unavailable` | ì„œë¹„ìŠ¤ ì¼ì‹œ ì¤‘ë‹¨ (RabbitMQ ë‹¤ìš´) | ERR_503 |

---

## 3. ì—ëŸ¬ ì½”ë“œ ì‹œìŠ¤í…œ

### 3.1 ì—ëŸ¬ ì½”ë“œ ì²´ê³„

**í˜•ì‹**: `ERR_XXX` (3ìë¦¬ ìˆ«ì)

| ë²”ìœ„ | ì¹´í…Œê³ ë¦¬ | ì„¤ëª… |
|------|----------|------|
| `ERR_001 ~ ERR_099` | ì¸ì¦/ê¶Œí•œ | ë¡œê·¸ì¸, í† í°, ê¶Œí•œ ê´€ë ¨ |
| `ERR_101 ~ ERR_199` | ìœ íš¨ì„± ê²€ì¦ | ì…ë ¥ê°’ ê²€ì¦ ì‹¤íŒ¨ |
| `ERR_201 ~ ERR_299` | ë¦¬ì†ŒìŠ¤ ì—†ìŒ | ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨ |
| `ERR_301 ~ ERR_399` | ì¶©ëŒ/ë½í‚¹ | ë™ì‹œì„± ì œì–´, ì¤‘ë³µ |
| `ERR_401 ~ ERR_499` | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ | ì—…ë¬´ ê·œì¹™ ìœ„ë°˜ |
| `ERR_501 ~ ERR_599` | ì™¸ë¶€ ì‹œìŠ¤í…œ | OpenEMR, Orthanc, RabbitMQ ì—°ë™ |
| `ERR_500` | ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ | ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ |

### 3.2 ì£¼ìš” ì—ëŸ¬ ì½”ë“œ ì •ì˜

#### ì¸ì¦/ê¶Œí•œ (ERR_001 ~ ERR_099)
```python
ERR_001 = "ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”."
ERR_002 = "í•´ë‹¹ ì‘ì—…ì„ ìˆ˜í–‰í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤."
ERR_003 = "í† í°ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
ERR_004 = "ìœ íš¨í•˜ì§€ ì•Šì€ í† í°ì…ë‹ˆë‹¤."
```

#### ìœ íš¨ì„± ê²€ì¦ (ERR_101 ~ ERR_199)
```python
ERR_101 = "í•„ìˆ˜ ì…ë ¥ê°’ì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤."
ERR_102 = "ì´ë©”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."
ERR_103 = "ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤."
ERR_104 = "ë‚ ì§œ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."
ERR_105 = "ìˆ«ì ë²”ìœ„ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."
```

#### ë¦¬ì†ŒìŠ¤ ì—†ìŒ (ERR_201 ~ ERR_299)
```python
ERR_201 = "ìš”ì²­í•œ í™˜ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
ERR_202 = "ìš”ì²­í•œ ì§„ë£Œ ê¸°ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
ERR_203 = "ìš”ì²­í•œ ì²˜ë°© ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
ERR_204 = "ìš”ì²­í•œ ê²€ì‚¬ ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
ERR_205 = "ìš”ì²­í•œ ì˜ìƒ ìë£Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
```

#### ì¶©ëŒ/ë½í‚¹ (ERR_301 ~ ERR_399)
```python
ERR_301 = "ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë°ì´í„°ì…ë‹ˆë‹¤."
ERR_302 = "ë°ì´í„°ê°€ ë‹¤ë¥¸ ì‚¬ìš©ìì— ì˜í•´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. (ë‚™ê´€ì  ë½ ì¶©ëŒ)"
ERR_303 = "í•´ë‹¹ ë¦¬ì†ŒìŠ¤ëŠ” í˜„ì¬ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤. (ë¹„ê´€ì  ë½)"
ERR_304 = "ì¤‘ë³µëœ ìš”ì²­ì…ë‹ˆë‹¤. (ë©±ë“±ì„± í‚¤ ì¶©ëŒ)"
```

#### ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (ERR_401 ~ ERR_499)
```python
ERR_401 = "í™˜ìê°€ ì´ë¯¸ ì§„ë£Œ ì¤‘ì…ë‹ˆë‹¤."
ERR_402 = "ì²˜ë°© ìˆ˜ëŸ‰ì´ ì¬ê³ ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤."
ERR_403 = "ê²€ì‚¬ ê²°ê³¼ ìŠ¹ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."
ERR_404 = "AI ë¶„ì„ì´ ì•„ì§ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤."
```

#### ì™¸ë¶€ ì‹œìŠ¤í…œ (ERR_501 ~ ERR_599)
```python
ERR_501 = "OpenEMR ì—°ë™ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
ERR_502 = "Orthanc PACS ì—°ë™ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
ERR_503 = "RabbitMQ ë©”ì‹œì§€ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
ERR_504 = "AI ì½”ì–´ ì„œë¹„ìŠ¤ ì‘ë‹µ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤."
```

#### ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ (ERR_500)
```python
ERR_500 = "ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”."
```

---

## 4. Django ì˜ˆì™¸ ì²˜ë¦¬ ì „ëµ

### 4.1 ì»¤ìŠ¤í…€ Exception í´ë˜ìŠ¤

`utils/exceptions.py` ìƒì„±:

```python
from rest_framework.exceptions import APIException
from rest_framework import status
from datetime import datetime

class CDSSException(APIException):
    """CDSS í”„ë¡œì íŠ¸ ê¸°ë³¸ ì˜ˆì™¸ í´ë˜ìŠ¤"""
    status_code = status.HTTP_400_BAD_REQUEST
    default_code = 'ERR_500'
    default_detail = 'ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'

    def __init__(self, code=None, message=None, detail=None, field=None, status_code=None):
        super().__init__(detail=message or self.default_detail)
        self.code = code or self.default_code
        self.message = message or self.default_detail
        self.detail_info = detail
        self.field = field
        if status_code:
            self.status_code = status_code

    def get_full_details(self):
        error_detail = {
            'code': self.code,
            'message': self.message,
            'timestamp': datetime.utcnow().isoformat() + 'Z'
        }
        if self.detail_info:
            error_detail['detail'] = self.detail_info
        if self.field:
            error_detail['field'] = self.field
        return {'error': error_detail}


class AuthenticationFailedException(CDSSException):
    """ì¸ì¦ ì‹¤íŒ¨ ì˜ˆì™¸"""
    status_code = status.HTTP_401_UNAUTHORIZED
    default_code = 'ERR_001'
    default_detail = 'ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.'


class PermissionDeniedException(CDSSException):
    """ê¶Œí•œ ê±°ë¶€ ì˜ˆì™¸"""
    status_code = status.HTTP_403_FORBIDDEN
    default_code = 'ERR_002'
    default_detail = 'í•´ë‹¹ ì‘ì—…ì„ ìˆ˜í–‰í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.'


class ValidationException(CDSSException):
    """ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨ ì˜ˆì™¸"""
    status_code = status.HTTP_400_BAD_REQUEST
    default_code = 'ERR_101'
    default_detail = 'ì…ë ¥ê°’ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'


class ResourceNotFoundException(CDSSException):
    """ë¦¬ì†ŒìŠ¤ ì—†ìŒ ì˜ˆì™¸"""
    status_code = status.HTTP_404_NOT_FOUND
    default_code = 'ERR_201'
    default_detail = 'ìš”ì²­í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'


class ConflictException(CDSSException):
    """ì¶©ëŒ ì˜ˆì™¸ (ë½í‚¹, ì¤‘ë³µ)"""
    status_code = status.HTTP_409_CONFLICT
    default_code = 'ERR_301'
    default_detail = 'ë°ì´í„° ì¶©ëŒì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'


class BusinessLogicException(CDSSException):
    """ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìœ„ë°˜ ì˜ˆì™¸"""
    status_code = status.HTTP_422_UNPROCESSABLE_ENTITY
    default_code = 'ERR_401'
    default_detail = 'ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ìœ„ë°˜í–ˆìŠµë‹ˆë‹¤.'


class ExternalSystemException(CDSSException):
    """ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ë™ ì‹¤íŒ¨ ì˜ˆì™¸"""
    status_code = status.HTTP_502_BAD_GATEWAY
    default_code = 'ERR_501'
    default_detail = 'ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ë™ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'
```

### 4.2 ì»¤ìŠ¤í…€ Exception Handler

`utils/exception_handlers.py` ìƒì„±:

```python
from rest_framework.views import exception_handler
from rest_framework.response import Response
from .exceptions import CDSSException
from datetime import datetime
import logging

logger = logging.getLogger(__name__)

def custom_exception_handler(exc, context):
    """DRF ê¸°ë³¸ í•¸ë“¤ëŸ¬ + CDSS ì»¤ìŠ¤í…€ í•¸ë“¤ëŸ¬"""

    # CDSS ì»¤ìŠ¤í…€ ì˜ˆì™¸ ì²˜ë¦¬
    if isinstance(exc, CDSSException):
        logger.warning(f"CDSS Exception: {exc.code} - {exc.message}", extra={
            'code': exc.code,
            'detail': exc.detail_info,
            'field': exc.field,
            'view': context.get('view'),
            'request': context.get('request')
        })
        return Response(exc.get_full_details(), status=exc.status_code)

    # DRF ê¸°ë³¸ ì˜ˆì™¸ ì²˜ë¦¬ (ValidationError, NotFound ë“±)
    response = exception_handler(exc, context)

    if response is not None:
        # DRF ì˜ˆì™¸ë¥¼ í‘œì¤€ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        error_detail = {
            'error': {
                'code': 'ERR_500',
                'message': str(response.data.get('detail', 'ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')),
                'timestamp': datetime.utcnow().isoformat() + 'Z'
            }
        }

        # ValidationErrorì˜ ê²½ìš° field ì •ë³´ í¬í•¨
        if hasattr(response.data, 'items'):
            for field, errors in response.data.items():
                if field != 'detail':
                    error_detail['error']['field'] = field
                    error_detail['error']['detail'] = str(errors[0]) if isinstance(errors, list) else str(errors)
                    error_detail['error']['code'] = 'ERR_101'
                    break

        response.data = error_detail
        logger.warning(f"DRF Exception: {error_detail['error']['code']} - {error_detail['error']['message']}")
        return response

    # ì˜ˆìƒì¹˜ ëª»í•œ ì˜ˆì™¸ (500 ì—ëŸ¬)
    logger.error(f"Unexpected Exception: {str(exc)}", exc_info=True, extra={
        'view': context.get('view'),
        'request': context.get('request')
    })

    return Response({
        'error': {
            'code': 'ERR_500',
            'message': 'ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.',
            'timestamp': datetime.utcnow().isoformat() + 'Z'
        }
    }, status=500)
```

### 4.3 settings.py ì„¤ì •

```python
REST_FRAMEWORK = {
    'EXCEPTION_HANDLER': 'utils.exception_handlers.custom_exception_handler',
    # ... ê¸°íƒ€ ì„¤ì •
}
```

### 4.4 ì‚¬ìš© ì˜ˆì œ

#### Viewì—ì„œ ì‚¬ìš©
```python
from utils.exceptions import (
    ResourceNotFoundException,
    ValidationException,
    PermissionDeniedException,
    ConflictException
)

class PatientViewSet(viewsets.ModelViewSet):

    def retrieve(self, request, pk=None):
        """í™˜ì ì¡°íšŒ"""
        try:
            patient = Patient.objects.get(pk=pk)
        except Patient.DoesNotExist:
            raise ResourceNotFoundException(
                code='ERR_201',
                message='ìš”ì²­í•œ í™˜ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
                detail=f'Patient ID: {pk}'
            )

        # ... ê¶Œí•œ ì²´í¬
        if not self.has_permission(request.user, patient):
            raise PermissionDeniedException(
                code='ERR_002',
                message='í•´ë‹¹ í™˜ìì˜ ì •ë³´ë¥¼ ì¡°íšŒí•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.',
                detail=f'Required role: Doctor, Current role: {request.user.role}'
            )

        serializer = self.get_serializer(patient)
        return Response(serializer.data)

    def create(self, request):
        """í™˜ì ìƒì„±"""
        serializer = self.get_serializer(data=request.data)

        # ìœ íš¨ì„± ê²€ì¦
        if not serializer.is_valid():
            field_name = list(serializer.errors.keys())[0]
            error_msg = serializer.errors[field_name][0]
            raise ValidationException(
                code='ERR_101',
                message='ì…ë ¥ê°’ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.',
                field=field_name,
                detail=str(error_msg)
            )

        # ì¤‘ë³µ ì²´í¬
        if Patient.objects.filter(ssn=request.data.get('ssn')).exists():
            raise ConflictException(
                code='ERR_301',
                message='ì´ë¯¸ ë“±ë¡ëœ í™˜ìì…ë‹ˆë‹¤.',
                field='ssn',
                detail=f'SSN: {request.data.get("ssn")}'
            )

        patient = serializer.save()
        return Response(serializer.data, status=status.HTTP_201_CREATED)
```

#### Service Layerì—ì„œ ì‚¬ìš©
```python
from utils.exceptions import BusinessLogicException, ExternalSystemException

class EMRService:

    def create_encounter(self, patient_id, doctor_id):
        """ì§„ë£Œ ê¸°ë¡ ìƒì„±"""

        # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê²€ì¦
        active_encounter = Encounter.objects.filter(
            patient_id=patient_id,
            status='IN_PROGRESS'
        ).first()

        if active_encounter:
            raise BusinessLogicException(
                code='ERR_401',
                message='í™˜ìê°€ ì´ë¯¸ ì§„ë£Œ ì¤‘ì…ë‹ˆë‹¤.',
                detail=f'Active Encounter ID: {active_encounter.id}'
            )

        # OpenEMR ì—°ë™
        try:
            openemr_data = self.openemr_client.create_encounter(patient_id, doctor_id)
        except Exception as e:
            raise ExternalSystemException(
                code='ERR_501',
                message='OpenEMR ì—°ë™ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.',
                detail=str(e)
            )

        # ... ë¡œì§ ê³„ì†
```

---

## 5. í”„ë¡ íŠ¸ì—”ë“œ ì—ëŸ¬ í•¸ë“¤ë§ ê°€ì´ë“œ

### 5.1 Axios Interceptor ì„¤ì •

```typescript
// src/api/axios.ts
import axios from 'axios';

const api = axios.create({
  baseURL: 'http://localhost:8000/api',
});

// ì‘ë‹µ ì¸í„°ì…‰í„°
api.interceptors.response.use(
  (response) => response,
  (error) => {
    const errorResponse = error.response?.data?.error;

    if (errorResponse) {
      // í‘œì¤€ ì—ëŸ¬ í˜•ì‹
      const { code, message, detail, field } = errorResponse;

      // ì—ëŸ¬ ì½”ë“œë³„ ì²˜ë¦¬
      switch (code) {
        case 'ERR_001': // ì¸ì¦ ì‹¤íŒ¨
        case 'ERR_003': // í† í° ë§Œë£Œ
          // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ë° ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
          localStorage.removeItem('token');
          window.location.href = '/login';
          break;

        case 'ERR_002': // ê¶Œí•œ ì—†ìŒ
          // ê¶Œí•œ ë¶€ì¡± ì•ˆë‚´
          alert(message);
          window.history.back();
          break;

        default:
          // ì¼ë°˜ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
          console.error(`[${code}] ${message}`, detail);
      }

      return Promise.reject({
        code,
        message,
        detail,
        field
      });
    }

    // í‘œì¤€ í˜•ì‹ì´ ì•„ë‹Œ ê²½ìš°
    return Promise.reject(error);
  }
);

export default api;
```

### 5.2 ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ ì˜ˆì œ

```typescript
// src/components/PatientForm.tsx
import { useState } from 'react';
import api from '../api/axios';

const PatientForm = () => {
  const [error, setError] = useState<string | null>(null);
  const [fieldErrors, setFieldErrors] = useState<Record<string, string>>({});

  const handleSubmit = async (formData: any) => {
    try {
      setError(null);
      setFieldErrors({});

      const response = await api.post('/emr/patients/', formData);
      // ì„±ê³µ ì²˜ë¦¬

    } catch (err: any) {
      // í•„ë“œë³„ ì—ëŸ¬ ì²˜ë¦¬
      if (err.field) {
        setFieldErrors({ [err.field]: err.message });
      } else {
        // ì¼ë°˜ ì—ëŸ¬ ë©”ì‹œì§€
        setError(err.message || 'ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      {error && <div className="alert alert-error">{error}</div>}

      <input
        name="name"
        className={fieldErrors.name ? 'input-error' : ''}
      />
      {fieldErrors.name && <span className="error">{fieldErrors.name}</span>}

      {/* ... */}
    </form>
  );
};
```

---

## 6. ë¡œê¹… í†µí•©

### 6.1 ì—ëŸ¬ ë¡œê¹… ì „ëµ

ëª¨ë“  ì˜ˆì™¸ëŠ” ë‹¤ìŒ ë ˆë²¨ë¡œ ë¡œê¹…ë©ë‹ˆë‹¤:

| ì—ëŸ¬ íƒ€ì… | ë¡œê·¸ ë ˆë²¨ | ì„¤ëª… |
|----------|----------|------|
| ì¸ì¦/ê¶Œí•œ (`ERR_001~099`) | `WARNING` | ë³´ì•ˆ ê´€ë ¨ ì´ë²¤íŠ¸ |
| ìœ íš¨ì„± ê²€ì¦ (`ERR_101~199`) | `INFO` | ì¼ë°˜ì ì¸ ì…ë ¥ ì˜¤ë¥˜ |
| ë¦¬ì†ŒìŠ¤ ì—†ìŒ (`ERR_201~299`) | `INFO` | ì¡°íšŒ ì‹¤íŒ¨ |
| ì¶©ëŒ/ë½í‚¹ (`ERR_301~399`) | `WARNING` | ë™ì‹œì„± ì œì–´ |
| ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (`ERR_401~499`) | `WARNING` | ì—…ë¬´ ê·œì¹™ ìœ„ë°˜ |
| ì™¸ë¶€ ì‹œìŠ¤í…œ (`ERR_501~599`) | `ERROR` | ì™¸ë¶€ ì—°ë™ ì‹¤íŒ¨ |
| ì„œë²„ ë‚´ë¶€ (`ERR_500`) | `ERROR` | ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ |

### 6.2 ë¡œê·¸ í˜•ì‹

```python
logger.warning(
    f"[{error_code}] {error_message}",
    extra={
        'code': error_code,
        'detail': error_detail,
        'user_id': request.user.id if request.user.is_authenticated else None,
        'endpoint': request.path,
        'method': request.method,
        'ip': request.META.get('REMOTE_ADDR'),
    }
)
```

### 6.3 ê°ì‚¬ ë¡œê·¸ ì—°ë™

ì¤‘ìš”í•œ ì—ëŸ¬ëŠ” ê°ì‚¬ ë¡œê·¸ì—ë„ ê¸°ë¡ë©ë‹ˆë‹¤:

```python
from audit.utils import AuditClient

# ê¶Œí•œ ê±°ë¶€ ì‹œ
if not has_permission:
    AuditClient.log(
        action='PERMISSION_DENIED',
        user=request.user,
        resource_type='Patient',
        resource_id=patient_id,
        result='FAILURE',
        request=request
    )
    raise PermissionDeniedException(...)
```

---

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

- **[08_API_ëª…ì„¸ì„œ.md](08_API_ëª…ì„¸ì„œ.md)** - ì „ì²´ API ëª…ì„¸ ë° ì‘ë‹µ í˜•ì‹
- **[29_ë¡œê¹…_ì „ëµ_ë¬¸ì„œ.md](29_ë¡œê¹…_ì „ëµ_ë¬¸ì„œ.md)** - ìƒì„¸ ë¡œê¹… ì „ëµ
- **[REF_CLAUDE_CONTEXT.md](REF_CLAUDE_CONTEXT.md)** - ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ì°¸ì¡°

---

**ë¬¸ì„œ ë²„ì „**: 1.0
**ì‘ì„±ì¼**: 2025-12-28
**ëŒ€ìƒ ë…ì**: Backend ê°œë°œì, Frontend ê°œë°œì
