# NeuroNova CDSS 다음 작업 계획

**작성일**: 2025-12-31
**현재 단계**: Week 7, Phase 2 완료, 배포 전 테스트 진행 중
**다음 단계**: 2일 후 임시 배포 (Django + MySQL + Orthanc + Redis)

---

## 현재 완료 상태 (2025-12-31)

### 최신 완료 작업 (2025-12-31)
1. **React 테스트 클라이언트 API 접근 문제 해결**
   - ✅ 문제 발견: Django 포트 8000이 호스트에 노출되지 않음
   - ✅ 해결: `.env.local`에서 API URL을 `http://localhost/api`로 변경 (Nginx 경유)
   - ✅ 로그인 API 테스트 성공: JWT 토큰 정상 발급
   - ✅ 핵심 기능 API 테스트 완료: UC01 (인증), UC02 (EMR)

2. **배포 전 검증 완료**
   - ✅ WSL Ubuntu 환경 확인 (Node v20.19.6, npm 10.8.2)
   - ✅ React 빈 파일 검색 완료 (0 byte 파일 없음)
   - ✅ Django 백엔드 API 검증 완료 (14개 컨테이너 실행 중)
   - ✅ 테스트 사용자 13명 업데이트 완료
   - ✅ API 엔드포인트 테스트 완료 (UC01-05, UC09 정상)
   - ✅ 배포전 테스트 결과 문서 작성 완료
   - ⏳ React 수동 실행 필요 (WSL에서 `npm start`)

## 이전 완료 상태 (2025-12-30)

### 완료된 작업
1. **UC01-UC09 전체 구현 완료**
   - UC01: 인증/권한
   - UC02: EMR (전자의무기록)
   - UC03: OCS (처방전달시스템)
   - UC04: LIS (검체검사시스템)
   - UC05: RIS (영상검사시스템)
   - UC06: AI 추론 및 진단 보조
   - UC07: 알림 및 이벤트 관리
   - UC08: FHIR R4 표준 인터페이스
   - UC09: 감사 로그 및 보안

2. **React 테스트 클라이언트 구현**
   - 9개 UC 테스트 페이지 완성
   - 자동 로그인 기능
   - API 테스터 컴포넌트
   - WSL 실행 가이드

3. **API 문서화 보강**
   - EMR views.py 6개 함수에 @extend_schema 추가
   - OCS ViewSet 2개에 @extend_schema_view 추가
   - LIS ViewSet 2개에 @extend_schema_view 추가
   - RIS ViewSet 3개에 @extend_schema_view 추가
   - AI ViewSet에 @extend_schema_view 추가
   - AUDIT ViewSet에 @extend_schema_view 추가

4. **배포 가이드 작성**
   - GCP VM + Docker 환경 배포 가이드 (12_GCP_배포_가이드.md)
   - PuTTY/WinSCP 접속 설정
   - GitHub 기반 배포 전략
   - .env 파일 관리 전략
   - Cloudflare 무료 HTTPS 설정
   - Celery 비동기 처리 설정
   - 시스템 다이어그램 3단계 비교

5. **문서 업데이트**
   - .gitignore에 logs/ 추가
   - 서버_URL_정보.md 작성
   - 디렉토리 넘버링 변경 반영

---

## 즉시 진행 작업 (2일 내 배포 전 준비)

### Phase 0: 배포 전 테스트 및 검증 (긴급, 2일 내)
#### 1. React 테스트 클라이언트 최종 검증 (HIGH)
- [x] API 접근 경로 수정 (Nginx 경유)
- [ ] WSL에서 React 서버 수동 실행 (`npm start`)
- [ ] 브라우저 로그인 테스트 (http://localhost:3001)
- [ ] UC01-UC09 각 기능 정상 동작 확인

#### 2. Django 백엔드 상태 점검 (HIGH)
- [x] Docker 컨테이너 상태 확인 (14개 실행 중)
- [x] Nginx unhealthy 상태 조사 → Health check 스크립트 문제, 실제로는 정상
- [x] HAPI FHIR unhealthy 상태 확인 → Health check 스크립트 문제, 실제로는 정상
- [x] 모든 API 엔드포인트 응답 테스트 → UC01-05, UC09 정상 (UC06 에러 발견)

#### 3. 데이터베이스 및 샘플 데이터 (MEDIUM)
- [x] 테스트 사용자 13명 업데이트 완료
- [x] `init_sample_data.py` 실행 확인 → 환자 5명 존재 확인
- [ ] DICOM 샘플 데이터 다운로드 및 Orthanc 업로드 → 수동 작업 필요

#### 4. 배포 전 체크리스트 (HIGH)
- [ ] `13_배포전_보안_체크리스트.md` 실행
- [ ] `.env` 파일 프로덕션 설정 확인
- [ ] GCP 고정 IP 할당 확인 (34.71.151.117)
- [ ] Docker Volume 백업

---

## 다음 작업 우선순위 (배포 후)

### Phase 3-1: 배포 준비 (Week 8-9, 예상 2주)

#### 1. Docker 환경 최적화 (HIGH)
- [ ] docker-compose.yml 프로덕션 버전 작성
  - Health check 강화
  - Restart policy 설정
  - Resource limits 설정
- [ ] Dockerfile 멀티스테이지 빌드 최적화
- [ ] Docker Volume 백업 스크립트 작성
- [ ] Docker 이미지 크기 최적화

#### 2. Nginx 설정 완성 (HIGH)
- [ ] Nginx 설정 파일 작성 및 테스트
  - Cloudflare IP 화이트리스트
  - Security headers 추가
  - Rate limiting 설정
- [ ] React 빌드 자동화 스크립트
- [ ] SSL/TLS 인증서 설정 (Cloudflare Origin Certificate)
- [ ] Gzip 압축 최적화

#### 3. 데이터베이스 최적화 (MEDIUM)
- [ ] MySQL 인덱스 최적화
  - 자주 조회되는 필드에 인덱스 추가
  - Composite index 검토
- [ ] 슬로우 쿼리 로그 분석
- [ ] 데이터베이스 백업 자동화
  - mysqldump 스크립트
  - GCS 업로드 스크립트
  - 복원 스크립트

#### 4. 모니터링 설정 (MEDIUM)
- [ ] Prometheus + Grafana 설정
  - Django metrics export
  - MySQL metrics
  - Redis metrics
  - Nginx metrics
- [ ] Alerting 설정
  - 디스크 사용량 >80%
  - API 응답 시간 >1초
  - Celery queue 깊이 >100
- [ ] 로그 집계 시스템 (ELK or Loki)

---

### Phase 3-2: 성능 최적화 (Week 10-11, 예상 2주)

#### 1. API 성능 최적화 (HIGH)
- [ ] Django ORM 쿼리 최적화
  - N+1 쿼리 제거
  - select_related/prefetch_related 적용
- [ ] Redis 캐싱 전략 수립
  - 캐시 키 설계
  - TTL 설정
  - Cache invalidation 전략
- [ ] API 응답 시간 목표 달성
  - 단순 조회: <100ms
  - 복잡 조회: <300ms
  - AI 추론: <30초

#### 2. Celery 태스크 최적화 (MEDIUM)
- [ ] Celery Worker 수 조정
- [ ] Task routing 설정
  - AI 전용 queue
  - FHIR 전용 queue
  - Email 전용 queue
- [ ] Task priority 설정
- [ ] Task retry 전략 수립

#### 3. 프론트엔드 최적화 (MEDIUM)
- [ ] React 빌드 크기 최적화
  - Code splitting
  - Lazy loading
  - Tree shaking
- [ ] CDN 캐싱 전략
  - Static assets → 1년 캐싱
  - HTML → 캐싱 안 함
- [ ] Image 최적화
  - WebP 변환
  - Responsive images

---

### Phase 3-3: 보안 강화 (Week 12, 예상 1주)

#### 1. 인증 보안 (HIGH)
- [ ] JWT Token 보안 강화
  - Refresh token rotation
  - Token blacklist 구현
- [ ] Rate limiting 강화
  - 로그인 시도 제한
  - API 호출 제한
- [ ] CSRF 보호 강화

#### 2. 데이터베이스 보안 (HIGH)
- [ ] 데이터베이스 암호화
  - 민감 필드 암호화 (SSN, 이름)
  - Encryption at rest
- [ ] SQL Injection 방어 확인
- [ ] 최소 권한 원칙 적용

#### 3. 네트워크 보안 (MEDIUM)
- [ ] Cloudflare WAF 규칙 세밀화
- [ ] IP 화이트리스트 (Admin 페이지)
- [ ] DDoS 방어 설정

---

### Phase 4: 운영 준비 (Week 13-14, 예상 2주)

#### 1. CI/CD 파이프라인 구축 (HIGH)
- [ ] GitHub Actions 워크플로우 작성
  - 테스트 자동 실행
  - Docker 이미지 빌드
  - GCP VM 배포
- [ ] 배포 자동화 스크립트
  - Blue-Green 배포 또는 Rolling update
  - Health check 기반 배포
- [ ] 롤백 스크립트

#### 2. 운영 문서 작성 (MEDIUM)
- [ ] 운영 매뉴얼
  - 서비스 시작/중지 절차
  - 장애 대응 절차
  - 데이터베이스 백업/복원 절차
- [ ] API 사용 가이드 (외부 팀용)
- [ ] 트러블슈팅 가이드 확장

#### 3. 부하 테스트 (HIGH)
- [ ] Locust 또는 JMeter로 부하 테스트
  - 목표: 동시 사용자 100명
  - API 응답 시간 측정
  - 병목 지점 파악
- [ ] 성능 개선 계획 수립

---

## 예상 일정

```
Week 8-9  (Phase 3-1): 배포 준비
Week 10-11 (Phase 3-2): 성능 최적화
Week 12    (Phase 3-3): 보안 강화
Week 13-14 (Phase 4):   운영 준비
Week 15    (Phase 5):   실제 배포 및 모니터링
```

---

## 우선순위 요약

### 즉시 시작 (이번 주)
1. Docker 환경 최적화
2. Nginx 설정 완성
3. API 성능 측정 및 최적화

### 다음 주
1. 데이터베이스 최적화
2. 모니터링 설정
3. Celery 태스크 최적화

### 2주 후
1. 보안 강화
2. CI/CD 파이프라인
3. 운영 문서 작성

---

**문서 버전**: 1.1
**최종 업데이트**: 2025-12-31
**작성자**: Claude AI & NeuroNova Team

---

## 배포 범위 (2일 후 임시 배포)

### 포함 서비스
- ✅ Django backend (UC01-UC09)
- ✅ MySQL (CDSS + OpenEMR)
- ✅ Orthanc PACS
- ✅ Redis + Celery
- ✅ Prometheus + Grafana
- ✅ Nginx (Reverse Proxy)

### 제외 서비스 (타 팀원 작업)
- ❌ FastAPI (별도 팀원 개발 중)
- ❌ React 프론트엔드 (타 팀원 인계 예정)
