# ë°°í¬ ì „ ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸

**ëª©ì **: í”„ë¡œë•ì…˜ ë°°í¬ ì „ í•„ìˆ˜ ë³´ì•ˆ ì ê²€ í•­ëª©
**ëŒ€ìƒ**: NeuroNova CDSS v2.0
**ìµœì¢… ìˆ˜ì •ì¼**: 2025-12-31

---

## âš ï¸ CRITICAL - ë°°í¬ ì „ í•„ìˆ˜ í™•ì¸

ì´ ì²´í¬ë¦¬ìŠ¤íŠ¸ì˜ ëª¨ë“  í•­ëª©ì´ ì™„ë£Œë˜ê¸° ì „ì—ëŠ” **ì ˆëŒ€ í”„ë¡œë•ì…˜ ë°°í¬ ê¸ˆì§€**.

---

## ğŸ” 1. ì¸ì¦ ë° ê¶Œí•œ (Authentication & Authorization)

### 1.1 ë¹„ë°€ë²ˆí˜¸ ì •ì±…

- [ ] **í…ŒìŠ¤íŠ¸ ê³„ì • ë¹„í™œì„±í™” ë˜ëŠ” ì‚­ì œ**
  ```bash
  # ëª¨ë“  í…ŒìŠ¤íŠ¸ ê³„ì • í™•ì¸
  docker exec neuronova-django-dev python manage.py shell -c "
  from acct.models import User
  test_users = User.objects.filter(
      username__in=['admin', 'doctor', 'nurse', 'patient', 'radiologist', 'labtech']
  )
  for user in test_users:
      user.is_active = False
      user.save()
  print(f'Deactivated {test_users.count()} test accounts')
  "
  ```

- [ ] **ë¹„ë°€ë²ˆí˜¸ ë³µì¡ë„ ìš”êµ¬ì‚¬í•­ ì„¤ì •**
  ```python
  # settings.py
  AUTH_PASSWORD_VALIDATORS = [
      {
          'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
      },
      {
          'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
          'OPTIONS': {
              'min_length': 12,  # ìµœì†Œ 12ì
          }
      },
      {
          'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
      },
      {
          'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
      },
  ]
  ```

- [ ] **ì´ˆê¸° Admin ë¹„ë°€ë²ˆí˜¸ ë³€ê²½**
  ```bash
  docker exec neuronova-django-dev python manage.py changepassword admin
  ```

### 1.2 JWT í† í° ì„¤ì •

- [ ] **JWT ë§Œë£Œ ì‹œê°„ ë‹¨ì¶•**
  ```python
  # settings.py
  SIMPLE_JWT = {
      'ACCESS_TOKEN_LIFETIME': timedelta(hours=1),   # 24h â†’ 1h
      'REFRESH_TOKEN_LIFETIME': timedelta(days=7),   # 30d â†’ 7d
      'ROTATE_REFRESH_TOKENS': True,                 # ë¦¬í”„ë ˆì‹œ í† í° ìë™ ê°±ì‹ 
      'BLACKLIST_AFTER_ROTATION': True,              # ì´ì „ í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸
  }
  ```

- [ ] **JWT SECRET_KEY í™˜ê²½ë³€ìˆ˜ ë¶„ë¦¬**
  ```python
  # settings.py
  JWT_SECRET_KEY = os.getenv('JWT_SECRET_KEY')
  if not JWT_SECRET_KEY:
      raise EnvironmentError('JWT_SECRET_KEY must be set in production')
  ```

### 1.3 ë³´ì•ˆ ëª¨ë“œ í™œì„±í™”

- [ ] **ENABLE_SECURITY = True ì„¤ì •**
  ```python
  # settings.py
  ENABLE_SECURITY = os.getenv('ENABLE_SECURITY', 'True') == 'True'
  ```

- [ ] **ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ì— ê¶Œí•œ ê²€ì¦ í™•ì¸**
  ```bash
  # ê¶Œí•œì´ ì—†ëŠ” API ê²€ìƒ‰
  grep -r "permission_classes = \[\]" NeuroNova_02_back_end/02_django_server/*/views.py
  # ê²°ê³¼ê°€ ì—†ì–´ì•¼ í•¨
  ```

---

## ğŸ”’ 2. í™˜ê²½ ë³€ìˆ˜ ë° ì‹œí¬ë¦¿ (Secrets Management)

### 2.1 Django SECRET_KEY

- [ ] **ìƒˆë¡œìš´ SECRET_KEY ìƒì„±**
  ```bash
  python -c 'from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())'
  ```

- [ ] **SECRET_KEY í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •**
  ```bash
  # .env (í”„ë¡œë•ì…˜ ì„œë²„)
  DJANGO_SECRET_KEY="your-new-secret-key-here-min-50-chars"
  ```

- [ ] **í•˜ë“œì½”ë”©ëœ SECRET_KEY ì œê±°**
  ```bash
  # settings.pyì—ì„œ SECRET_KEY = 'xxx' í˜•íƒœê°€ ì—†ëŠ”ì§€ í™•ì¸
  grep "SECRET_KEY = " NeuroNova_02_back_end/02_django_server/cdss_backend/settings.py
  ```

### 2.2 ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸

- [ ] **DB ë¹„ë°€ë²ˆí˜¸ ë³€ê²½**
  ```sql
  -- MySQL
  ALTER USER 'cdss_user'@'%' IDENTIFIED BY 'new-strong-password';
  FLUSH PRIVILEGES;
  ```

- [ ] **DB ë¹„ë°€ë²ˆí˜¸ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •**
  ```bash
  # .env
  DB_PASSWORD="your-new-db-password-here"
  ```

### 2.3 ì™¸ë¶€ ì‹œìŠ¤í…œ ì¸ì¦ ì •ë³´

- [ ] **Orthanc ë¹„ë°€ë²ˆí˜¸ ë³€ê²½**
  ```json
  // 05_orthanc_pacs/orthanc.json
  {
    "RegisteredUsers": {
      "orthanc": "new-orthanc-password"
    }
  }
  ```

- [ ] **OpenEMR ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½**
  ```bash
  # OpenEMR ì›¹ ì¸í„°í˜ì´ìŠ¤ì—ì„œ ë³€ê²½
  # http://localhost:8081 â†’ Administration â†’ Users
  ```

---

## ğŸ›¡ï¸ 3. Django ë³´ì•ˆ ì„¤ì •

### 3.1 DEBUG ëª¨ë“œ

- [ ] **DEBUG = False ì„¤ì •**
  ```python
  # settings.py
  DEBUG = os.getenv('DEBUG', 'False') == 'True'

  if not DEBUG and not os.getenv('DJANGO_SECRET_KEY'):
      raise EnvironmentError('SECRET_KEY must be set when DEBUG=False')
  ```

### 3.2 ALLOWED_HOSTS

- [ ] **ALLOWED_HOSTS ëª…ì‹œ**
  ```python
  # settings.py
  ALLOWED_HOSTS = os.getenv('ALLOWED_HOSTS', '').split(',')

  # .env (í”„ë¡œë•ì…˜)
  ALLOWED_HOSTS="neuronova.example.com,api.neuronova.com"
  ```

### 3.3 CORS ì„¤ì •

- [ ] **CORS_ALLOWED_ORIGINS í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸**
  ```python
  # settings.py
  CORS_ALLOWED_ORIGINS = [
      "https://neuronova.example.com",
      "https://app.neuronova.com",
  ]

  # CORS_ALLOW_ALL_ORIGINS = False  # ì ˆëŒ€ True ê¸ˆì§€
  ```

### 3.4 ë³´ì•ˆ í—¤ë”

- [ ] **SECURE_* ì„¤ì • í™œì„±í™”**
  ```python
  # settings.py
  SECURE_SSL_REDIRECT = True
  SECURE_HSTS_SECONDS = 31536000  # 1ë…„
  SECURE_HSTS_INCLUDE_SUBDOMAINS = True
  SECURE_HSTS_PRELOAD = True
  SECURE_CONTENT_TYPE_NOSNIFF = True
  SECURE_BROWSER_XSS_FILTER = True
  X_FRAME_OPTIONS = 'DENY'
  SESSION_COOKIE_SECURE = True
  CSRF_COOKIE_SECURE = True
  ```

---

## ğŸ“Š 4. ë°ì´í„°ë² ì´ìŠ¤ ë³´ì•ˆ

### 4.1 ë°±ì—…

- [ ] **ìë™ ë°±ì—… ì„¤ì •**
  ```bash
  # Cron ì‘ì—… ì¶”ê°€ (ë§¤ì¼ ì˜¤ì „ 3ì‹œ)
  0 3 * * * /usr/local/bin/backup_cdss_db.sh
  ```

- [ ] **ë°±ì—… í…ŒìŠ¤íŠ¸ (ë³µì› ê°€ëŠ¥í•œì§€ í™•ì¸)**
  ```bash
  # ë°±ì—… ìƒì„±
  docker exec neuronova-cdss-mysql mysqldump -u root -p cdss_db > backup_$(date +%Y%m%d).sql

  # í…ŒìŠ¤íŠ¸ DBì— ë³µì› í…ŒìŠ¤íŠ¸
  docker exec -i neuronova-cdss-mysql mysql -u root -p test_db < backup_20250101.sql
  ```

### 4.2 ì ‘ê·¼ ì œì–´

- [ ] **ë°ì´í„°ë² ì´ìŠ¤ ì™¸ë¶€ ì ‘ê·¼ ì°¨ë‹¨**
  ```yaml
  # docker-compose.yml
  services:
    cdss-mysql:
      ports:
        # - "3306:3306"  # ì£¼ì„ ì²˜ë¦¬í•˜ì—¬ ì™¸ë¶€ ì ‘ê·¼ ì°¨ë‹¨
      networks:
        - internal  # ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ë§Œ í—ˆìš©
  ```

- [ ] **ë¶ˆí•„ìš”í•œ DB ì‚¬ìš©ì ì‚­ì œ**
  ```sql
  SELECT User, Host FROM mysql.user;
  -- root@%, test@% ë“± ë¶ˆí•„ìš”í•œ ê³„ì • ì‚­ì œ
  DROP USER 'test'@'%';
  ```

---

## ğŸŒ 5. ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ

### 5.1 ë°©í™”ë²½ ì„¤ì •

- [ ] **í•„ìš”í•œ í¬íŠ¸ë§Œ ê°œë°©**
  ```bash
  # GCP VM ë°©í™”ë²½ ê·œì¹™
  # 80/tcp (HTTP - Redirect to HTTPS)
  # 443/tcp (HTTPS)
  # 22/tcp (SSH - IP ì œí•œ)

  # ì°¨ë‹¨í•  í¬íŠ¸:
  # 8000 (Django - Nginxë§Œ ì ‘ê·¼)
  # 8042 (Orthanc - ë‚´ë¶€ ì „ìš©)
  # 3306 (MySQL - ë‚´ë¶€ ì „ìš©)
  # 6379 (Redis - ë‚´ë¶€ ì „ìš©)
  ```

### 5.2 HTTPS ì„¤ì •

- [ ] **SSL/TLS ì¸ì¦ì„œ ì„¤ì¹˜ (Let's Encrypt)**
  ```bash
  # Certbot ì„¤ì¹˜
  sudo apt install certbot python3-certbot-nginx

  # ì¸ì¦ì„œ ë°œê¸‰
  sudo certbot --nginx -d neuronova.example.com
  ```

- [ ] **Nginx HTTPS ë¦¬ë””ë ‰ì…˜ ì„¤ì •**
  ```nginx
  # nginx.conf
  server {
      listen 80;
      server_name neuronova.example.com;
      return 301 https://$server_name$request_uri;
  }
  ```

---

## ğŸ“ 6. ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§

### 6.1 ë¯¼ê° ì •ë³´ ë¡œê¹… ë°©ì§€

- [ ] **ë¹„ë°€ë²ˆí˜¸, í† í° ë¡œê¹… ì œì™¸**
  ```python
  # logging ì„¤ì •
  import logging

  class SensitiveDataFilter(logging.Filter):
      def filter(self, record):
          # ë¹„ë°€ë²ˆí˜¸, í† í° ë§ˆìŠ¤í‚¹
          if hasattr(record, 'msg'):
              record.msg = record.msg.replace(password, '***')
          return True
  ```

### 6.2 ì ‘ê·¼ ë¡œê·¸ ë³´ê´€

- [ ] **Nginx ì ‘ê·¼ ë¡œê·¸ ë³´ê´€ ê¸°ê°„ ì„¤ì • (ìµœì†Œ 3ê°œì›”)**
  ```nginx
  # nginx.conf
  access_log /var/log/nginx/access.log combined;
  error_log /var/log/nginx/error.log;

  # logrotate ì„¤ì •
  /var/log/nginx/*.log {
      daily
      rotate 90
      compress
      delaycompress
  }
  ```

---

## ğŸ§ª 7. ì½”ë“œ ë³´ì•ˆ

### 7.1 ì˜ì¡´ì„± ì·¨ì•½ì  ê²€ì‚¬

- [ ] **pip-audit ì‹¤í–‰**
  ```bash
  pip install pip-audit
  pip-audit
  ```

- [ ] **npm audit ì‹¤í–‰**
  ```bash
  cd NeuroNova_03_front_end_react/00_test_client
  npm audit
  npm audit fix
  ```

### 7.2 SQL Injection ë°©ì§€

- [ ] **Raw SQL ì‚¬ìš© ì—¬ë¶€ í™•ì¸**
  ```bash
  # Raw SQL ê²€ìƒ‰
  grep -r "\.raw(" NeuroNova_02_back_end/02_django_server/
  grep -r "\.execute(" NeuroNova_02_back_end/02_django_server/

  # ë°œê²¬ ì‹œ Django ORMìœ¼ë¡œ ë³€ê²½
  ```

### 7.3 XSS ë°©ì§€

- [ ] **í…œí”Œë¦¿ì—ì„œ |safe í•„í„° ì‚¬ìš© í™•ì¸**
  ```bash
  grep -r "|safe" NeuroNova_02_back_end/02_django_server/*/templates/

  # ë°œê²¬ ì‹œ í•„ìš”ì„± ì¬ê²€í† 
  ```

---

## ğŸ“¦ 8. íŒŒì¼ ë° ì •ì  ìì‚°

### 8.1 ì—…ë¡œë“œ íŒŒì¼ ê²€ì¦

- [ ] **íŒŒì¼ ì—…ë¡œë“œ í¬ê¸° ì œí•œ**
  ```python
  # settings.py
  DATA_UPLOAD_MAX_MEMORY_SIZE = 10 * 1024 * 1024  # 10MB
  FILE_UPLOAD_MAX_MEMORY_SIZE = 10 * 1024 * 1024
  ```

- [ ] **DICOM íŒŒì¼ ê²€ì¦**
  ```python
  # ris/views.py
  import pydicom

  def upload_dicom(request):
      try:
          ds = pydicom.dcmread(file)
      except:
          return Response({"error": "Invalid DICOM file"}, 400)
  ```

---

## âœ… ë°°í¬ ì „ ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: ì„¤ì • í™•ì¸
- [ ] DEBUG = False
- [ ] SECRET_KEY í™˜ê²½ë³€ìˆ˜ ì„¤ì •
- [ ] ALLOWED_HOSTS ì„¤ì •
- [ ] DB ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
- [ ] JWT í† í° ë§Œë£Œ ì‹œê°„ ë‹¨ì¶•

### Phase 2: ë³´ì•ˆ ì ê²€
- [ ] í…ŒìŠ¤íŠ¸ ê³„ì • ë¹„í™œì„±í™”
- [ ] HTTPS ì¸ì¦ì„œ ì„¤ì¹˜
- [ ] ë°©í™”ë²½ ê·œì¹™ ì„¤ì •
- [ ] ì˜ì¡´ì„± ì·¨ì•½ì  ê²€ì‚¬
- [ ] ë°±ì—… í…ŒìŠ¤íŠ¸

### Phase 3: ëª¨ë‹ˆí„°ë§ ì„¤ì •
- [ ] Prometheus ì•Œë¦¼ ì„¤ì •
- [ ] Grafana ëŒ€ì‹œë³´ë“œ í™•ì¸
- [ ] ë¡œê·¸ ë³´ê´€ ì •ì±… ì„¤ì •

### Phase 4: ìµœì¢… ê²€ì¦
- [ ] í”„ë¡œë•ì…˜ í™˜ê²½ smoke test
- [ ] ë¡œê·¸ì¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] API ì‘ë‹µ ì‹œê°„ í™•ì¸
- [ ] ì—ëŸ¬ ë°œìƒ ì‹œ ì•Œë¦¼ ìˆ˜ì‹  í…ŒìŠ¤íŠ¸

---

## ğŸš¨ ë°°í¬ í›„ ëª¨ë‹ˆí„°ë§

### ì²« 24ì‹œê°„
- [ ] ë§¤ 1ì‹œê°„ë§ˆë‹¤ ë¡œê·¸ í™•ì¸
- [ ] ì ‘ê·¼ íŒ¨í„´ ì´ìƒ ì§•í›„ ëª¨ë‹ˆí„°ë§
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ í™•ì¸

### ì²« 1ì£¼ì¼
- [ ] ë§¤ì¼ ë³´ì•ˆ ë¡œê·¸ ê²€í† 
- [ ] ì¸ì¦ ì‹¤íŒ¨ ì‹œë„ í™•ì¸
- [ ] ì„±ëŠ¥ ì§€í‘œ ëª¨ë‹ˆí„°ë§

---

**ì‘ì„±**: Claude AI
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-12-31
**ë²„ì „**: 1.0

**CRITICAL**: ì´ ì²´í¬ë¦¬ìŠ¤íŠ¸ì˜ ëª¨ë“  í•­ëª©ì´ ì™„ë£Œë˜ì§€ ì•Šìœ¼ë©´ í”„ë¡œë•ì…˜ ë°°í¬ ê¸ˆì§€!
