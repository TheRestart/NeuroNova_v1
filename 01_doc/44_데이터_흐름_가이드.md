# NeuroNova CDSS - ë°ì´í„° íë¦„ ê°€ì´ë“œ

**ì‘ì„±ì¼**: 2025-12-30
**ë²„ì „**: v2.0 - Outbox íŒ¨í„´ ì ìš©

---

## ğŸ“Œ ê°œìš”

NeuroNova CDSSëŠ” ë°ì´í„° ì¢…ë¥˜ì™€ ëª©ì ì— ë”°ë¼ 4ê°œì˜ ì €ì¥ì†Œë¥¼ ì „ëµì ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        NeuroNova CDSS ë°ì´í„° ì €ì¥ì†Œ                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Django MySQL â”‚  â”‚ OpenEMR      â”‚  â”‚ HAPI     â”‚  â”‚ Orthanc  â”‚  â”‚
â”‚  â”‚ (Cache/Data) â”‚  â”‚ (EMR Detail) â”‚  â”‚ FHIR     â”‚  â”‚ (DICOM)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                    â”‚
â”‚  â€¢ ë¹ ë¥¸ ì¡°íšŒ      â€¢ ìƒì„¸ EMR      â€¢ í‘œì¤€ êµí™˜    â€¢ ì˜ë£Œ ì˜ìƒ    â”‚
â”‚  â€¢ ë¦¬ìŠ¤íŠ¸        â€¢ ì§„ë£Œ ê¸°ë¡      â€¢ ì™¸ë¶€ ì—°ë™    â€¢ PACS         â”‚
â”‚  â€¢ ìœ ì „ ì •ë³´      â€¢ ì²˜ë°© ìƒì„¸      â€¢ FHIR R4     â€¢ DICOM        â”‚
â”‚  â€¢ AI ê²°ê³¼                                                       â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¥ 1. EMR/OCS ë°ì´í„° íë¦„ (í™˜ì, ì§„ë£Œ, ì²˜ë°©)

### ì €ì¥ ì „ëµ
- **Django MySQL**: ê¸°ë³¸ ì •ë³´ (ë¦¬ìŠ¤íŠ¸ ì¡°íšŒìš© ìºì‹œ)
- **OpenEMR**: ìƒì„¸ ì •ë³´ (ì™„ì „í•œ EMR ë°ì´í„°)
- **HAPI FHIR**: í‘œì¤€ êµí™˜ (ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ë™)

### 1.1 í™˜ì ìƒì„± (POST /api/patients/) - **Outbox íŒ¨í„´**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. API ìš”ì²­                                                         â”‚
â”‚    POST /api/emr/patients/                                          â”‚
â”‚    {                                                                â”‚
â”‚      "family_name": "ê¹€",                                           â”‚
â”‚      "given_name": "ë¯¼ì¤€",                                          â”‚
â”‚      "birth_date": "1985-05-15",                                    â”‚
â”‚      "gender": "male",                                              â”‚
â”‚      "phone": "010-1234-5678",                                      â”‚
â”‚      "emergency_contact": {                                         â”‚
â”‚        "name": "ê¹€ì˜í¬",                                            â”‚
â”‚        "phone": "010-9876-5432"                                     â”‚
â”‚      }                                                              â”‚
â”‚    }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Django Service Layer                                            â”‚
â”‚    PatientService.create_patient()                                 â”‚
â”‚    â€¢ patient_id ìë™ ìƒì„±: "P20250001"                             â”‚
â”‚    â€¢ version ì´ˆê¸°í™”: 1                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ğŸ”’ ATOMIC TRANSACTION START                                      â”‚
â”‚                                                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚ 3-1. Django MySQL ì €ì¥                                       â”‚ â”‚
â”‚    â”‚      PatientCache.objects.create()                          â”‚ â”‚
â”‚    â”‚                                                              â”‚ â”‚
â”‚    â”‚      emr_patient_cache í…Œì´ë¸”:                               â”‚ â”‚
â”‚    â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚    â”‚      â”‚patient_idâ”‚familyâ”‚given â”‚birth_date â”‚gender â”‚ phone  â”‚â”‚ â”‚
â”‚    â”‚      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ â”‚
â”‚    â”‚      â”‚P20250001 â”‚ ê¹€   â”‚ ë¯¼ì¤€  â”‚1985-05-15 â”‚ male  â”‚010-.. â”‚â”‚ â”‚
â”‚    â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚ 3-2. Outbox ë ˆì½”ë“œ ì €ì¥ (ë™ê¸°í™” ì‘ì—… ì˜ˆì•½)                   â”‚ â”‚
â”‚    â”‚      SyncOutbox.objects.create()                            â”‚ â”‚
â”‚    â”‚                                                              â”‚ â”‚
â”‚    â”‚      emr_sync_outbox í…Œì´ë¸”:                                 â”‚ â”‚
â”‚    â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚    â”‚      â”‚outbox_idâ”‚entityâ”‚entity  â”‚operationâ”‚target â”‚status  â”‚ â”‚ â”‚
â”‚    â”‚      â”‚         â”‚_type â”‚_id     â”‚        â”‚_systemâ”‚        â”‚ â”‚ â”‚
â”‚    â”‚      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚
â”‚    â”‚      â”‚uuid-... â”‚patientâ”‚P2025.. â”‚create  â”‚openemrâ”‚pending â”‚ â”‚ â”‚
â”‚    â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚    â”‚                                                              â”‚ â”‚
â”‚    â”‚      payload (JSONField): FHIR Patient ë¦¬ì†ŒìŠ¤                â”‚ â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚ ğŸ”’ ATOMIC TRANSACTION COMMIT                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ì¦‰ì‹œ ì‘ë‹µ (ë¹ ë¥¸ ì‘ë‹µ ~50ms)                                      â”‚
â”‚    Response 201 Created                                            â”‚
â”‚    {                                                                â”‚
â”‚      "data": { "patient_id": "P20250001", ... },                   â”‚
â”‚      "persistence_status": {                                        â”‚
â”‚        "django_emr_patient_cache": "ì„±ê³µ",                          â”‚
â”‚        "openemr_sync_outbox": "ëŒ€ê¸°ì¤‘ (uuid-...)"                   â”‚
â”‚      }                                                              â”‚
â”‚    }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ğŸ”„ ë¹„ë™ê¸° ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬ (Celery Worker)                        â”‚
â”‚                                                                     â”‚
â”‚    process_sync_outbox.delay(outbox_id)                            â”‚
â”‚                                                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚ 5-1. Outbox ë ˆì½”ë“œ ì¡°íšŒ (status='pending')                   â”‚ â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚ 5-2. OpenEMR FHIR ì„œë²„ë¡œ ë™ê¸°í™”                              â”‚ â”‚
â”‚    â”‚      POST http://openemr/apis/default/fhir/Patient          â”‚ â”‚
â”‚    â”‚                                                              â”‚ â”‚
â”‚    â”‚      FHIR Patient Resource:                                 â”‚ â”‚
â”‚    â”‚      {                                                       â”‚ â”‚
â”‚    â”‚        "resourceType": "Patient",                           â”‚ â”‚
â”‚    â”‚        "name": [{ "family": "ê¹€", "given": ["ë¯¼ì¤€"] }],     â”‚ â”‚
â”‚    â”‚        "gender": "male",                                    â”‚ â”‚
â”‚    â”‚        "birthDate": "1985-05-15"                            â”‚ â”‚
â”‚    â”‚      }                                                       â”‚ â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚              â–¼                               â–¼                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚    â”‚ âœ… ì„±ê³µ               â”‚      â”‚ âŒ ì‹¤íŒ¨               â”‚         â”‚
â”‚    â”‚ openemr_patient_id   â”‚      â”‚ Error/Timeout        â”‚         â”‚
â”‚    â”‚ ì €ì¥                  â”‚      â”‚                      â”‚         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚              â”‚                               â”‚                     â”‚
â”‚              â–¼                               â–¼                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚    â”‚ Outbox status='done' â”‚      â”‚ Outbox status='failed'â”‚        â”‚
â”‚    â”‚ processed_at ê¸°ë¡     â”‚      â”‚ retry_count++        â”‚         â”‚
â”‚    â”‚                      â”‚      â”‚ next_retry_at ê³„ì‚°    â”‚         â”‚
â”‚    â”‚                      â”‚      â”‚ (Exponential Backoff)â”‚         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                              â”‚                     â”‚
â”‚                                              â–¼                     â”‚
â”‚                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                                   â”‚ ì¬ì‹œë„ ì˜ˆì•½:          â”‚         â”‚
â”‚                                   â”‚ 1ì°¨: 1ë¶„ í›„          â”‚         â”‚
â”‚                                   â”‚ 2ì°¨: 2ë¶„ í›„          â”‚         â”‚
â”‚                                   â”‚ 3ì°¨: 4ë¶„ í›„          â”‚         â”‚
â”‚                                   â”‚ 4ì°¨: 8ë¶„ í›„          â”‚         â”‚
â”‚                                   â”‚ 5ì°¨: 16ë¶„ í›„         â”‚         â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ğŸ“Š Celery Beat ì£¼ê¸°ì  ì¬ì‹œë„ (ë§¤ 1ë¶„)                            â”‚
â”‚                                                                     â”‚
â”‚    retry_failed_outbox()                                           â”‚
â”‚    â€¢ status='failed'ì´ê³  next_retry_at <= nowì¸ ë ˆì½”ë“œ ì¬ì²˜ë¦¬       â”‚
â”‚    â€¢ ìµœëŒ€ 5íšŒ ì¬ì‹œë„                                                 â”‚
â”‚    â€¢ 5íšŒ ì´ˆê³¼ ì‹œ ì˜êµ¬ ì‹¤íŒ¨ (ìˆ˜ë™ í™•ì¸ í•„ìš”)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


### âœ… Outbox íŒ¨í„´ì˜ ì¥ì 

1. **ë°ì´í„° ìœ ì‹¤ ë°©ì§€** ğŸ”’
   - Atomic Transactionìœ¼ë¡œ í™˜ì ë°ì´í„° + Outbox ë ˆì½”ë“œ ë™ì‹œ ì €ì¥ ë³´ì¥
   - OpenEMR ì„œë²„ ë‹¤ìš´ ì‹œì—ë„ ë°ì´í„° ì†ì‹¤ ì—†ìŒ

2. **ë¹ ë¥¸ ì‘ë‹µ ì†ë„** âš¡
   - ì™¸ë¶€ API í˜¸ì¶œ ì—†ì´ ì¦‰ì‹œ ì‘ë‹µ (~50ms)
   - ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ

3. **ìë™ ì¬ì‹œë„** ğŸ”„
   - Exponential Backoffë¡œ ì§€ëŠ¥ì ì¸ ì¬ì‹œë„
   - ì„œë²„ ë³µêµ¬ ì‹œ ìë™ìœ¼ë¡œ ë™ê¸°í™” ì™„ë£Œ

4. **ëª¨ë‹ˆí„°ë§ ìš©ì´** ğŸ“Š
   - Outbox í…Œì´ë¸”ì—ì„œ ë™ê¸°í™” ìƒíƒœ ì‹¤ì‹œê°„ ì¶”ì 
   - ì‹¤íŒ¨ ì›ì¸ ë¶„ì„ ê°€ëŠ¥ (error_message)

5. **í™•ì¥ì„±** ğŸ“ˆ
   - Celery Worker ìˆ˜í‰ í™•ì¥ ê°€ëŠ¥
   - ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ì— ì í•©

### ìµœì¢… ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ

```
emr_patient_cache (Django MySQL):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ patient_id â”‚ familyâ”‚ givenâ”‚ birth_date â”‚ openemr_patient_idâ”‚ version â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ P20250001  â”‚ ê¹€    â”‚ ë¯¼ì¤€  â”‚ 1985-05-15 â”‚ openemr-456      â”‚ 1       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

emr_sync_outbox (Django MySQL):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚outbox_idâ”‚entity  â”‚entity_id â”‚operation â”‚target  â”‚statusâ”‚processed_at â”‚
â”‚         â”‚_type   â”‚          â”‚          â”‚_system â”‚      â”‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚uuid-... â”‚patient â”‚P20250001 â”‚create    â”‚openemr â”‚done  â”‚2025-12-30.. â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

OpenEMR (FHIR Server):
Patient/openemr-456 â†’ ìƒì„¸ ì •ë³´ (ê³¼ê±° ë³‘ë ¥, ê°€ì¡±ë ¥, ì•Œë ˆë¥´ê¸° ë“±)
```

---

### 1.2 í™˜ì ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ (GET /api/patients/)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. API ìš”ì²­                                                         â”‚
â”‚    GET /api/patients/                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Django ORM ì¿¼ë¦¬                                                  â”‚
â”‚    PatientCache.objects.all()                                      â”‚
â”‚                                                                     â”‚
â”‚    âš¡ ë¹ ë¥¸ ì¡°íšŒ: MySQL Index í™œìš©                                   â”‚
â”‚    SELECT * FROM emr_patient_cache                                 â”‚
â”‚    ORDER BY created_at DESC                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ì‘ë‹µ (ê¸°ë³¸ ì •ë³´ë§Œ)                                               â”‚
â”‚    [                                                                â”‚
â”‚      {                                                              â”‚
â”‚        "patient_id": "P20250001",                                   â”‚
â”‚        "family_name": "ê¹€",                                         â”‚
â”‚        "given_name": "ë¯¼ì¤€",                                        â”‚
â”‚        "birth_date": "1985-05-15",                                  â”‚
â”‚        "gender": "male",                                            â”‚
â”‚        "phone": "010-1234-5678"                                     â”‚
â”‚      },                                                             â”‚
â”‚      ...                                                            â”‚
â”‚    ]                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â±ï¸ ì‘ë‹µ ì‹œê°„: ~50ms (MySQL ìºì‹œë§Œ ì¡°íšŒ)
```

---

### 1.3 í™˜ì ìƒì„¸ ì¡°íšŒ (GET /api/patients/{id}/)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. API ìš”ì²­                                                         â”‚
â”‚    GET /api/patients/P20250001/                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Django MySQL ì¡°íšŒ                                                â”‚
â”‚    patient = PatientCache.objects.get(patient_id='P20250001')      â”‚
â”‚                                                                     â”‚
â”‚    ê¸°ë³¸ ì •ë³´ íšë“:                                                  â”‚
â”‚    â€¢ patient_id, family_name, given_name, birth_date, gender       â”‚
â”‚    â€¢ phone, email, address                                         â”‚
â”‚    â€¢ openemr_patient_id: "openemr-456"                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. OpenEMR ìƒì„¸ ì •ë³´ ì¡°íšŒ (openemr_patient_id ì¡´ì¬ ì‹œ)              â”‚
â”‚    openemr_client.get_patient('openemr-456')                       â”‚
â”‚                                                                     â”‚
â”‚    GET http://localhost:80/apis/default/fhir/Patient/openemr-456   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. OpenEMR FHIR ì‘ë‹µ                                                â”‚
â”‚    {                                                                â”‚
â”‚      "resourceType": "Patient",                                     â”‚
â”‚      "id": "openemr-456",                                           â”‚
â”‚      "extension": [                                                 â”‚
â”‚        {                                                            â”‚
â”‚          "url": "blood-type",                                       â”‚
â”‚          "valueString": "A+"                                        â”‚
â”‚        },                                                           â”‚
â”‚        {                                                            â”‚
â”‚          "url": "marital-status",                                   â”‚
â”‚          "valueCodeableConcept": { "text": "Married" }             â”‚
â”‚        },                                                           â”‚
â”‚        {                                                            â”‚
â”‚          "url": "occupation",                                       â”‚
â”‚          "valueString": "Software Engineer"                         â”‚
â”‚        }                                                            â”‚
â”‚      ],                                                             â”‚
â”‚      "communication": [                                             â”‚
â”‚        {                                                            â”‚
â”‚          "language": { "text": "Korean" }                           â”‚
â”‚        }                                                            â”‚
â”‚      ],                                                             â”‚
â”‚      "generalPractitioner": [                                       â”‚
â”‚        { "display": "Dr. Park Ji-sung" }                            â”‚
â”‚      ]                                                              â”‚
â”‚    }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ë§¤í¼ë¥¼ í†µí•œ ë³€í™˜                                                  â”‚
â”‚    openemr_patient_to_dict(openemr_patient)                        â”‚
â”‚                                                                     â”‚
â”‚    {                                                                â”‚
â”‚      "openemr_patient_id": "openemr-456",                          â”‚
â”‚      "blood_type": "A+",                                           â”‚
â”‚      "marital_status": "Married",                                  â”‚
â”‚      "occupation": "Software Engineer",                            â”‚
â”‚      "preferred_language": "Korean",                               â”‚
â”‚      "general_practitioner": "Dr. Park Ji-sung",                   â”‚
â”‚      "additional_contacts": [...]                                  â”‚
â”‚    }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ìµœì¢… ì‘ë‹µ (ê¸°ë³¸ + ìƒì„¸ ë³‘í•©)                                      â”‚
â”‚    {                                                                â”‚
â”‚      "data": {                                                      â”‚
â”‚        "patient_id": "P20250001",                                   â”‚
â”‚        "family_name": "ê¹€",                                         â”‚
â”‚        "given_name": "ë¯¼ì¤€",                                        â”‚
â”‚        "birth_date": "1985-05-15",                                  â”‚
â”‚        "gender": "male",                                            â”‚
â”‚        "phone": "010-1234-5678",                                    â”‚
â”‚        "email": "minjun@example.com",                               â”‚
â”‚        "openemr_patient_id": "openemr-456",                        â”‚
â”‚        "fhir_id": "fhir-123"                                       â”‚
â”‚      },                                                             â”‚
â”‚      "openemr_detail": {                                           â”‚
â”‚        "openemr_patient_id": "openemr-456",                        â”‚
â”‚        "blood_type": "A+",                                         â”‚
â”‚        "marital_status": "Married",                                â”‚
â”‚        "occupation": "Software Engineer",                          â”‚
â”‚        "preferred_language": "Korean",                             â”‚
â”‚        "general_practitioner": "Dr. Park Ji-sung"                  â”‚
â”‚      }                                                              â”‚
â”‚    }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â±ï¸ ì‘ë‹µ ì‹œê°„: ~200ms (MySQL 50ms + OpenEMR API 150ms)
```

---

### 1.4 í™˜ì ì •ë³´ ìˆ˜ì • (PATCH /api/patients/{id}/)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. API ìš”ì²­                                                         â”‚
â”‚    PATCH /api/patients/P20250001/                                   â”‚
â”‚    {                                                                â”‚
â”‚      "phone": "010-9999-8888",                                      â”‚
â”‚      "email": "newemail@example.com"                                â”‚
â”‚    }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Django MySQL ì—…ë°ì´íŠ¸                                            â”‚
â”‚    patient = PatientCache.objects.get(patient_id='P20250001')      â”‚
â”‚    patient.phone = '010-9999-8888'                                 â”‚
â”‚    patient.email = 'newemail@example.com'                          â”‚
â”‚    patient.save()                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                               â”‚
              â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3-A. EMR Signal           â”‚   â”‚ 3-B. FHIR Signal          â”‚
â”‚     (ìë™ íŠ¸ë¦¬ê±°)          â”‚   â”‚      (ìë™ íŠ¸ë¦¬ê±°)         â”‚
â”‚                           â”‚   â”‚                           â”‚
â”‚ sync_patient_to_openemr() â”‚   â”‚ sync_patient_to_fhir()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                               â”‚
              â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4-A. OpenEMR ì—…ë°ì´íŠ¸     â”‚   â”‚ 4-B. HAPI FHIR ì—…ë°ì´íŠ¸   â”‚
â”‚                           â”‚   â”‚                           â”‚
â”‚ PUT /apis/default/fhir/   â”‚   â”‚ PUT /fhir/Patient/        â”‚
â”‚     Patient/openemr-456   â”‚   â”‚     fhir-123              â”‚
â”‚                           â”‚   â”‚                           â”‚
â”‚ {                         â”‚   â”‚ {                         â”‚
â”‚   "resourceType": "..."   â”‚   â”‚   "resourceType": "..."   â”‚
â”‚   "telecom": [            â”‚   â”‚   "telecom": [            â”‚
â”‚     {                     â”‚   â”‚     {                     â”‚
â”‚       "system": "phone",  â”‚   â”‚       "system": "phone",  â”‚
â”‚       "value": "010-9999" â”‚   â”‚       "value": "010-9999" â”‚
â”‚     },                    â”‚   â”‚     },                    â”‚
â”‚     {                     â”‚   â”‚     {                     â”‚
â”‚       "system": "email",  â”‚   â”‚       "system": "email",  â”‚
â”‚       "value": "newemail" â”‚   â”‚       "value": "newemail" â”‚
â”‚     }                     â”‚   â”‚     }                     â”‚
â”‚   ]                       â”‚   â”‚   ]                       â”‚
â”‚ }                         â”‚   â”‚ }                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                               â”‚
              â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5-A. last_synced_at ì—…ë°ì´íŠ¸â”‚   â”‚ 5-B. ë™ê¸°í™” ì™„ë£Œ          â”‚
â”‚                           â”‚   â”‚                           â”‚
â”‚ UPDATE emr_patient_cache  â”‚   â”‚ âœ“ FHIR ì„œë²„ ë™ê¸°í™” ì™„ë£Œ   â”‚
â”‚ SET last_synced_at=NOW()  â”‚   â”‚                           â”‚
â”‚ WHERE patient_id=         â”‚   â”‚                           â”‚
â”‚     'P20250001'           â”‚   â”‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§¬ 2. LIS ë°ì´í„° íë¦„ (ê²€ì‚¬, ìœ ì „ ì •ë³´)

### ì €ì¥ ì „ëµ
- **Django MySQL**: ì™„ì „í•œ ë°ì´í„° (ìœ ì „ ì •ë³´ í¬í•¨, OpenEMR/FHIR ì—°ë™ ì—†ìŒ)

### 2.1 ê²€ì‚¬ ê²°ê³¼ ìƒì„± (POST /api/lab-results/)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. API ìš”ì²­                                                         â”‚
â”‚    POST /api/lab-results/                                           â”‚
â”‚    {                                                                â”‚
â”‚      "patient": "P20250001",                                        â”‚
â”‚      "order": "O-2025-001",                                         â”‚
â”‚      "test_master": "BRCA1",                                        â”‚
â”‚      "result_value": "Positive",                                    â”‚
â”‚      "result_details": {                                            â”‚
â”‚        "gene": "BRCA1",                                             â”‚
â”‚        "variant": "c.68_69delAG",                                   â”‚
â”‚        "zygosity": "heterozygous",                                  â”‚
â”‚        "pathogenicity": "pathogenic",                               â”‚
â”‚        "clinical_significance": "High risk for breast cancer",      â”‚
â”‚        "raw_sequencing_data": "ATCG..."                             â”‚
â”‚      },                                                             â”‚
â”‚      "is_abnormal": true,                                           â”‚
â”‚      "reported_by": "user-tech-001"                                 â”‚
â”‚    }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Django Service Layer                                            â”‚
â”‚    LabResultService.create_lab_result()                            â”‚
â”‚    â€¢ result_id ìë™ ìƒì„±: "LR-2025-000001"                         â”‚
â”‚    â€¢ version ì´ˆê¸°í™”: 1                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Django MySQL ì €ì¥ (ì™„ë£Œ)                                         â”‚
â”‚    LabResult.objects.create()                                      â”‚
â”‚                                                                     â”‚
â”‚    lis_lab_results í…Œì´ë¸”:                                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ result_id â”‚ patient  â”‚ test    â”‚ result     â”‚ result_detailsâ”‚  â”‚
â”‚    â”‚           â”‚          â”‚ _master â”‚ _value     â”‚ (JSON)        â”‚  â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚    â”‚ LR-2025-  â”‚ P2025000 â”‚ BRCA1   â”‚ Positive   â”‚ {            â”‚  â”‚
â”‚    â”‚   000001  â”‚   1      â”‚         â”‚            â”‚   "gene": .. â”‚  â”‚
â”‚    â”‚           â”‚          â”‚         â”‚            â”‚   "variant"..â”‚  â”‚
â”‚    â”‚           â”‚          â”‚         â”‚            â”‚ }            â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚    âš ï¸ OpenEMR, FHIR ë™ê¸°í™” ì—†ìŒ (MySQL only)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ì‘ë‹µ                                                             â”‚
â”‚    {                                                                â”‚
â”‚      "result_id": "LR-2025-000001",                                 â”‚
â”‚      "patient": "P20250001",                                        â”‚
â”‚      "test_master": {                                               â”‚
â”‚        "test_code": "BRCA1",                                        â”‚
â”‚        "test_name": "BRCA1 Gene Mutation Test"                      â”‚
â”‚      },                                                             â”‚
â”‚      "result_value": "Positive",                                    â”‚
â”‚      "result_details": {                                            â”‚
â”‚        "gene": "BRCA1",                                             â”‚
â”‚        "variant": "c.68_69delAG",                                   â”‚
â”‚        "zygosity": "heterozygous",                                  â”‚
â”‚        "pathogenicity": "pathogenic",                               â”‚
â”‚        "clinical_significance": "High risk for breast cancer"       â”‚
â”‚      },                                                             â”‚
â”‚      "is_abnormal": true,                                           â”‚
â”‚      "reported_at": "2025-12-30T10:30:00Z"                          â”‚
â”‚    }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ìœ ì „ ì •ë³´ ì¡°íšŒ (GET /api/lab-results/{id}/)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. API ìš”ì²­                                                         â”‚
â”‚    GET /api/lab-results/LR-2025-000001/                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Django MySQL ì¡°íšŒ                                                â”‚
â”‚    lab_result = LabResult.objects.get(result_id='LR-2025-000001')  â”‚
â”‚                                                                     â”‚
â”‚    SELECT * FROM lis_lab_results                                   â”‚
â”‚    WHERE result_id = 'LR-2025-000001'                              â”‚
â”‚                                                                     â”‚
â”‚    âš¡ ëª¨ë“  ë°ì´í„°ë¥¼ MySQLì—ì„œ ì§ì ‘ ì¡°íšŒ (OpenEMR/FHIR í˜¸ì¶œ ì—†ìŒ)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ì‘ë‹µ (ìœ ì „ ì •ë³´ í¬í•¨)                                             â”‚
â”‚    {                                                                â”‚
â”‚      "result_id": "LR-2025-000001",                                 â”‚
â”‚      "patient": {                                                   â”‚
â”‚        "patient_id": "P20250001",                                   â”‚
â”‚        "family_name": "ê¹€",                                         â”‚
â”‚        "given_name": "ë¯¼ì¤€"                                         â”‚
â”‚      },                                                             â”‚
â”‚      "test_master": {                                               â”‚
â”‚        "test_code": "BRCA1",                                        â”‚
â”‚        "test_name": "BRCA1 Gene Mutation Test",                     â”‚
â”‚        "reference_range": "Negative"                                â”‚
â”‚      },                                                             â”‚
â”‚      "result_value": "Positive",                                    â”‚
â”‚      "result_unit": null,                                           â”‚
â”‚      "result_details": {                                            â”‚
â”‚        "gene": "BRCA1",                                             â”‚
â”‚        "variant": "c.68_69delAG",                                   â”‚
â”‚        "zygosity": "heterozygous",                                  â”‚
â”‚        "pathogenicity": "pathogenic",                               â”‚
â”‚        "clinical_significance": "High risk for breast cancer",      â”‚
â”‚        "reference": "ClinVar ID: 12345"                             â”‚
â”‚      },                                                             â”‚
â”‚      "is_abnormal": true,                                           â”‚
â”‚      "abnormal_flag": "H",                                          â”‚
â”‚      "reported_at": "2025-12-30T10:30:00Z"                          â”‚
â”‚    }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â±ï¸ ì‘ë‹µ ì‹œê°„: ~50ms (MySQL ë‹¨ì¼ ì¿¼ë¦¬)
```

---

## ğŸ¤– 3. AI ì¶”ë¡  ê²°ê³¼ ë°ì´í„° íë¦„

### ì €ì¥ ì „ëµ
- **Django MySQL**: í…ìŠ¤íŠ¸/ìˆ«ì ê²°ê³¼ (JSON)
- **VM**: Segmentation ì´ë¯¸ì§€ ì„ì‹œ ì €ì¥
- **Orthanc**: Segmentation DICOM (ì˜ì‚¬ ìŠ¹ì¸ í›„)

### 3.1 AI ì¶”ë¡  ì‹¤í–‰ ë° ê²°ê³¼ ì €ì¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. AI ì¶”ë¡  ìš”ì²­                                                      â”‚
â”‚    POST /api/ai/jobs/                                               â”‚
â”‚    {                                                                â”‚
â”‚      "study_id": "study-uuid-123",                                  â”‚
â”‚      "model_type": "tumor_detection"                                â”‚
â”‚    }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Celery Task íì‰                                                  â”‚
â”‚    run_ai_inference.delay(job_id, study_id, model_type)            â”‚
â”‚                                                                     â”‚
â”‚    AIJob.status = 'QUEUED'                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Celery Worker ì‹¤í–‰                                                â”‚
â”‚    AIJob.status = 'PROCESSING'                                     â”‚
â”‚                                                                     â”‚
â”‚    AI ëª¨ë¸ ì‹¤í–‰:                                                    â”‚
â”‚    â€¢ DICOM ì´ë¯¸ì§€ ë¡œë“œ (Orthanc)                                    â”‚
â”‚    â€¢ ì¢…ì–‘ ê²€ì¶œ ëª¨ë¸ ì¶”ë¡                                              â”‚
â”‚    â€¢ ê²°ê³¼ ìƒì„±:                                                     â”‚
â”‚      - í…ìŠ¤íŠ¸/ìˆ«ì: tumor_volume, confidence_score, location        â”‚
â”‚      - ì´ë¯¸ì§€: segmentation.nii.gz                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                               â”‚
              â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4-A. í…ìŠ¤íŠ¸/ìˆ«ì ê²°ê³¼     â”‚   â”‚ 4-B. Seg ì´ë¯¸ì§€           â”‚
â”‚      Django MySQL ì €ì¥    â”‚   â”‚      VM ì„ì‹œ ì €ì¥         â”‚
â”‚                           â”‚   â”‚                           â”‚
â”‚ AIJob.result_data = {     â”‚   â”‚ VM ê²½ë¡œ:                  â”‚
â”‚   "tumor_detected": true, â”‚   â”‚ /vm/ai_results/           â”‚
â”‚   "tumor_volume_ml": 15.3,â”‚   â”‚   {job_id}/               â”‚
â”‚   "confidence": 0.92,     â”‚   â”‚   segmentation.nii.gz     â”‚
â”‚   "location": "right...", â”‚   â”‚                           â”‚
â”‚   "segmentation_path":    â”‚   â”‚ íŒŒì¼ í¬ê¸°: ~50MB          â”‚
â”‚     "/vm/ai_results/..."  â”‚   â”‚                           â”‚
â”‚ }                         â”‚   â”‚ â° TTL: 7ì¼               â”‚
â”‚ AIJob.status = 'COMPLETED'â”‚   â”‚ (ì˜ì‚¬ ìŠ¹ì¸ ì „ê¹Œì§€)         â”‚
â”‚                           â”‚   â”‚                           â”‚
â”‚ UPDATE ai_aijob           â”‚   â”‚                           â”‚
â”‚ SET result_data='...',    â”‚   â”‚                           â”‚
â”‚     status='COMPLETED'    â”‚   â”‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ì˜ì‚¬ ê²€í†  ë° Seg ì €ì¥ ìŠ¹ì¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì˜ì‚¬ ê²€í†  (Viewer)                                                â”‚
â”‚    GET /api/ai/jobs/{job_id}/                                       â”‚
â”‚                                                                     â”‚
â”‚    ì‘ë‹µ:                                                            â”‚
â”‚    {                                                                â”‚
â”‚      "job_id": "abc-123",                                           â”‚
â”‚      "status": "COMPLETED",                                         â”‚
â”‚      "review_status": "PENDING",                                    â”‚
â”‚      "result_data": {                                               â”‚
â”‚        "tumor_detected": true,                                      â”‚
â”‚        "tumor_volume_ml": 15.3,                                     â”‚
â”‚        "segmentation_path": "/vm/ai_results/abc-123/seg.nii.gz"     â”‚
â”‚      }                                                              â”‚
â”‚    }                                                                â”‚
â”‚                                                                     â”‚
â”‚    ì˜ì‚¬ê°€ Viewerì—ì„œ Seg ì´ë¯¸ì§€ í™•ì¸:                                â”‚
â”‚    â€¢ ì›ë³¸ DICOM ìœ„ì— Seg ì˜¤ë²„ë ˆì´                                   â”‚
â”‚    â€¢ ì¢…ì–‘ ê²½ê³„ í™•ì¸                                                  â”‚
â”‚    â€¢ ê²€í†  ì˜ê²¬ ì‘ì„±                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. 'seg_ì €ì¥' ë²„íŠ¼ í´ë¦­                                              â”‚
â”‚    POST /api/ai/jobs/{job_id}/approve-segmentation/                â”‚
â”‚    {                                                                â”‚
â”‚      "review_status": "APPROVED",                                   â”‚
â”‚      "review_comment": "Segmentation looks accurate. Approved."     â”‚
â”‚    }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Django ì—…ë°ì´íŠ¸                                                   â”‚
â”‚    AIJob.review_status = 'APPROVED'                                â”‚
â”‚    AIJob.reviewed_by = current_user                                â”‚
â”‚    AIJob.reviewed_at = now()                                       â”‚
â”‚    AIJob.review_comment = '...'                                    â”‚
â”‚    AIJob.save()                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Seg â†’ DICOM ë³€í™˜                                                  â”‚
â”‚    convert_seg_to_dicom()                                           â”‚
â”‚                                                                     â”‚
â”‚    ì…ë ¥: /vm/ai_results/abc-123/seg.nii.gz                          â”‚
â”‚    ì¶œë ¥: segmentation.dcm (DICOM Segmentation Object)               â”‚
â”‚                                                                     â”‚
â”‚    DICOM ë©”íƒ€ë°ì´í„° ì¶”ê°€:                                            â”‚
â”‚    â€¢ SeriesDescription: "AI Tumor Segmentation"                     â”‚
â”‚    â€¢ Modality: "SEG"                                                â”‚
â”‚    â€¢ ReferringPhysicianName: ì˜ì‚¬ ì´ë¦„                              â”‚
â”‚    â€¢ ContentCreatorName: "NeuroNova AI"                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Orthanc ì—…ë¡œë“œ                                                    â”‚
â”‚    POST http://localhost:8042/instances                             â”‚
â”‚    Content-Type: application/dicom                                  â”‚
â”‚    Body: <DICOM binary>                                             â”‚
â”‚                                                                     â”‚
â”‚    ì‘ë‹µ:                                                            â”‚
â”‚    {                                                                â”‚
â”‚      "ID": "orthanc-seg-789",                                       â”‚
â”‚      "Path": "/instances/orthanc-seg-789"                           â”‚
â”‚    }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. VM ì„ì‹œ íŒŒì¼ ì‚­ì œ (ì„ íƒì )                                        â”‚
â”‚    os.remove('/vm/ai_results/abc-123/seg.nii.gz')                  â”‚
â”‚                                                                     â”‚
â”‚    âœ“ Orthancì— ì˜êµ¬ ì €ì¥ë˜ì—ˆìœ¼ë¯€ë¡œ VM ì„ì‹œ íŒŒì¼ ë¶ˆí•„ìš”               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ìµœì¢… ë°ì´í„° ìœ„ì¹˜

```
ai_aijob (Django MySQL):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ job_id   â”‚ status  â”‚ review   â”‚ result_data   â”‚ reviewed_by    â”‚
â”‚          â”‚         â”‚ _status  â”‚ (JSON)        â”‚                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ abc-123  â”‚COMPLETEDâ”‚ APPROVED â”‚ {             â”‚ Dr. Kim        â”‚
â”‚          â”‚         â”‚          â”‚  "tumor_..":..â”‚                â”‚
â”‚          â”‚         â”‚          â”‚ }             â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Orthanc PACS:
Instance/orthanc-seg-789 â†’ DICOM Segmentation Object (ì˜êµ¬ ì €ì¥)

VM (ì‚­ì œë¨):
/vm/ai_results/abc-123/ â†’ (empty, ì„ì‹œ íŒŒì¼ ì‚­ì œë¨)
```

---

## ğŸ“Š ë°ì´í„° íë¦„ ìš”ì•½í‘œ

| ë°ì´í„° ì¢…ë¥˜ | Django MySQL | OpenEMR | HAPI FHIR | Orthanc | VM | ë¹„ê³  |
|------------|-------------|---------|-----------|---------|----|----|
| **í™˜ì ê¸°ë³¸ ì •ë³´** | âœ… ì €ì¥ | âœ… ìƒì„¸ ì €ì¥ | âœ… êµí™˜ìš© | - | - | ìë™ ë™ê¸°í™” |
| **ì§„ë£Œ ê¸°ë¡** | âœ… ì €ì¥ | (TODO) | (TODO) | - | - | í–¥í›„ í™•ì¥ |
| **ì²˜ë°© ì •ë³´** | âœ… ì €ì¥ | (TODO) | (TODO) | - | - | í–¥í›„ í™•ì¥ |
| **LIS ê²€ì‚¬ ê²°ê³¼** | âœ… ì™„ì „ ì €ì¥ | - | - | - | - | MySQL only |
| **ìœ ì „ ì •ë³´** | âœ… JSON | - | - | - | - | result_details |
| **AI í…ìŠ¤íŠ¸/ìˆ«ì** | âœ… JSON | - | - | - | - | result_data |
| **AI Seg (ì„ì‹œ)** | - | - | - | - | âœ… ì„ì‹œ | TTL 7ì¼ |
| **AI Seg (ìŠ¹ì¸ í›„)** | - | - | - | âœ… ì˜êµ¬ | - | DICOM SEG |
| **DICOM ì›ë³¸** | - | - | - | âœ… ì˜êµ¬ | - | PACS |

---

## ğŸš€ ì„±ëŠ¥ ìµœì í™” ì „ëµ

### 1. ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ ìµœì í™”
- **ì „ëµ**: Django MySQL ìºì‹œë§Œ ì‚¬ìš©
- **ì‘ë‹µ ì‹œê°„**: ~50ms
- **ì´ìœ **: OpenEMR/FHIR í˜¸ì¶œ ì—†ì´ ë¹ ë¥¸ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜

### 2. ìƒì„¸ ì¡°íšŒ ìµœì í™”
- **ì „ëµ**: ë³‘ë ¬ ì¡°íšŒ (Django MySQL + OpenEMR API)
- **ì‘ë‹µ ì‹œê°„**: ~200ms
- **ê°œì„ ì•ˆ**: OpenEMR ì‘ë‹µ ìºì‹± (Redis)

### 3. LIS ì¡°íšŒ ìµœì í™”
- **ì „ëµ**: MySQL ë‹¨ì¼ ì¿¼ë¦¬
- **ì‘ë‹µ ì‹œê°„**: ~50ms
- **ì´ìœ **: ì™¸ë¶€ API í˜¸ì¶œ ì—†ìŒ

### 4. AI Seg ì €ì¥ ìµœì í™”
- **ì „ëµ**: VM ì„ì‹œ ì €ì¥ â†’ ìŠ¹ì¸ í›„ Orthanc
- **ì´ìœ **:
  - ìŠ¹ì¸ë˜ì§€ ì•Šì€ SegëŠ” Orthancì— ì €ì¥ ì•ˆ í•¨ (ì €ì¥ ê³µê°„ ì ˆì•½)
  - ì˜ì‚¬ ê²€í†  ì¤‘ì—ëŠ” VMì—ì„œ ë¹ ë¥´ê²Œ ì¡°íšŒ

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-12-30 19:00
**ë²„ì „**: v1.0
