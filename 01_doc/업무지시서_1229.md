# ì—…ë¬´ì§€ì‹œì„œ - 2025-12-29 (ì¼ìš”ì¼)

**ì‘ì„±ì¼**: 2025-12-28
**ì‘ì—… ëŒ€ìƒ**: Django Backend (NeuroNova_02_back_end/01_django_server)
**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 4-6ì‹œê°„

---

## ğŸ¯ ì‘ì—… ëª©í‘œ

**Phase 1 ë¬¸ì„œ(25~27ë²ˆ)ë¥¼ ì‹¤ì œ ì½”ë“œë¡œ êµ¬í˜„**í•˜ì—¬ í¬íŠ¸í´ë¦¬ì˜¤ ì™„ì„±ë„ë¥¼ ë†’ì¸ë‹¤.

> **í•µì‹¬**: "ë¬¸ì„œë§Œ ìˆê³  ì½”ë“œê°€ ì—†ìœ¼ë©´ ë¬´ì˜ë¯¸" â†’ ì‹¤ì œ ë™ì‘í•˜ëŠ” ì½”ë“œ êµ¬í˜„

---

## ğŸ“‹ ì‘ì—… ëª©ë¡

### âœ… 1. ì—ëŸ¬ í•¸ë“¤ë§ êµ¬í˜„ (2ì‹œê°„)

**ì°¸ì¡° ë¬¸ì„œ**: [25_ì—ëŸ¬_í•¸ë“¤ë§_ê°€ì´ë“œ.md](25_ì—ëŸ¬_í•¸ë“¤ë§_ê°€ì´ë“œ.md)

#### 1.1 ì»¤ìŠ¤í…€ Exception í´ë˜ìŠ¤ ìƒì„±
**íŒŒì¼**: `NeuroNova_02_back_end/01_django_server/utils/exceptions.py`

**ì‘ì—… ë‚´ìš©**:
```python
# ë‹¤ìŒ í´ë˜ìŠ¤ë“¤ì„ êµ¬í˜„:
- CDSSException (ê¸°ë³¸ í´ë˜ìŠ¤)
- AuthenticationFailedException (ERR_001)
- PermissionDeniedException (ERR_002)
- ValidationException (ERR_101)
- ResourceNotFoundException (ERR_201)
- ConflictException (ERR_301)
- BusinessLogicException (ERR_401)
- ExternalSystemException (ERR_501)
```

**ê²€ì¦ ë°©ë²•**:
- ê° Exceptionì´ í‘œì¤€ ì—ëŸ¬ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ëŠ”ì§€ í™•ì¸
- `get_full_details()` ë©”ì„œë“œ ì •ìƒ ì‘ë™ í™•ì¸

---

#### 1.2 ì»¤ìŠ¤í…€ Exception Handler êµ¬í˜„
**íŒŒì¼**: `NeuroNova_02_back_end/01_django_server/utils/exception_handlers.py`

**ì‘ì—… ë‚´ìš©**:
```python
# custom_exception_handler() í•¨ìˆ˜ êµ¬í˜„:
1. CDSSException ì²˜ë¦¬
2. DRF ê¸°ë³¸ ì˜ˆì™¸ ì²˜ë¦¬ (ValidationError ë“±)
3. ì˜ˆìƒì¹˜ ëª»í•œ ì˜ˆì™¸ ì²˜ë¦¬ (500 ì—ëŸ¬)
4. ë¡œê¹… í†µí•©
```

**ê²€ì¦ ë°©ë²•**:
- ì˜ë„ì ìœ¼ë¡œ ì—ëŸ¬ ë°œìƒì‹œì¼œ ì‘ë‹µ í˜•ì‹ í™•ì¸
- ë¡œê·¸ê°€ ì •ìƒì ìœ¼ë¡œ ê¸°ë¡ë˜ëŠ”ì§€ í™•ì¸

---

#### 1.3 settings.py ì„¤ì •
**íŒŒì¼**: `NeuroNova_02_back_end/01_django_server/cdss_backend/settings.py`

**ì‘ì—… ë‚´ìš©**:
```python
REST_FRAMEWORK = {
    'EXCEPTION_HANDLER': 'utils.exception_handlers.custom_exception_handler',
    # ... ê¸°ì¡´ ì„¤ì • ìœ ì§€
}
```

---

#### 1.4 ê¸°ì¡´ Viewì— ì ìš© (ìƒ˜í”Œ)
**ëŒ€ìƒ**: `acct/views.py`ì˜ ë¡œê·¸ì¸ API

**ì‘ì—… ë‚´ìš©**:
- ê¸°ì¡´ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ì»¤ìŠ¤í…€ Exceptionìœ¼ë¡œ ë³€ê²½
- `AuthenticationFailedException` ì‚¬ìš© ì˜ˆì‹œ ì¶”ê°€

**Before**:
```python
return Response({'error': 'Invalid credentials'}, status=401)
```

**After**:
```python
from utils.exceptions import AuthenticationFailedException

raise AuthenticationFailedException(
    code='ERR_001',
    message='ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.'
)
```

---

### âœ… 2. Swagger ìë™ë¬¸ì„œí™” ì„¤ì • (1.5ì‹œê°„)

**ì°¸ì¡° ë¬¸ì„œ**: [26_API_ìë™ë¬¸ì„œí™”_ê°€ì´ë“œ.md](26_API_ìë™ë¬¸ì„œí™”_ê°€ì´ë“œ.md)

#### 2.1 íŒ¨í‚¤ì§€ ì„¤ì¹˜
**ì‘ì—… ë‚´ìš©**:
```powershell
cd NeuroNova_02_back_end/01_django_server
./venv/Scripts/activate
pip install drf-spectacular
pip freeze > requirements.txt
```

---

#### 2.2 settings.py ì„¤ì •
**íŒŒì¼**: `cdss_backend/settings.py`

**ì‘ì—… ë‚´ìš©**:
```python
INSTALLED_APPS = [
    # ...
    'drf_spectacular',  # ì¶”ê°€
]

REST_FRAMEWORK = {
    'DEFAULT_SCHEMA_CLASS': 'drf_spectacular.openapi.AutoSchema',
    'EXCEPTION_HANDLER': 'utils.exception_handlers.custom_exception_handler',
}

SPECTACULAR_SETTINGS = {
    'TITLE': 'NeuroNova CDSS API',
    'DESCRIPTION': '...',  # 26ë²ˆ ë¬¸ì„œ ì°¸ì¡°
    'VERSION': '1.0.0',
    # ... ì „ì²´ ì„¤ì •ì€ 26ë²ˆ ë¬¸ì„œ ë³µì‚¬
}
```

---

#### 2.3 urls.py ì„¤ì •
**íŒŒì¼**: `cdss_backend/urls.py`

**ì‘ì—… ë‚´ìš©**:
```python
from drf_spectacular.views import (
    SpectacularAPIView,
    SpectacularSwaggerView,
    SpectacularRedocView,
)

urlpatterns = [
    # ... ê¸°ì¡´ URL
    path('api/schema/', SpectacularAPIView.as_view(), name='schema'),
    path('api/docs/', SpectacularSwaggerView.as_view(url_name='schema'), name='swagger-ui'),
    path('api/redoc/', SpectacularRedocView.as_view(url_name='schema'), name='redoc'),
]
```

**ê²€ì¦ ë°©ë²•**:
- ì„œë²„ ì‹¤í–‰ í›„ `http://localhost:8000/api/docs/` ì ‘ì†
- Swagger UIê°€ ì •ìƒì ìœ¼ë¡œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸

---

#### 2.4 ì£¼ìš” APIì— @extend_schema ì¶”ê°€ (ìƒ˜í”Œ 3~5ê°œ)

**ëŒ€ìƒ API** (ìš°ì„ ìˆœìœ„ ìˆœ):
1. `POST /api/acct/login/` - ë¡œê·¸ì¸
2. `GET /api/acct/me/` - ë‚´ ì •ë³´ ì¡°íšŒ
3. `GET /api/emr/patients/` - í™˜ì ëª©ë¡
4. `POST /api/emr/patients/` - í™˜ì ë“±ë¡
5. `GET /api/emr/patients/{id}/` - í™˜ì ìƒì„¸

**ì‘ì—… ë‚´ìš©** (ì˜ˆì‹œ: ë¡œê·¸ì¸ API):
```python
from drf_spectacular.utils import extend_schema

class LoginAPIView(APIView):
    @extend_schema(
        summary="ë¡œê·¸ì¸",
        description="ì‚¬ìš©ì ì¸ì¦ í›„ JWT Access Tokenê³¼ Refresh Tokenì„ ë°œê¸‰í•©ë‹ˆë‹¤.",
        tags=['acct'],
        request={...},  # 26ë²ˆ ë¬¸ì„œ ì°¸ì¡°
        responses={...},  # 26ë²ˆ ë¬¸ì„œ ì°¸ì¡°
    )
    def post(self, request):
        # ê¸°ì¡´ ë¡œì§
```

**ê²€ì¦ ë°©ë²•**:
- Swagger UIì—ì„œ ê° API ë¬¸ì„œ í™•ì¸
- "Try it out" ë²„íŠ¼ìœ¼ë¡œ ì‹¤ì œ í…ŒìŠ¤íŠ¸

---

### âœ… 3. ë°ì´í„° ê²€ì¦ ê°•í™” (ìƒ˜í”Œ) (1.5ì‹œê°„)

**ì°¸ì¡° ë¬¸ì„œ**: [27_ë°ì´í„°_ê²€ì¦_ì •ì±….md](27_ë°ì´í„°_ê²€ì¦_ì •ì±….md)

#### 3.1 Serializer ê²€ì¦ ê°•í™” (ìƒ˜í”Œ 1ê°œ)

**ëŒ€ìƒ**: `emr/serializers.py`ì˜ `PatientSerializer`

**ì‘ì—… ë‚´ìš©**:
```python
class PatientSerializer(serializers.ModelSerializer):

    def validate_ssn(self, value):
        """ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ ê²€ì¦ (27ë²ˆ ë¬¸ì„œ ì˜ˆì‹œ ì ìš©)"""
        # 1. ê¸¸ì´ ì²´í¬
        if len(value) != 13:
            raise serializers.ValidationError('ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ëŠ” 13ìë¦¬ì—¬ì•¼ í•©ë‹ˆë‹¤.')

        # 2. ìˆ«ìë§Œ í—ˆìš©
        if not value.isdigit():
            raise serializers.ValidationError('ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ëŠ” ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.')

        # 3. ì¤‘ë³µ ì²´í¬
        if self.instance is None:  # ìƒì„± ì‹œì—ë§Œ
            if Patient.objects.filter(ssn=value).exists():
                raise serializers.ValidationError('ì´ë¯¸ ë“±ë¡ëœ ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ì…ë‹ˆë‹¤.')

        return value

    def validate_phone(self, value):
        """ì „í™”ë²ˆí˜¸ ê²€ì¦ (27ë²ˆ ë¬¸ì„œ ì˜ˆì‹œ ì ìš©)"""
        # ì •ê·œí‘œí˜„ì‹ ê²€ì¦
        import re
        pattern = r'^01[0-9]-?\d{3,4}-?\d{4}$'
        if value and not re.match(pattern, value):
            raise serializers.ValidationError('ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.')
        return value
```

**ê²€ì¦ ë°©ë²•**:
- Postman ë˜ëŠ” Swagger UIì—ì„œ ì˜ëª»ëœ ë°ì´í„° ì „ì†¡
- ì—ëŸ¬ ë©”ì‹œì§€ê°€ í‘œì¤€ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µë˜ëŠ”ì§€ í™•ì¸

---

### âœ… 4. í†µí•© í…ŒìŠ¤íŠ¸ ë° ê²€ì¦ (1ì‹œê°„)

#### 4.1 ì„œë²„ ì‹¤í–‰ ë° ê¸°ë³¸ í™•ì¸
```powershell
cd NeuroNova_02_back_end/01_django_server
./venv/Scripts/python manage.py runserver
```

**í™•ì¸ ì‚¬í•­**:
- [ ] ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ì‹œì‘ë˜ëŠ”ê°€?
- [ ] ê¸°ì¡´ APIê°€ ì—¬ì „íˆ ì •ìƒ ì‘ë™í•˜ëŠ”ê°€?

---

#### 4.2 Swagger UI í™•ì¸
**ì ‘ì†**: http://localhost:8000/api/docs/

**í™•ì¸ ì‚¬í•­**:
- [ ] Swagger UIê°€ ì •ìƒ í‘œì‹œë˜ëŠ”ê°€?
- [ ] ì£¼ìš” API 5ê°œê°€ ë¬¸ì„œí™”ë˜ì–´ ìˆëŠ”ê°€?
- [ ] "Try it out"ìœ¼ë¡œ API í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œê°€?

---

#### 4.3 ì—ëŸ¬ ì‘ë‹µ í˜•ì‹ í™•ì¸

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:
1. **ì¸ì¦ ì‹¤íŒ¨** (`POST /api/acct/login/`):
   - ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
   - ì‘ë‹µ:
     ```json
     {
       "error": {
         "code": "ERR_001",
         "message": "ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤...",
         "timestamp": "2025-12-29T..."
       }
     }
     ```

2. **ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨** (`POST /api/emr/patients/`):
   - ì˜ëª»ëœ SSN ì…ë ¥ (ì˜ˆ: "abc")
   - ì‘ë‹µ:
     ```json
     {
       "error": {
         "code": "ERR_101",
         "field": "ssn",
         "message": "ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ëŠ” ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.",
         "timestamp": "..."
       }
     }
     ```

**í™•ì¸ ì‚¬í•­**:
- [ ] ëª¨ë“  ì—ëŸ¬ê°€ í‘œì¤€ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µë˜ëŠ”ê°€?
- [ ] `code`, `message`, `timestamp` í•„ë“œê°€ ëª¨ë‘ í¬í•¨ë˜ëŠ”ê°€?

---

#### 4.4 OpenAPI Schema Export
```powershell
./venv/Scripts/python manage.py spectacular --file api_schema.json
```

**í™•ì¸ ì‚¬í•­**:
- [ ] `api_schema.json` íŒŒì¼ì´ ìƒì„±ë˜ëŠ”ê°€?
- [ ] íŒŒì¼ ë‚´ìš©ì´ ì˜¬ë°”ë¥¸ JSON í˜•ì‹ì¸ê°€?

---

## ğŸ“ ì‘ì—… ì™„ë£Œ í›„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì½”ë“œ ì‘ì„±
- [ ] `utils/exceptions.py` ìƒì„± ì™„ë£Œ
- [ ] `utils/exception_handlers.py` ìƒì„± ì™„ë£Œ
- [ ] `settings.py` ìˆ˜ì • ì™„ë£Œ (drf-spectacular ì„¤ì •)
- [ ] `urls.py` ìˆ˜ì • ì™„ë£Œ (Swagger URL ì¶”ê°€)
- [ ] ì£¼ìš” API 5ê°œì— `@extend_schema` ì¶”ê°€ ì™„ë£Œ
- [ ] Serializer ê²€ì¦ ê°•í™” (ìƒ˜í”Œ 1ê°œ ì´ìƒ)

### í…ŒìŠ¤íŠ¸
- [ ] ì„œë²„ ì •ìƒ ì‹¤í–‰ í™•ì¸
- [ ] Swagger UI ì ‘ì† í™•ì¸ (http://localhost:8000/api/docs/)
- [ ] ì—ëŸ¬ ì‘ë‹µ í˜•ì‹ í™•ì¸ (í‘œì¤€ í˜•ì‹ ì¤€ìˆ˜)
- [ ] OpenAPI Schema íŒŒì¼ ìƒì„± í™•ì¸

### ë¬¸ì„œ ì—…ë°ì´íŠ¸
- [ ] `requirements.txt` ì—…ë°ì´íŠ¸ (`drf-spectacular` ì¶”ê°€)
- [ ] `LOG_ì‘ì—…ì´ë ¥.md` ì—…ë°ì´íŠ¸ (Week 7 ì‘ì—… ê¸°ë¡)

---

## ğŸš¨ ì£¼ì˜ì‚¬í•­

1. **ê¸°ì¡´ ì½”ë“œ ì•ˆì „ì„±**:
   - ê¸°ì¡´ APIê°€ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ ë°˜ë“œì‹œ í™•ì¸
   - ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ì¦‰ì‹œ ë¡¤ë°±

2. **Git Commit**:
   - ì‘ì—… ë‹¨ìœ„ë³„ë¡œ ì»¤ë°‹ (ì—ëŸ¬ í•¸ë“¤ë§ â†’ Swagger â†’ ë°ì´í„° ê²€ì¦)
   - ì»¤ë°‹ ë©”ì‹œì§€ ì˜ˆì‹œ:
     ```
     feat: Add custom exception handling system (ERR_XXX codes)
     feat: Add Swagger/OpenAPI auto-documentation
     feat: Enhance data validation in Serializers
     ```

3. **ì½”ë“œ í’ˆì§ˆ**:
   - ê°€ë…ì„±ê³¼ ì¬ì‚¬ìš©ì„± ìµœìš°ì„ 
   - ì£¼ì„ì€ í•„ìš”í•œ ê³³ì—ë§Œ (ë³µì¡í•œ ë¡œì§ë§Œ)
   - PEP 8 ì¤€ìˆ˜

---

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

- [25_ì—ëŸ¬_í•¸ë“¤ë§_ê°€ì´ë“œ.md](25_ì—ëŸ¬_í•¸ë“¤ë§_ê°€ì´ë“œ.md)
- [26_API_ìë™ë¬¸ì„œí™”_ê°€ì´ë“œ.md](26_API_ìë™ë¬¸ì„œí™”_ê°€ì´ë“œ.md)
- [27_ë°ì´í„°_ê²€ì¦_ì •ì±….md](27_ë°ì´í„°_ê²€ì¦_ì •ì±….md)
- [24_ë ˆì´ì–´_ì•„í‚¤í…ì²˜_ê°€ì´ë“œ.md](24_ë ˆì´ì–´_ì•„í‚¤í…ì²˜_ê°€ì´ë“œ.md)

---

## ğŸ¯ ì„±ê³µ ê¸°ì¤€

1. âœ… Swagger UIê°€ ì •ìƒ ì‘ë™í•˜ê³ , ì£¼ìš” API 5ê°œê°€ ë¬¸ì„œí™”ë˜ì–´ ìˆë‹¤
2. âœ… ëª¨ë“  ì—ëŸ¬ê°€ í‘œì¤€ í˜•ì‹(`ERR_XXX`)ìœ¼ë¡œ ì‘ë‹µëœë‹¤
3. âœ… Serializer ë°ì´í„° ê²€ì¦ì´ ê°•í™”ë˜ì–´ ìˆë‹¤ (ìµœì†Œ 1ê°œ ì´ìƒ)
4. âœ… ê¸°ì¡´ ê¸°ëŠ¥ì´ ëª¨ë‘ ì •ìƒ ì‘ë™í•œë‹¤

---

**ì‘ì„±ì**: Claude AI
**ê²€í† ì**: User
**ì˜ˆìƒ ì™„ë£Œ ì‹œê°„**: 2025-12-29 ì˜¤í›„ 6ì‹œ
