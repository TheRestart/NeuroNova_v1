# 17. í”„ë¡œì íŠ¸ R&R (Roles & Responsibilities) - ì—­í•  ë° ì±…ì„ ë¶„ë‹´

**ë¬¸ì„œ ì‘ì„±ì¼**: 2025-12-24
**ì‘ì„±ì**: Project Team + Claude AI
**ë²„ì „**: 2.0 (Django Backend ê°œë°œììš©)

---

## ğŸ“‹ ê°œìš”

NeuroNova CDSS í”„ë¡œì íŠ¸ëŠ” **ì—­í•  ê¸°ë°˜ ê°œë°œ(Role-Based Development)**ì„ ì±„íƒí•©ë‹ˆë‹¤.
ê° íŒ€ì›ì€ ìì‹ ì˜ ì „ë¬¸ ì˜ì—­ì— ì§‘ì¤‘í•˜ë©°, ìµœì¢… í†µí•©ì€ **Interface Specification**ì„ í†µí•´ ì§„í–‰í•©ë‹ˆë‹¤.

---

## ğŸ‘¥ íŒ€ êµ¬ì„± ë° ì—­í•  ë¶„ë‹´

### 1. **Django Backend ê°œë°œíŒ€** (í˜„ì¬ ë‹´ë‹¹ì: ë‚˜)

**ì±…ì„ ë²”ìœ„:**
- âœ… Django REST API ê°œë°œ (UC01~UC09)
- âœ… ë°ì´í„° ì¶©ëŒ ì—†ëŠ” CRUD êµ¬í˜„
- âœ… Optimistic/Pessimistic Locking íŒ¨í„´
- âœ… Transaction ê´€ë¦¬ ë° ë™ì‹œì„± ì œì–´
- âœ… Write-Through/Parallel Dual-Write íŒ¨í„´
- âœ… MySQL ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ ë° ë§ˆì´ê·¸ë ˆì´ì…˜
- âœ… 7-Layer Architecture êµ¬í˜„
- âœ… OpenEMR, Orthanc, FHIR ì—°ë™

**ì œì™¸ ì‚¬í•­:**
- âŒ AI ëª¨ë¸ ê°œë°œ (PyTorch, MONAI)
- âŒ DICOM ì „ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸
- âŒ Flask AI Serving
- âŒ Web Frontend (React)
- âŒ Mobile App (Flutter)

**ì‚°ì¶œë¬¼:**
- Django REST API (DRF ViewSets)
- Service/Repository ë ˆì´ì–´ ì½”ë“œ
- Database Migration íŒŒì¼
- ë™ì‹œì„± í…ŒìŠ¤íŠ¸ ì½”ë“œ (pytest)
- API ëª…ì„¸ì„œ, DB ìŠ¤í‚¤ë§ˆ ë¬¸ì„œ

---

### 2. **AI ì½”ì–´ ê°œë°œíŒ€** (íƒ€ íŒ€ì› ë‹´ë‹¹)

**ì±…ì„ ë²”ìœ„:**
- AI ëª¨ë¸ ê°œë°œ (MRI ì¢…ì–‘ ë¶„ì„, Omics ë¶„ì„)
- ë°ì´í„° ì „ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸
- ì¶”ë¡  ë¡œì§ êµ¬í˜„
- ëª¨ë¸ í•™ìŠµ ë° í‰ê°€
- Interface Specification ë¬¸ì„œ ì‘ì„±

**ì‚°ì¶œë¬¼:**
- Python ëª¨ë“ˆ (ë…ë¦½ ì‹¤í–‰ ê°€ëŠ¥)
- í•™ìŠµëœ ëª¨ë¸ íŒŒì¼ (.pth, .h5 ë“±)
- Interface Specification ë¬¸ì„œ
- requirements.txt
- Dockerfile (AI í™˜ê²½)

---

### 3. **Backend Serving íŒ€** (íƒ€ íŒ€ì› ë‹´ë‹¹)

**ì±…ì„ ë²”ìœ„:**
- Flask API ì„œë²„ êµ¬í˜„
- AI ëª¨ë¸ í˜¸ì¶œ ë° ê²°ê³¼ ë°˜í™˜
- RabbitMQ Queue ì²˜ë¦¬
- Djangoì™€ì˜ REST API í†µì‹ 

**ì‚°ì¶œë¬¼:**
- Flask ì„œë²„ ì½”ë“œ
- API ì—”ë“œí¬ì¸íŠ¸ ëª…ì„¸ì„œ
- Docker ì»¨í…Œì´ë„ˆ

---

### 4. **Frontend íŒ€** (íƒ€ íŒ€ì› ë‹´ë‹¹)

**ì±…ì„ ë²”ìœ„:**
- React Web UI (ì˜ë£Œì§„ìš©)
- Flutter Mobile App (í™˜ììš©)
- Django API ì—°ë™

**ì‚°ì¶œë¬¼:**
- React ì»´í¬ë„ŒíŠ¸
- Flutter ì•±
- UI/UX ë¬¸ì„œ

---

### 5. **Backend Infrastructure íŒ€** (í˜„ì¬ êµ¬ì¶• ì™„ë£Œ)

**ì±…ì„ ë²”ìœ„:**
- Django REST API (UC01~UC06)
- MySQL ë°ì´í„°ë² ì´ìŠ¤
- OpenEMR, Orthanc, HAPI FHIR ì—°ë™

**í˜„ì¬ ìƒíƒœ:** âœ… êµ¬ì¶• ì™„ë£Œ (Week 4)

---

## ğŸ“… ê°œë°œ ì¼ì • ì „ëµ

### Phase 1: ë…ë¦½ ê°œë°œ (í˜„ì¬ ë‹¨ê³„)
**ê¸°ê°„:** Week 5 ~ Week 12

ê° íŒ€ì€ ìì‹ ì˜ ì˜ì—­ì—ë§Œ ì§‘ì¤‘í•˜ì—¬ ê°œë°œí•©ë‹ˆë‹¤.

```
Django Backend   â†’ ë°ì´í„° ì¶©ëŒ ì—†ëŠ” CRUD, ë™ì‹œì„± ì œì–´
AI ì½”ì–´ íŒ€       â†’ ëª¨ë¸ ê°œë°œ + ì „ì²˜ë¦¬ + ì¶”ë¡  ë¡œì§
Backend Serving  â†’ Flask API + Queue ì²˜ë¦¬
Frontend íŒ€      â†’ React UI + Flutter App
```

**í•µì‹¬ ì›ì¹™:**
- ğŸ”’ **íƒ€ íŒ€ ì½”ë“œì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ**
- ğŸ”’ **ë…ë¦½ ì‹¤í–‰ ê°€ëŠ¥í•œ ëª¨ë“ˆ ê°œë°œ**
- ğŸ”’ **Mock Dataë¡œ í…ŒìŠ¤íŠ¸**

---

### Phase 2: Interface Specification ì‘ì„±
**ê¸°ê°„:** Week 13

ê° íŒ€ì€ ìì‹ ì˜ ëª¨ë“ˆì„ ë‹¤ë¥¸ íŒ€ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ **ì—°ë™ ëª…ì„¸ì„œ**ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

**Django Backend íŒ€ì˜ ëª…ì„¸ì„œ í•­ëª©:**
1. REST API Specification (ì—”ë“œí¬ì¸íŠ¸, Request/Response)
2. Database Schema (ERD, í…Œì´ë¸” ì •ì˜)
3. Transaction Policy (Isolation Level, Locking Strategy)
4. Error Handling (HTTP Status Code, Error Format)
5. Performance Metrics (ì‘ë‹µ ì‹œê°„, TPS)

---

### Phase 3: í†µí•© ë° í…ŒìŠ¤íŠ¸
**ê¸°ê°„:** Week 14 ~ Week 15

Interface Specificationì„ ê¸°ë°˜ìœ¼ë¡œ ê° ëª¨ë“ˆì„ í†µí•©í•©ë‹ˆë‹¤.

```
Django â†’ RabbitMQ â†’ Flask AI Server â†’ AI ëª¨ë¸
                         â†“
                     ì¶”ë¡  ê²°ê³¼
                         â†“
                    Django DB ì €ì¥
```

---

### Phase 4: ìµœì¢… ë°°í¬
**ê¸°ê°„:** Week 16

ì „ì²´ ì‹œìŠ¤í…œ í†µí•© í…ŒìŠ¤íŠ¸ ë° ë°°í¬

---

## ğŸ”§ Django Backend ê°œë°œ ê°€ì´ë“œ

### ê°œë°œ ì›ì¹™

1. **ì•ˆì „í•œ CRUD (Concurrency-Safe CRUD)**
   - Optimistic Locking: version í•„ë“œ í™œìš©
   - Pessimistic Locking: select_for_update() í™œìš©
   - Transaction Isolation Level ê´€ë¦¬

2. **ë°ì´í„° ì •í•©ì„± (Data Consistency)**
   - Write-Through íŒ¨í„´ (FHIR Adapter)
   - Parallel Dual-Write íŒ¨í„´ (OpenEMR + Django DB)
   - Transaction ë³´ì¥

3. **ë™ì‹œì„± ì œì–´ (Concurrency Control)**
   - Race Condition ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
   - Idempotency ë³´ì¥ (ë©±ë“±ì„± íŒ¨í„´)
   - select_for_update() í™œìš©

4. **í…ŒìŠ¤íŠ¸ ì£¼ë„ ê°œë°œ (Test-Driven Development)**
   - pytestë¡œ ëª¨ë“  ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
   - ë™ì‹œì„± í…ŒìŠ¤íŠ¸ ì‘ì„±
   - Mock Data í™œìš©

---

### ë””ë ‰í† ë¦¬ êµ¬ì¡° (Django Backend)

```
NeuroNova_v1/
â”œâ”€â”€ NeuroNova_02_back_end/
â”‚   â””â”€â”€ 01_django_server/
â”‚       â”œâ”€â”€ acct/                        # UC01: ì¸ì¦/ê¶Œí•œ
â”‚       â”‚   â”œâ”€â”€ models.py                # Custom User, 7ê°œ ì—­í• 
â”‚       â”‚   â”œâ”€â”€ views.py                 # JWT ì¸ì¦ API
â”‚       â”‚   â”œâ”€â”€ permissions.py           # 10ê°œ Permission í´ë˜ìŠ¤
â”‚       â”‚   â””â”€â”€ services.py              # AuthService, UserService
â”‚       â”œâ”€â”€ emr/                         # UC02: EMR í”„ë¡ì‹œ
â”‚       â”‚   â”œâ”€â”€ models.py                # PatientCache, Encounter, Order, OrderItem
â”‚       â”‚   â”œâ”€â”€ viewsets.py              # DRF ViewSets (CRUD)
â”‚       â”‚   â”œâ”€â”€ services.py              # Service ë ˆì´ì–´
â”‚       â”‚   â”œâ”€â”€ repositories.py          # Repository ë ˆì´ì–´
â”‚       â”‚   â”œâ”€â”€ openemr_client.py        # OpenEMR API í´ë¼ì´ì–¸íŠ¸
â”‚       â”‚   â”œâ”€â”€ fhir_adapter.py          # FHIR Write-Through íŒ¨í„´
â”‚       â”‚   â””â”€â”€ tests/
â”‚       â”‚       â”œâ”€â”€ test_write_through.py
â”‚       â”‚       â””â”€â”€ test_concurrency.py
â”‚       â”œâ”€â”€ ris/                         # UC05: ì˜ìƒì˜í•™
â”‚       â”‚   â”œâ”€â”€ models.py                # RadiologyOrder, Study, Report
â”‚       â”‚   â””â”€â”€ views.py                 # Orthanc ì—°ë™ API
â”‚       â”œâ”€â”€ ai/                          # UC06: AI Queue
â”‚       â”‚   â”œâ”€â”€ models.py                # AIJob
â”‚       â”‚   â””â”€â”€ queue_client.py          # RabbitMQ í´ë¼ì´ì–¸íŠ¸
â”‚       â”œâ”€â”€ requirements.txt             # Python ì˜ì¡´ì„±
â”‚       â””â”€â”€ manage.py
```

---

## ğŸ“ Django Backend ê°œë°œ ì›Œí¬í”Œë¡œìš°

### Step 1: ë°ì´í„° ì¶©ëŒ ë°©ì§€ íŒ¨í„´ êµ¬í˜„
```bash
cd NeuroNova_02_back_end/01_django_server

# Optimistic Locking êµ¬í˜„
# 1. ëª¨ë¸ì— version í•„ë“œ ì¶”ê°€
# 2. ViewSetì—ì„œ version ê²€ì¦
# 3. version ë¶ˆì¼ì¹˜ ì‹œ 409 Conflict ë°˜í™˜

# Pessimistic Locking êµ¬í˜„
# 1. select_for_update() í™œìš©
# 2. Transaction ë‚´ì—ì„œ ì²˜ë¦¬
# 3. ë™ì‹œì„± í…ŒìŠ¤íŠ¸ ì‘ì„±
```

### Step 2: Transaction Isolation Level ì„¤ì •
```bash
# settings.pyì—ì„œ Isolation Level ì„¤ì •
# MySQL ê¸°ë³¸ê°’: REPEATABLE READ
# í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: READ UNCOMMITTED, READ COMMITTED, SERIALIZABLE
```

### Step 3: ë™ì‹œì„± í…ŒìŠ¤íŠ¸ ì‘ì„±
```bash
# emr/tests/test_concurrency.py ì‘ì„±
pytest emr/tests/test_concurrency.py -v
```

### Step 4: ë¬¸ì„œí™”
```bash
# API ëª…ì„¸ì„œ ì—…ë°ì´íŠ¸ (08_API_ëª…ì„¸ì„œ.md)
# DB ìŠ¤í‚¤ë§ˆ ì—…ë°ì´íŠ¸ (09_ë°ì´í„°ë² ì´ìŠ¤_ìŠ¤í‚¤ë§ˆ.md)
# LOG_ì‘ì—…ì´ë ¥.md ì—…ë°ì´íŠ¸
```

---

## ğŸ”’ ë³´ì•ˆ ë° ê·œì¹™

1. **Django ì¤‘ì•™ ì¸ì¦ ì •ì±…**
   - ëª¨ë“  ì™¸ë¶€ ì‹œìŠ¤í…œ ì ‘ê·¼ì€ Djangoë¥¼ ê²½ìœ 
   - RBAC (7ê°œ ì—­í• ) ê¸°ë°˜ ê¶Œí•œ ì œì–´

2. **í™˜ê²½ ë³€ìˆ˜ ì‚¬ìš©**
   - DB ì ‘ì† ì •ë³´, API í‚¤ ë“±ì€ .env íŒŒì¼ë¡œ ê´€ë¦¬

3. **ë¡œê¹… í•„ìˆ˜**
   - ëª¨ë“  CRUD ìš”ì²­ê³¼ ê²°ê³¼ë¥¼ ë¡œê·¸ë¡œ ê¸°ë¡
   - AuditLog ëª¨ë¸ í™œìš© (UC09)

4. **ë²„ì „ ê´€ë¦¬**
   - Migration íŒŒì¼ ë²„ì „ ê´€ë¦¬
   - API ë²„ì „ ëª…ì‹œ (v1, v2 ë“±)

---

## ğŸ“Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

Django Backend ê°œë°œ ì™„ë£Œ ì‹œ ë‹¤ìŒ í•­ëª©ì„ í™•ì¸í•˜ì„¸ìš”:

- [ ] Optimistic Locking êµ¬í˜„ ì™„ë£Œ (version í•„ë“œ)
- [ ] Pessimistic Locking êµ¬í˜„ ì™„ë£Œ (select_for_update)
- [ ] Transaction Isolation Level ì„¤ì • ì™„ë£Œ
- [ ] Idempotency ë³´ì¥ (ë©±ë“±ì„± íŒ¨í„´)
- [ ] Race Condition ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] ë™ì‹œì„± í…ŒìŠ¤íŠ¸ ì‘ì„± (pytest)
- [ ] API ëª…ì„¸ì„œ ì—…ë°ì´íŠ¸
- [ ] DB ìŠ¤í‚¤ë§ˆ ë¬¸ì„œí™”
- [ ] LOG_ì‘ì—…ì´ë ¥.md ì—…ë°ì´íŠ¸

---

## ğŸ¯ Django Backend ê°œë°œ ì°¸ê³  ìë£Œ

### Django ê³µì‹ ë¬¸ì„œ
- [Django Database Transactions](https://docs.djangoproject.com/en/4.2/topics/db/transactions/)
- [select_for_update()](https://docs.djangoproject.com/en/4.2/ref/models/querysets/#select-for-update)
- [Transaction Isolation Levels](https://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-isolation-levels.html)

### ë™ì‹œì„± íŒ¨í„´
- Optimistic Locking: version í•„ë“œ í™œìš©
- Pessimistic Locking: select_for_update() í™œìš©
- Idempotency: ë©±ë“±ì„± ë³´ì¥ (Idempotency Key)
- Write-Through: FHIR Adapter í™œìš©
- Parallel Dual-Write: OpenEMR + Django DB ë…ë¦½ ë³‘ë ¬ ì „ì†¡

---

**ìµœì¢… ìˆ˜ì •ì¼**: 2025-12-24
**ì‘ì„±ì**: Claude AI
**ë²„ì „**: 2.0 (Django Backend ê°œë°œììš©)
