# CDSS 시스템 개발 업무 계획서

**작성일**: 2025-12-19
**프로젝트명**: Clinical Decision Support System (CDSS)
**아키텍처**: Django Backend + React/Flutter Frontend + 외부 시스템 통합

---

## 목차
1. [프로젝트 개요](#1-프로젝트-개요)
2. [기술 스택별 업무 분류](#2-기술-스택별-업무-분류)
3. [외부 상용 서버 확인 사항](#3-외부-상용-서버-확인-사항)
4. [팀별 작업 범위](#4-팀별-작업-범위)
5. [개발 일정 및 우선순위](#5-개발-일정-및-우선순위)
6. [위험 요소 및 대응 방안](#6-위험-요소-및-대응-방안)

---

## 1. 프로젝트 개요

### 1.1 시스템 구성
```
┌─────────────────────────────────────────────────────────────┐
│                     Frontend Layer                          │
│  ┌──────────────────┐        ┌──────────────────┐          │
│  │  React Web App   │        │  Flutter Mobile  │          │
│  └─────────┬────────┘        └────────┬─────────┘          │
└────────────┼──────────────────────────┼─────────────────────┘
             │                          │
             └──────────┬───────────────┘
                        │ REST API
┌───────────────────────┼─────────────────────────────────────┐
│                Django Backend (CDSS Core)                    │
│  ┌─────────┬─────────┬─────────┬─────────┬─────────────┐   │
│  │  ACCT   │   EMR   │   OCS   │   LIS   │     RIS     │   │
│  │  (UC1)  │  (UC2)  │  (UC3)  │  (UC4)  │    (UC5)    │   │
│  └─────────┴─────────┴─────────┴─────────┴─────────────┘   │
│  ┌─────────┬─────────┬─────────┬─────────────────────────┐ │
│  │   AI    │  ALERT  │  FHIR   │        AUDIT            │ │
│  │  (UC6)  │  (UC7)  │  (UC8)  │        (UC9)            │ │
│  └─────────┴─────────┴─────────┴─────────────────────────┘ │
└───────────────────────┬─────────────────────────────────────┘
                        │
        ┌───────────────┼───────────────┬─────────────┐
        │               │               │             │
┌───────▼───────┐ ┌────▼────┐ ┌────────▼────────┐ ┌─▼──────┐
│  MySQL/       │ │ OpenEMR │ │    Orthanc      │ │  HAPI  │
│  MariaDB      │ │ (상용)   │ │    (상용)        │ │  FHIR  │
│  (자체 구축)   │ │         │ │                 │ │ (상용)  │
└───────────────┘ └─────────┘ └─────────────────┘ └────────┘
```

### 1.2 Use Case 모듈 (총 9개)
| UC | 모듈명 | 설명 | 외부 시스템 연동 |
|---|---|---|---|
| UC1 | ACCT | 인증/권한 관리 | - |
| UC2 | EMR | 전자의무기록 프록시 | OpenEMR (상용) |
| UC3 | OCS | 처방전달시스템 | - |
| UC4 | LIS | 임상병리정보시스템 | - |
| UC5 | RIS | 영상의학정보시스템 | Orthanc (상용) |
| UC6 | AI | AI 오케스트레이션 | AI Model Server |
| UC7 | ALERT | 타임라인/알림 | - |
| UC8 | FHIR | 의료정보 교환 | HAPI FHIR (상용) |
| UC9 | AUDIT | 감사/보안 로그 | - |

### 1.3 역할 기반 접근 제어 (RBAC) 정의

시스템은 7개의 역할(Role)로 구성되며, 각 역할은 명확한 권한 레벨과 데이터 접근 범위를 가집니다.

| 역할 | 구분 | 권한 레벨 | 데이터 접근 범위 | 주요 업무 및 책임 |
|---|---|---|---|---|
| **Admin** | 관리자 | Full Access | System All | • 시스템 전체 관리 및 설정<br>• 계정 생성/삭제 및 권한 부여 |
| **Doctor** | 신경외과 의사 | All (Clinical) | Django, Custom, EMR | • 환자 진료 및 처방<br>• AI 분석 결과(MRI/Omics) 최종 검증 및 확정 |
| **RIB** | 방사선과 | C/R/U | DICOM | • MRI/CT 등 의료 영상 데이터 업로드 및 관리<br>• 영상 정합성 1차 확인 |
| **Lab** | 검사실 | C/R/U | Lab EMR | • 혈액/단백질 검사 데이터 입력<br>• 검체 분석 결과 관리 |
| **Nurse** | 간호사 | R, Limited C/U | Vitals, Notes | • 기초 바이탈 측정 및 입력<br>• 간호 기록(Nursing Note) 작성 (처방 불가) |
| **Patient** | 일반 환자 | R (Self), C/U | Profile, Reservation | • 본인 진료 내역 조회<br>• 예약 및 문진표 작성 |
| **External** | 외부 기관 | API Access | Limited Scope | • FHIR API 연동 (M2M 인증)<br>• 허용된 Scope 내 데이터 전송/조회 |

#### 권한 레벨 설명
- **Full Access**: 모든 CRUD 작업 + 시스템 설정
- **All (Clinical)**: 모든 임상 데이터 접근 (환자 진료 관련)
- **C/R/U**: Create, Read, Update (Delete 제외)
- **R, Limited C/U**: Read 전체, Create/Update 제한적 허용
- **R (Self)**: 본인 데이터만 Read 가능
- **API Access**: REST/FHIR API를 통한 M2M 인증

#### 데이터 접근 범위 설명
- **System All**: 전체 시스템 및 데이터
- **Django, Custom, EMR**: Django DB + 커스텀 테이블 + OpenEMR 데이터
- **DICOM**: Orthanc 영상 데이터 (UC5 연동)
- **Lab EMR**: 검사실 데이터 (UC4 연동)
- **Vitals, Notes**: 바이탈 사인, 간호 기록
- **Profile, Reservation**: 환자 본인 프로필, 예약
- **Limited Scope**: FHIR API에서 정의된 리소스만

---

## 2. 기술 스택별 업무 분류

### 2.1 Frontend - React Web (의료진 및 관리자용)

#### 담당 범위
- **대상 사용자**: **7개 역할 전체** (Admin, Doctor, RIB, Lab, Nurse, Patient, External)
- **주요 화면**: 환자 검색, 처방 입력, 영상 판독, AI 결과 확인, 타임라인 대시보드
- **배포 환경**: 데스크톱 브라우저 (Chrome, Edge, Firefox)

#### 역할별 UI 접근 제어
| 역할 | 접근 가능한 주요 화면 | 제한 사항 |
|---|---|---|
| **Admin** | 전체 화면 + 관리자 패널 (계정 관리, 권한 설정, 시스템 모니터링) | 없음 |
| **Doctor** | 환자 조회, 처방 입력, AI 결과 검증, 영상 판독, 판독문 서명 | 시스템 설정 불가 |
| **RIB** | 영상 업로드, DICOM Viewer, Study 관리, 영상 정합성 확인 | 처방 및 진료 기록 작성 불가 |
| **Lab** | 검사 오더 조회, 검사 결과 입력, 이상치 확인 | 처방 및 영상 접근 불가 |
| **Nurse** | 환자 바이탈 입력, 간호 기록 작성, 알림 조회 | 처방 입력 및 AI 결과 수정 불가 |
| **Patient** | 본인 진료 내역 조회, 예약, 문진표 작성 | 타인 데이터 접근 불가 |
| **External** | FHIR API 대시보드 (연동 상태, 전송 이력) | FHIR 관련 화면만 접근 |

#### 개발 업무
1. **인증/권한 (UC1 연동)**
   - 로그인/로그아웃 페이지
   - JWT 토큰 관리 (Access Token + Refresh Token)
   - 역할 기반 UI 제어 (RBAC)
     - 역할별 메뉴 동적 렌더링
     - 버튼/필드 레벨 권한 체크
     - 7개 역할 (Admin, Doctor, RIB, Lab, Nurse, Patient, External)
   - MFA(다중 인증) UI

2. **환자 정보 조회 (UC2 연동)**
   - 환자 검색 (이름, ID, 생년월일)
   - 환자 상세 프로필
   - 환자 요약 카드 (통합 뷰)
   - 과거 진료 기록 타임라인

3. **처방 관리 (UC3 연동)**
   - 처방 오더 입력 폼
   - 처방 전달 상태 추적
   - 처방 이력 조회

4. **검사 결과 조회 (UC4 연동)**
   - 임상병리 검사 결과 테이블
   - 검사 결과 그래프/차트
   - 이상치 하이라이트

5. **영상의학 (UC5 연동)**
   - 영상 검사 오더 생성
   - DICOM Viewer 통합 (Orthanc 연동)
   - 판독문 작성/서명
   - AI 분석 결과 오버레이

6. **AI 결과 대시보드 (UC6 연동)**
   - AI Job 제출 버튼
   - 실시간 처리 상태 표시
   - AI 결과 시각화 (Heatmap, Segmentation)
   - 신뢰도 지표 표시

7. **타임라인 & 알림 (UC7 연동)**
   - 환자별 이벤트 타임라인
   - 실시간 알림 팝업 (WebSocket)
   - 알림 필터링 및 읽음 처리

8. **감사 로그 뷰어 (UC9 연동, 관리자용)**
   - 사용자 활동 로그 검색
   - 보안 이벤트 알림
   - 로그 필터링 및 내보내기

#### 기술 스택 (확정)
- **Framework**: React 18+
- **언어**: **TypeScript 5.x** (타입 안정성, 역할 기반 타입 정의)
- **상태 관리**: **Zustand** (경량, 간단한 API, 역할별 스토어 분리)
- **스타일링**: **Tailwind CSS 3.x** (유틸리티 우선, 빠른 개발, 일관된 디자인)
- **UI 컴포넌트**:
  - **shadcn/ui** (Tailwind 기반, 커스터마이징 용이)
  - Headless UI (접근성 향상)
- **폼 관리**: React Hook Form + Zod (타입 안전 검증)
- **API 통신**: Axios (TypeScript 타입 정의)
- **실시간 통신**: native WebSocket (Django Channels 연동)
- **차트**: Recharts (TypeScript 지원)
- **DICOM Viewer**: Cornerstone.js (Orthanc 연동용)
- **날짜/시간**: date-fns (경량, Tree-shaking)
- **테스트**: Vitest, React Testing Library, Playwright (E2E)

#### TypeScript 활용
```typescript
// 역할 기반 타입 정의
type UserRole = 'admin' | 'doctor' | 'rib' | 'lab' | 'nurse' | 'patient' | 'external';

interface User {
  id: string;
  username: string;
  role: UserRole;
  permissions: string[];
  email?: string;
  employeeId?: string;
  department?: string;
}

interface AuthState {
  user: User | null;
  token: string | null;
  isAuthenticated: boolean;
}

// API 응답 타입
interface ApiResponse<T> {
  data: T;
  message?: string;
  status: number;
}

// 역할별 권한 체크
type Permission =
  | 'patient.view'
  | 'patient.edit'
  | 'order.create'
  | 'report.sign'
  | 'ai_result.approve';
```

#### Tailwind CSS 활용
```javascript
// tailwind.config.js
module.exports = {
  theme: {
    extend: {
      colors: {
        // 역할별 테마 색상
        admin: '#DC2626',      // Red
        doctor: '#2563EB',     // Blue
        rib: '#7C3AED',        // Purple
        lab: '#059669',        // Green
        nurse: '#DB2777',      // Pink
        patient: '#EA580C',    // Orange
        external: '#64748B',   // Gray
      },
    },
  },
  plugins: [
    require('@tailwindcss/forms'),
    require('@tailwindcss/typography'),
  ],
};
```

**디자인 시스템**:
- 역할별 배지 색상 통일
- 일관된 간격 (spacing scale)
- 반응형 디자인 (의료진용 데스크톱 최적화)
- 다크 모드 지원 (야간 근무 고려)

#### Zustand 스토어 구조
```typescript
// stores/authStore.ts
interface AuthStore {
  user: User | null;
  token: string | null;
  login: (username: string, password: string) => Promise<void>;
  logout: () => void;
  refreshToken: () => Promise<void>;
  checkPermission: (permission: Permission) => boolean;
}

export const useAuthStore = create<AuthStore>((set, get) => ({
  user: null,
  token: localStorage.getItem('token'),
  login: async (username, password) => {
    const response = await api.post('/acct/login/', { username, password });
    set({ user: response.data.user, token: response.data.token });
    localStorage.setItem('token', response.data.token);
  },
  logout: () => {
    set({ user: null, token: null });
    localStorage.removeItem('token');
  },
  refreshToken: async () => {
    // Refresh token logic
  },
  checkPermission: (permission) => {
    const { user } = get();
    return user?.permissions.includes(permission) ?? false;
  },
}));

// stores/patientStore.ts (Doctor, Nurse 전용)
interface PatientStore {
  patients: Patient[];
  selectedPatient: Patient | null;
  fetchPatients: () => Promise<void>;
  selectPatient: (id: string) => void;
}

// stores/alertStore.ts (전체 역할)
interface AlertStore {
  alerts: Alert[];
  unreadCount: number;
  fetchAlerts: () => Promise<void>;
  markAsRead: (id: string) => Promise<void>;
  subscribeToAlerts: () => void; // WebSocket
}
```

#### 확인 필요 사항
- [ ] DICOM Viewer 라이브러리 선택 (Cornerstone.js vs OHIF Viewer)
- [ ] shadcn/ui 컴포넌트 커스터마이징 범위
- [ ] TypeScript strict mode 적용 범위
- [ ] 브라우저 호환성 (Chrome, Edge, Firefox)

---

### 2.2 Frontend - Flutter Mobile (환자 전용 앱)

#### 담당 범위
- **대상 사용자**: **Patient 역할만** (일반 환자)
- **주요 기능**: 본인 진료 내역 조회, 예약, 알림 수신, 문진표 작성
- **배포 환경**: iOS App Store, Google Play Store

#### 설계 철학
- **Self Access Only**: 환자 본인의 데이터만 조회 가능
- **제한적 기능**: 진료 기록 생성/수정 불가 (조회만 가능)
- **모바일 최적화**: 간소화된 UI, 빠른 로딩, 오프라인 캐싱

#### 개발 업무
1. **인증 (UC1 연동)**
   - 모바일 로그인 (환자 계정)
   - 생체 인증 (지문, Face ID)
   - 자동 로그인 (리프레시 토큰)
   - 푸시 알림 토큰 관리
   - **역할 고정**: Patient 역할만 허용

2. **본인 진료 내역 조회 (UC2 연동)**
   - 환자 본인 프로필 조회
   - 과거 진료 기록 타임라인
   - 처방 내역 조회 (읽기 전용)
   - 검사 결과 조회 (읽기 전용)
   - **필터링**: Self Access (본인 데이터만)

3. **예약 및 문진표 (UC2 연동)**
   - 진료 예약 신청
   - 예약 내역 조회/취소
   - 사전 문진표 작성
   - 건강 체크리스트 제출

4. **알림 (UC7 연동)**
   - 푸시 알림 수신 (FCM)
   - 알림 목록 조회
   - 알림 읽음 처리
   - 중요 알림 (진료 일정, 검사 결과) 우선 표시

5. **본인 영상 조회 (UC5, 읽기 전용)**
   - 본인 영상 검사 목록
   - 간단한 이미지 뷰어 (DICOM 썸네일)
   - 판독문 조회 (의사가 작성한 소견)
   - **제한**: 영상 업로드 불가, 수정 불가

#### 기술 스택
- **Framework**: Flutter 3.x
- **상태 관리**: Provider or Riverpod
- **네트워킹**: Dio (HTTP client)
- **푸시 알림**: Firebase Cloud Messaging (FCM)
- **로컬 저장소**: SharedPreferences, Hive
- **이미지 처리**: flutter_image, cached_network_image

#### 확인 필요 사항
- [ ] iOS/Android 배포 환경 (App Store, Google Play 등록)
- [ ] 푸시 알림 인프라 (FCM vs APNs vs 자체 구축)
- [ ] DICOM 렌더링 성능 (모바일 최적화, 썸네일 크기)
- [ ] 환자 인증 방식 (주민번호, 휴대폰 인증, 공인인증서)
- [ ] 개인정보 보호 정책 (앱 내 표시, 동의 절차)
- [ ] Patient 역할 외 로그인 시도 차단 정책

#### Patient 역할 전용 설계 고려사항
- **로그인 제한**: 다른 역할(Admin, Doctor 등)이 Flutter 앱으로 로그인 시도 시 에러 메시지 표시
- **UI 간소화**: 의료진용 복잡한 기능 제외, 환자 친화적 UI/UX
- **보안 강화**: 생체 인증 필수, 자동 로그아웃 (5분 무활동)
- **접근성**: 고령 환자 고려 (큰 글씨, 간단한 네비게이션)

---

### 2.3 Backend - Django REST API

#### 담당 범위
- **핵심 역할**: 비즈니스 로직, 데이터 관리, 외부 시스템 통합
- **아키텍처**: 7-Layer Architecture (Controller → Service → Repository/Client)

#### 개발 업무 (UC별)

**UC1 - ACCT (인증/권한)**
- User, Role, Permission 모델 구현
  - 7개 역할 정의: Admin, Doctor, RIB, Lab, Nurse, Patient, External
  - 역할별 권한 레벨 설정 (Full Access, All Clinical, C/R/U, R Limited C/U, R Self, API Access)
  - 데이터 접근 범위 제어 (System All, Django/EMR, DICOM, Lab EMR, Vitals/Notes, Profile/Reservation, Limited Scope)
- JWT 토큰 발급/검증 (djangorestframework-simplejwt)
  - 토큰 페이로드에 역할(role) 및 권한(permissions) 포함
  - 역할별 토큰 만료 시간 차등 적용 (Admin: 30분, 일반: 15분)
- Refresh Token Rotation
- 무차별 대입 공격 방어 (5회 실패 시 계정 잠금)
- RBAC 권한 체크 미들웨어
  - 엔드포인트별 필요 권한 정의 (Decorator/Permission Class)
  - 역할 기반 자동 필터링 (Doctor는 전체, Nurse는 제한적 조회)
- MFA (TOTP) 구현
- 역할별 API 제한
  - External: FHIR API만 접근, Rate Limiting 강화
  - Patient: 본인 데이터만 조회 (Self Access)

**UC2 - EMR (OpenEMR 프록시)**
- OpenEMR REST API Client 구현
- 환자 데이터 캐싱 (Cache-Aside 패턴)
- 데이터 동기화 스케줄러 (Celery Beat)
- ID 매핑 테이블 관리

**UC3 - OCS (처방전달)**
- 처방 오더 CRUD
- 처방 상태 관리 (PENDING → APPROVED → TRANSMITTED)
- 처방 이력 추적

**UC4 - LIS (임상병리)**
- 검사 오더 관리
- 검사 결과 데이터 저장
- 이상치 자동 감지 알고리즘

**UC5 - RIS (영상의학)**
- Radiology Order/Study 관리
- Orthanc DICOM 서버 연동 (DICOMweb)
- 판독문 작성/서명 워크플로우
- AI 자동 트리거 (특정 Modality)
- DICOM 메타데이터 파싱

**UC6 - AI (오케스트레이션)**
- AI Job 큐 관리
- AI 서버 REST API 호출
- 비동기 폴링 (Celery Worker)
- AI 결과 저장 (분류, 메트릭, Artifact)
- S3/MinIO 파일 관리

**UC7 - ALERT (타임라인/알림)**
- 이벤트 발행 시스템 (Event Sourcing)
- 사용자별 알림 필터링
- WebSocket 서버 (Django Channels)
- 알림 읽음/삭제 처리

**UC8 - FHIR (의료정보 교환)**
- CDSS → FHIR 리소스 변환
- HAPI FHIR 서버 연동
- Change Data Capture (CDC)
- 전송 큐 관리 (Retry Logic)
- 리소스 매핑 테이블

**UC9 - AUDIT (감사/보안)**
- 모든 액션 로깅 (AuditLogMiddleware)
- 보안 이벤트 감지
- 로그 검색 API
- 개인정보 접근 추적

#### 기술 스택
- **Framework**: Django 4.2+ (LTS)
- **REST API**: Django REST Framework (DRF)
- **인증**: djangorestframework-simplejwt
- **비동기 작업**: Celery + Redis (Message Broker)
- **WebSocket**: Django Channels + Redis (Channel Layer)
- **ORM**: Django ORM
- **마이그레이션**: Django Migrations
- **검증**: Django Validators + DRF Serializers
- **테스트**: pytest-django

#### 기술 스택 (확정)
- **Framework**: Django 4.2 LTS
- **REST API**: Django REST Framework (DRF)
- **인증**: djangorestframework-simplejwt
- **비동기 작업**: Celery + **RabbitMQ** (Message Broker)
- **WebSocket**: Django Channels + Redis (Channel Layer)
- **ORM**: Django ORM
- **마이그레이션**: Django Migrations
- **검증**: Django Validators + DRF Serializers
- **테스트**: pytest-django
- **Metrics**: django-prometheus

#### 확인 필요 사항
- [ ] RabbitMQ 클러스터 구성 (HA)
- [ ] Celery Worker 수 (AI Queue vs FHIR Queue)
- [ ] WebSocket 동시 연결 수 제한
- [ ] API 버전 관리 전략 (URL path vs Header)

---

### 2.4 Database - MySQL/MariaDB

#### 담당 범위
- **데이터베이스 설계**: ERD 구현, 인덱싱, 성능 최적화
- **주요 스키마**: CDSS_DB (메인 데이터베이스)

#### 개발 업무

**1. 스키마 구현**
- `ACCT_*` 테이블 (사용자, 역할, 권한)
  - `ACCT_USERS`: 사용자 기본 정보
  - `ACCT_ROLES`: 역할 정의 (7개: Admin, Doctor, RIB, Lab, Nurse, Patient, External)
  - `ACCT_PERMISSIONS`: 권한 정의 (permKey 기반)
  - `ACCT_USER_ROLES`: 사용자-역할 매핑 (N:M)
  - `ACCT_ROLE_PERMS`: 역할-권한 매핑 (N:M)
  - `ACCT_REFRESH_TOKENS`: 리프레시 토큰
  - `ACCT_MFA_SECRETS`: MFA 시크릿
- `EMR_*` 테이블 (환자 캐시, ID 매핑)
- `RADIOLOGY_*` 테이블 (오더, 스터디, 판독문)
- `AI_*` 테이블 (Job, Result, Artifact)
- `TIMELINE_*` 테이블 (이벤트, 알림)
- `FHIR_*` 테이블 (리소스 매핑, 전송 큐)
- `AUDIT_*` 테이블 (감사 로그, 보안 이벤트)
  - `AUDIT_LOGS`: 모든 사용자 액션 기록 (역할별 필터링 가능)
  - `SECURITY_EVENTS`: 보안 이벤트 (역할별 비정상 행위 추적)

**2. 인덱싱 전략**
```sql
-- 자주 조회되는 컬럼
CREATE INDEX idx_patient_name ON EMR_PATIENT_CACHE(family_name, given_name);
CREATE INDEX idx_order_status ON RADIOLOGY_ORDERS(order_status, created_at);
CREATE INDEX idx_audit_user_action ON AUDIT_LOGS(actor_user_id, action, created_at);

-- 복합 인덱스
CREATE INDEX idx_user_role ON ACCT_USER_ROLES(user_id, role_key);
CREATE INDEX idx_ai_job_status ON AI_JOBS(job_status, created_at);
```

**3. 파티셔닝 (대용량 테이블)**
```sql
-- AUDIT_LOGS: 월별 파티셔닝
ALTER TABLE AUDIT_LOGS PARTITION BY RANGE (YEAR(created_at) * 100 + MONTH(created_at));

-- TIMELINE_EVENTS: 연도별 파티셔닝
ALTER TABLE TIMELINE_EVENTS PARTITION BY RANGE (YEAR(event_time));
```

**4. 백업/복구 전략**
- 일일 Full Backup
- 시간별 Incremental Backup
- Point-in-Time Recovery (PITR) 설정

**5. 레플리케이션**
- Master-Slave 구조 (읽기 분산)
- 읽기 전용 Replica 2대

#### 기술 스택
- **DBMS**: MySQL 8.0+ or MariaDB 10.11+
- **마이그레이션**: Django Migrations
- **백업**: mysqldump or Percona XtraBackup
- **모니터링**: MySQL Workbench, Percona Monitoring

#### 확인 필요 사항
- [ ] MySQL vs MariaDB 선택
- [ ] 스토리지 엔진 (InnoDB 확정)
- [ ] 문자셋 (utf8mb4 권장)
- [ ] 타임존 설정 (UTC vs KST)
- [ ] 백업 보관 주기 (법적 요구사항 확인)

---

### 2.5 Infrastructure & DevOps

#### 담당 범위
- **컨테이너화**: Docker 기반 배포
- **오케스트레이션**: Docker Compose (단일 서버) 또는 Kubernetes (확장 시)
- **보안**: Cloudflare + Nginx HTTPS
- **모니터링**: Prometheus + Grafana + Alertmanager

#### 주요 컴포넌트

**1. Docker 컨테이너 구성**
- `nginx`: Reverse Proxy + Static File Serving
- `django-api`: Django REST API (Gunicorn)
- `django-channels`: WebSocket Server (Daphne)
- `celery-worker`: 비동기 작업 처리
- `celery-beat`: 주기적 작업 스케줄러
- `ai-server`: Flask AI 서버 (GPU)
- `rabbitmq`: 메시지 브로커
- `mysql`: 메인 데이터베이스
- `redis`: 캐시 + Session + Channel Layer
- `minio`: S3 호환 객체 스토리지 (AI Artifacts)
- `prometheus`: 메트릭 수집
- `grafana`: 모니터링 대시보드
- `alertmanager`: 알림 (Code Blue)

**2. 네트워크 구성**
```
Cloudflare (CDN + DDoS + SSL/TLS)
         ↓
Nginx (Reverse Proxy + Rate Limiting)
  ├─→ /api/*      → Django API
  ├─→ /ws/*       → Django Channels
  ├─→ /static/*   → React Build
  └─→ /fhir/*     → HAPI FHIR (상용)
```

**3. 비동기 메시징 (RabbitMQ)**
- **Queue 구조**:
  - `ai.job.create`: AI 추론 요청 (Django → AI Server)
  - `ai.job.poll`: AI 결과 폴링
  - `fhir.sync`: FHIR 리소스 동기화 (Django → HAPI FHIR)
  - `alert.send`: 실시간 알림 발송
- **Consumer**:
  - AI Server (Flask): AI Job Queue 처리
  - Celery Worker (Django): FHIR Sync Queue 처리

**4. 모니터링 (Observability)**
- **Prometheus**: 시계열 메트릭 수집
  - API RPS (Requests Per Second)
  - 응답 시간 (p50, p95, p99)
  - GPU 사용량 (nvidia_smi_exporter)
  - RabbitMQ Queue 깊이
- **Grafana**: 대시보드
  - System Overview
  - AI Inference Performance
  - FHIR Sync Status
- **Alertmanager**: Code Blue 알림
  - 5xx 에러율 > 5%
  - AI Job Queue Backlog > 100
  - DB 연결 풀 80% 이상

**5. 보안**
- **Cloudflare**:
  - SSL/TLS Termination (Universal SSL)
  - DDoS Protection (Layer 3/4/7)
  - WAF (SQL Injection, XSS 차단)
  - Rate Limiting (100 req/min per IP)
- **Nginx**:
  - Cloudflare Origin Certificate
  - Rate Limiting (10 req/s per endpoint)
  - CORS 헤더 설정

#### 기술 스택
- **Container**: Docker 24+, Docker Compose 2.x
- **Reverse Proxy**: Nginx (Alpine)
- **Message Broker**: RabbitMQ 3.x
- **Cache**: Redis 7.x
- **Object Storage**: MinIO (S3 Compatible)
- **Monitoring**: Prometheus 2.x, Grafana 10.x, Alertmanager 0.26+
- **CDN**: Cloudflare Free/Pro
- **CI/CD**: GitHub Actions

#### 확인 필요 사항
- [ ] GPU 서버 스펙 (NVIDIA GPU 필수)
- [ ] Docker Volume 저장소 용량 (AI 모델 + DICOM)
- [ ] Cloudflare 플랜 (Free vs Pro vs Business)
- [ ] SSL 인증서 갱신 자동화 (Let's Encrypt)
- [ ] RabbitMQ 클러스터링 필요 여부
- [ ] Kubernetes 마이그레이션 계획 (확장 시)

---

## 3. 외부 상용 서버 확인 사항

### 3.1 OpenEMR (전자의무기록 시스템)

#### 시스템 정보
- **용도**: 환자 기본 정보, 진료 기록, 과거 이력 조회
- **연동 방식**: REST API (읽기 전용)
- **관련 모듈**: UC2 (EMR Proxy)

#### 필수 확인 사항

**API 접근**
- [ ] OpenEMR API 엔드포인트 URL
  - 예: `https://emr.hospital.com/apis/default/api`
- [ ] API 버전 (FHIR vs Standard API)
- [ ] 인증 방식
  - OAuth 2.0 Client ID/Secret
  - 또는 API Key
- [ ] Rate Limiting 정책
  - 시간당 요청 제한
  - 동시 연결 제한

**데이터베이스 직접 접근**
- [ ] 읽기 전용 DB 계정 제공 여부
  - 호스트: `openemr-db.hospital.com:3306`
  - 사용자: `cdss_readonly`
  - 권한: SELECT only
- [ ] DB 스키마 버전 (OpenEMR 7.0+)
- [ ] 주요 테이블 접근 가능 여부
  - `patient_data` (환자 기본정보)
  - `form_encounter` (내원 기록)
  - `procedure_order` (검사 오더)
  - `procedure_result` (검사 결과)

**네트워크**
- [ ] VPN 접속 필요 여부
- [ ] IP Whitelist 등록 (CDSS 서버 IP)
- [ ] 방화벽 포트 개방
  - HTTPS: 443
  - MySQL: 3306 (DB 직접 접근 시)

**데이터 규격**
- [ ] 환자 ID 체계 (MRN, Patient ID)
- [ ] 날짜/시간 형식 (ISO 8601 vs custom)
- [ ] 코드 시스템 (ICD-10, SNOMED CT, LOINC)
- [ ] 데이터 인코딩 (UTF-8)

**성능 및 가용성**
- [ ] SLA (Service Level Agreement)
  - 가동률: 99.9%
  - 응답 시간: <500ms
- [ ] 장애 발생 시 연락처
- [ ] 점검 일정 (정기 점검 시간대)

**보안 및 규정**
- [ ] SSL/TLS 인증서 검증
- [ ] 개인정보 접근 로그 요구사항
- [ ] HIPAA/개인정보보호법 준수 확인

---

### 3.2 Orthanc (DICOM 서버)

#### 시스템 정보
- **용도**: 의료 영상 저장/조회, DICOM 메타데이터 관리
- **연동 방식**: DICOMweb (REST API) + DICOM C-STORE (선택)
- **관련 모듈**: UC5 (RIS - Radiology)

#### 필수 확인 사항

**API 접근**
- [ ] Orthanc 서버 URL
  - 예: `https://pacs.hospital.com`
- [ ] DICOMweb 플러그인 설치 여부
  - WADO-RS (이미지 조회)
  - QIDO-RS (메타데이터 검색)
  - STOW-RS (이미지 업로드)
- [ ] 인증 방식
  - Basic Auth (username/password)
  - 또는 API Token
- [ ] Rate Limiting 정책

**DICOM 네트워크 (C-STORE)**
- [ ] DICOM AE Title (Application Entity)
  - Orthanc AE Title: `ORTHANC`
  - CDSS AE Title: `CDSS_RIS`
- [ ] DICOM 포트: 4242 (기본값)
- [ ] 방화벽 규칙 (TCP 4242 허용)

**저장소**
- [ ] 저장소 용량 한계
- [ ] 이미지 보관 정책 (자동 삭제 주기)
- [ ] 백업 정책

**지원 Modality**
- [ ] 지원하는 영상 장비 목록
  - CT (컴퓨터 단층촬영)
  - MRI (자기공명영상)
  - X-Ray (일반 방사선)
  - US (초음파)
  - PET (양전자 단층촬영)
- [ ] 각 Modality별 메타데이터 구조

**데이터 형식**
- [ ] DICOM 태그 필수 항목
  - Patient ID (0010,0020)
  - Study Instance UID (0020,000D)
  - Series Instance UID (0020,000E)
  - Modality (0008,0060)
- [ ] 비표준 Private Tag 사용 여부

**성능**
- [ ] 동시 이미지 업로드 제한
- [ ] 최대 파일 크기 (GB 단위)
- [ ] 이미지 조회 응답 시간

**통합 테스트**
- [ ] 테스트용 Study 제공 (샘플 DICOM 이미지)
- [ ] Staging 환경 접근 권한

**보안**
- [ ] HTTPS 인증서
- [ ] 익명화 처리 정책
- [ ] 환자 정보 마스킹 여부

---

### 3.3 HAPI FHIR Server (의료정보 교환)

#### 시스템 정보
- **용도**: FHIR 리소스 저장/조회, 외부 병원과 데이터 교환
- **연동 방식**: FHIR REST API (R4)
- **관련 모듈**: UC8 (FHIR Gateway)

#### 필수 확인 사항

**서버 정보**
- [ ] HAPI FHIR Server URL
  - 예: `https://fhir.hospital.com/fhir`
- [ ] FHIR 버전 (R4 권장)
- [ ] HAPI FHIR Server 버전 (6.x+)

**인증/인가**
- [ ] 인증 방식
  - OAuth 2.0 (SMART on FHIR)
  - Basic Auth
  - API Key
- [ ] 스코프 (Scope) 설정
  - `patient/*.read`
  - `patient/*.write`
  - `system/*.read` (Batch 작업용)
- [ ] Client ID/Secret 발급

**지원 리소스**
- [ ] 필수 리소스 타입
  - Patient
  - ServiceRequest
  - ImagingStudy
  - DiagnosticReport
  - Observation
  - AuditEvent
- [ ] 커스텀 프로파일 (Profile) 사용 여부
- [ ] 확장(Extension) 정의

**검색 파라미터**
- [ ] 환자 검색
  - `GET /Patient?identifier=MRN123`
  - `GET /Patient?name=홍길동`
- [ ] 리소스 검색
  - `GET /ImagingStudy?patient=Patient/123`
  - `GET /DiagnosticReport?subject=Patient/123&date=gt2025-01-01`

**트랜잭션**
- [ ] Batch/Transaction 지원 여부
  - `POST /` (Bundle type: batch)
- [ ] 최대 Bundle 크기 (리소스 개수)

**구독 (Subscription)**
- [ ] Subscription 지원 여부 (변경 알림)
- [ ] Webhook 엔드포인트 등록
- [ ] 재시도 정책

**데이터 동기화**
- [ ] 양방향 동기화 vs 단방향 전송
- [ ] 충돌 해결 정책 (Conflict Resolution)
- [ ] 중복 데이터 처리 (Idempotent)

**성능**
- [ ] Rate Limiting
  - 시간당 요청 제한
  - 페이징 크기 제한 (`_count` 최대값)
- [ ] 응답 시간 SLA

**개발 환경**
- [ ] Sandbox/Test 서버 제공 여부
- [ ] 테스트 데이터셋

**모니터링**
- [ ] FHIR Server 상태 확인
  - `GET /metadata` (CapabilityStatement)
- [ ] 오류 로그 접근 권한

**규정 준수**
- [ ] FHIR 표준 준수 검증 (HL7 Validator)
- [ ] 개인정보 마스킹 정책
- [ ] 감사 로그 요구사항

---

### 3.4 상용 서버 공통 확인 사항

#### 계약 및 라이선스
- [ ] 서비스 계약서 검토
- [ ] API 사용량 제한 (월별 호출 횟수)
- [ ] 초과 사용 시 과금 정책
- [ ] 계약 갱신 주기

#### 기술 지원
- [ ] 기술 지원 담당자 연락처
- [ ] 지원 시간 (24/7 vs 업무시간)
- [ ] 긴급 상황 대응 프로세스
- [ ] 버전 업그레이드 일정

#### 테스트 환경
- [ ] 개발/스테이징 환경 제공 여부
- [ ] 프로덕션과 동일한 데이터 구조
- [ ] 테스트 계정 발급

#### 모니터링 및 알림
- [ ] 서비스 상태 페이지 (Status Page)
- [ ] 장애 알림 채널 (이메일, SMS)
- [ ] 정기 점검 사전 공지

#### 문서
- [ ] API 문서 (Swagger, Redoc)
- [ ] 통합 가이드
- [ ] 코드 예제
- [ ] 변경 이력 (Changelog)

---

## 4. 팀별 작업 범위

### 4.1 Frontend Team (React/Flutter)
**인원**: 3~4명
- **React 개발자** (2명): 웹 애플리케이션 (7개 역할 전체 지원)
- **Flutter 개발자** (1명): 모바일 앱 (Patient 역할 전용)
- **UI/UX 디자이너** (1명): 디자인 시스템, 프로토타입

**주요 책임**

**React Web (7개 역할)**
- 역할별 UI 동적 렌더링 (Admin, Doctor, RIB, Lab, Nurse, Patient, External)
- 복잡한 의료진 워크플로우 구현 (처방, 영상 판독, AI 분석)
- API 연동 (Django REST API)
- 상태 관리 (다중 역할 지원)
- WebSocket 실시간 통신
- DICOM 뷰어 통합

**Flutter Mobile (Patient 역할만)**
- 환자 친화적 UI/UX
- Self Access 데이터 필터링
- 푸시 알림 구현
- 생체 인증
- 오프라인 캐싱
- 역할 제한 (Patient 외 로그인 차단)

---

### 4.2 Backend Team (Django)
**인원**: 4~5명
- **시니어 개발자** (1명): 아키텍처 설계, 코드 리뷰
- **백엔드 개발자** (3명): UC 모듈 개발 (분담)
  - 개발자 A: UC1, UC2, UC9
  - 개발자 B: UC3, UC4, UC7
  - 개발자 C: UC5, UC6, UC8
- **DevOps 엔지니어** (1명): Docker, CI/CD, 모니터링

**주요 책임**
- REST API 개발 (Django REST Framework)
- 비즈니스 로직 구현 (7-Layer Architecture)
- 외부 시스템 통합 (OpenEMR, Orthanc, HAPI FHIR)
- **비동기 작업 처리** (Celery + RabbitMQ)
  - AI 추론 작업 큐
  - FHIR 동기화 작업 큐
- Django Channels WebSocket (실시간 알림)
- Prometheus Metrics Exporter

---

### 4.3 Database Team
**인원**: 1~2명
- **DBA** (1명): 스키마 설계, 성능 튜닝, 백업
- **데이터 엔지니어** (1명, 선택): 대용량 데이터 처리

**주요 책임**
- MySQL/MariaDB 설치 및 구성
- ERD 구현
- 인덱싱 전략
- 쿼리 최적화
- 백업/복구 자동화

---

### 4.4 AI Team
**인원**: 2명
- **AI 엔지니어** (1명): 모델 개발 및 최적화
- **MLOps 엔지니어** (1명): AI 서버 구축 및 모니터링

**주요 책임**
- AI 모델 개발 (MRI 종양 분석, Omics 분석)
- Flask AI 서버 구현 (GPU 활용)
- RabbitMQ Consumer (AI Job Queue)
- 모델 추론 성능 최적화
- GPU 메모리 관리
- AI Artifact 저장 (MinIO)

---

### 4.5 Integration Team (외부 시스템 연동)
**인원**: 2명
- **통합 전문가** (2명): OpenEMR, Orthanc, HAPI FHIR 연동

**주요 책임**
- 외부 API 연동 테스트
- 데이터 매핑 (CDSS ↔ FHIR 리소스)
- 오류 처리 및 재시도 로직
- 통합 문서 작성
- **Orthanc 연동**: DICOM 업로드/조회 (DICOMweb)
- **OpenEMR 연동**: 환자 데이터 Pull
- **HAPI FHIR 연동**: 리소스 동기화 (RabbitMQ 큐)

---

### 4.6 DevOps Team
**인원**: 1~2명
- **DevOps 엔지니어** (1명): 인프라 구축, 배포, 모니터링
- **SRE (선택)** (1명): 안정성 향상, 장애 대응

**주요 책임**
- **Docker 컨테이너화**
  - docker-compose.yml 작성 및 관리
  - 멀티 스테이지 빌드 최적화
- **배포 자동화**
  - CI/CD 파이프라인 구축 (GitHub Actions)
  - Blue-Green 배포 전략
- **보안**
  - Cloudflare + Nginx HTTPS 설정
  - SSL/TLS 인증서 관리
  - 방화벽 규칙 설정
- **모니터링 (Observability)**
  - Prometheus 메트릭 수집
  - Grafana 대시보드 구축
  - Alertmanager 알림 설정 (Code Blue)
- **백업 및 재해 복구**
  - MySQL 일일 백업 스크립트
  - MinIO 주간 백업
  - DR (Disaster Recovery) 절차 문서화

---

### 4.7 QA/Test Team
**인원**: 2명
- **QA 엔지니어** (1명): 기능 테스트, 회귀 테스트
- **테스트 자동화 엔지니어** (1명): E2E 테스트 스크립트

**주요 책임**
- 테스트 계획 수립
- 단위 테스트 (pytest, Jest)
- 통합 테스트 (외부 시스템 연동)
- E2E 테스트 (Selenium, Cypress)
- 성능 테스트 (Locust, GPU 부하 테스트)

---

## 5. 개발 일정 및 우선순위

### Phase 1: 기반 구축 (Week 1-4)
**우선순위: 높음**

| 주차 | Backend | Frontend (React) | Frontend (Flutter) | Database | 통합 |
|------|---------|------------------|-------------------|----------|------|
| 1주차 | Django 초기 설정<br>UC1 (인증) 7개 역할 구현 | React 초기 설정<br>로그인 화면 (7개 역할) | - | MySQL 설치<br>ACCT 스키마 (7개 역할) | OpenEMR API 접근 테스트 |
| 2주차 | UC2 (EMR Proxy)<br>Self Access 필터링 | 환자 검색 화면<br>역할별 메뉴 렌더링 | - | EMR 캐시 스키마 | OpenEMR 데이터 매핑 |
| 3주차 | UC9 (Audit)<br>역할별 로깅 | 관리자 감사 로그 화면 | - | AUDIT 스키마 | - |
| 4주차 | UC7 (Alert)<br>WebSocket 설정 | 알림 팝업<br>타임라인 화면 | - | TIMELINE 스키마 | - |

**마일스톤**: 기본 인증 + 환자 조회 기능 완성

---

### Phase 2: 핵심 기능 개발 (Week 5-10)
**우선순위: 높음**

| 주차 | Backend | Frontend (React) | Frontend (Flutter) | Database | 통합 |
|------|---------|------------------|-------------------|----------|------|
| 5주차 | UC5 (RIS) Order/Study | 영상 오더 입력 (Doctor, RIB) | - | RADIOLOGY 스키마 | Orthanc API 테스트 |
| 6주차 | UC5 Orthanc 연동 | DICOM Viewer 통합 | - | - | Orthanc WADO-RS |
| 7주차 | UC6 (AI) 기본 구현 | AI 결과 대시보드 (Doctor) | - | AI 스키마 | AI 서버 Mock API |
| 8주차 | UC3 (OCS) 처방 | 처방 입력 화면 (Doctor) | - | OCS 스키마 | - |
| 9주차 | UC4 (LIS) 검사 | 검사 결과 화면 (Lab) | - | LIS 스키마 | - |
| 10주차 | UC8 (FHIR) 기본 구현 | FHIR 대시보드 (External) | - | FHIR 스키마 | HAPI FHIR 테스트 |

**마일스톤**: 영상 조회 + AI 분석 + 처방 입력 완성

---

### Phase 3: 고급 기능 및 통합 (Week 11-14)
**우선순위: 중간**

| 주차 | Backend | Frontend (React) | Frontend (Flutter) | 통합/테스트 |
|------|---------|------------------|-------------------|------------|
| 11주차 | UC5 판독문 서명<br>UC6 AI 비동기 폴링 | 판독문 작성 UI (Doctor)<br>AI Job 모니터링 | **Flutter 프로젝트 초기 설정**<br>Patient 로그인 화면 | - |
| 12주차 | UC8 FHIR 리소스 변환<br>CDC 구현 | FHIR 전송 큐 관리 (External) | **환자 프로필 조회**<br>진료 내역 타임라인 | - |
| 13주차 | Patient API 최적화<br>Self Access 강화 | React Patient 화면 완성 | **예약 신청 화면**<br>**푸시 알림 구현 (FCM)** | - |
| 14주차 | - | 역할별 UI 최종 점검 | **생체 인증**<br>역할 제한 로직 | 전체 통합 테스트 |

**마일스톤**: 전체 UC 기능 완성

---

### Phase 4: 최적화 및 배포 준비 (Week 15-16)
**우선순위: 높음**

| 주차 | Backend | Frontend (React) | Frontend (Flutter) | 배포/운영 |
|------|---------|------------------|-------------------|----------|
| 15주차 | 성능 최적화<br>보안 감사 | 7개 역할 UI 최종 테스트<br>접근성 개선 | Patient 앱 최종 테스트<br>고령 환자 UI 검증 | 운영 매뉴얼 작성<br>모니터링 설정 |
| 16주차 | API 문서 작성<br>부하 테스트 | 의료진 교육<br>파일럿 테스트 (의사, 간호사) | **App Store 심사 제출**<br>**Google Play 배포** | 프로덕션 배포<br>사용자 교육 |

**마일스톤**: 프로덕션 배포

---

## 6. 위험 요소 및 대응 방안

### 6.1 외부 시스템 연동 지연
**위험**: OpenEMR, Orthanc, FHIR 서버 접근 권한 지연

**대응 방안**
- Mock API 서버 구축 (개발 초기)
- Swagger 기반 가상 서버 (Prism)
- 병렬 개발 (통합팀 별도 작업)

---

### 6.2 DICOM 뷰어 성능 문제
**위험**: 대용량 의료 영상 로딩 시간

**대응 방안**
- 이미지 압축 (JPEG 2000)
- 프리로딩 및 캐싱
- Progressive Loading (저해상도 → 고해상도)
- CDN 활용

---

### 6.3 실시간 알림 스케일링
**위험**: WebSocket 동시 연결 수 증가

**대응 방안**
- Redis Pub/Sub 활용
- Horizontal Scaling (WebSocket 서버 다중화)
- 알림 우선순위 정책 (중요 알림만 즉시 전송)

---

### 6.4 데이터베이스 성능 저하
**위험**: 감사 로그 테이블 비대화

**대응 방안**
- 파티셔닝 (월별/연도별)
- 구형 데이터 아카이빙
- 읽기 전용 Replica 활용

---

### 6.5 FHIR 데이터 동기화 실패
**위험**: HAPI FHIR 서버 장애 시 데이터 유실

**대응 방안**
- 재시도 큐 (Exponential Backoff)
- Dead Letter Queue (DLQ)
- 수동 재전송 기능
- 동기화 상태 모니터링 대시보드

---

### 6.6 보안 취약점
**위험**: 개인정보 유출, 권한 우회

**대응 방안**
- 코드 보안 감사 (OWASP Top 10)
- 침투 테스트 (Penetration Testing)
- 정기 취약점 스캔 (SAST, DAST)
- 최소 권한 원칙 (Principle of Least Privilege)

---

## 부록 A: 상용 서버 접속 정보 템플릿

### OpenEMR
```yaml
# config/openemr.yaml
host: https://emr.hospital.com
api_base: /apis/default/api
auth:
  type: oauth2
  client_id: CDSS_CLIENT
  client_secret: [REDACTED]
  token_url: /oauth2/token
database:
  readonly_host: openemr-db.hospital.com
  port: 3306
  user: cdss_readonly
  password: [REDACTED]
  database: openemr
```

### Orthanc
```yaml
# config/orthanc.yaml
host: https://pacs.hospital.com
auth:
  type: basic
  username: cdss_user
  password: [REDACTED]
dicomweb:
  wado_rs: /wado-rs
  qido_rs: /qido-rs
  stow_rs: /stow-rs
dicom:
  ae_title: CDSS_RIS
  port: 4242
```

### HAPI FHIR
```yaml
# config/hapi_fhir.yaml
host: https://fhir.hospital.com/fhir
auth:
  type: oauth2
  client_id: CDSS_FHIR_CLIENT
  client_secret: [REDACTED]
  scopes:
    - patient/*.read
    - patient/*.write
    - system/*.read
version: R4
```

---

## 부록 B: 체크리스트

### 프로젝트 시작 전
- [ ] 모든 팀원에게 UML 설계 문서 공유
- [ ] 개발 환경 구성 가이드 배포
- [ ] Git Repository 생성 (Frontend, Backend 분리)
- [ ] CI/CD 파이프라인 구축
- [ ] 코드 리뷰 프로세스 정의

### 외부 시스템 연동 전
- [ ] OpenEMR 접속 정보 획득
- [ ] Orthanc 접속 정보 획득
- [ ] HAPI FHIR 접속 정보 획득
- [ ] 방화벽 규칙 신청
- [ ] VPN 계정 발급
- [ ] 테스트 데이터 준비

### 배포 전
- [ ] 보안 감사 완료
- [ ] 성능 테스트 완료 (목표: 응답 시간 <500ms)
- [ ] 백업/복구 테스트 완료
- [ ] 사용자 교육 자료 준비
- [ ] 운영 매뉴얼 작성
- [ ] 모니터링 알림 설정

---

## 부록 C: 역할-권한 매트릭스

### UC별 역할 접근 권한

| Use Case | Admin | Doctor | RIB | Lab | Nurse | Patient | External |
|---|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
| **UC1 - ACCT** (계정 관리) | CRUD | R | R | R | R | R (Self) | - |
| **UC2 - EMR** (환자 조회) | CRUD | CRUD | R | R | R | R (Self) | - |
| **UC3 - OCS** (처방) | CRUD | CRUD | - | - | R | R (Self) | - |
| **UC4 - LIS** (검사) | CRUD | CRUD | - | CRU | R | R (Self) | - |
| **UC5 - RIS** (영상) | CRUD | CRUD | CRU | - | R | R (Self) | - |
| **UC6 - AI** (AI 분석) | CRUD | CRU | R | - | R | R (Self) | - |
| **UC7 - ALERT** (알림) | CRUD | R | R | R | R | R (Self) | - |
| **UC8 - FHIR** (외부 연동) | CRUD | R | - | - | - | - | RU |
| **UC9 - AUDIT** (감사) | CRUD | R | - | - | - | - | - |

**권한 범례**
- **C**: Create (생성)
- **R**: Read (조회)
- **U**: Update (수정)
- **D**: Delete (삭제)
- **R (Self)**: 본인 데이터만 조회 가능
- **-**: 접근 불가

### 역할별 초기 권한 설정 (Django Fixtures)

```python
# acct/fixtures/initial_roles.json
[
    {
        "model": "acct.role",
        "pk": "ADMIN",
        "fields": {
            "name": "시스템 관리자",
            "description": "시스템 전체 관리 및 설정",
            "enabled": true
        }
    },
    {
        "model": "acct.role",
        "pk": "DOCTOR",
        "fields": {
            "name": "신경외과 의사",
            "description": "환자 진료 및 AI 분석 결과 확정",
            "enabled": true
        }
    },
    {
        "model": "acct.role",
        "pk": "RIB",
        "fields": {
            "name": "방사선과",
            "description": "의료 영상 업로드 및 관리",
            "enabled": true
        }
    },
    {
        "model": "acct.role",
        "pk": "LAB",
        "fields": {
            "name": "검사실",
            "description": "검사 데이터 입력 및 관리",
            "enabled": true
        }
    },
    {
        "model": "acct.role",
        "pk": "NURSE",
        "fields": {
            "name": "간호사",
            "description": "바이탈 측정 및 간호 기록",
            "enabled": true
        }
    },
    {
        "model": "acct.role",
        "pk": "PATIENT",
        "fields": {
            "name": "일반 환자",
            "description": "본인 진료 내역 조회 및 예약",
            "enabled": true
        }
    },
    {
        "model": "acct.role",
        "pk": "EXTERNAL",
        "fields": {
            "name": "외부 기관",
            "description": "FHIR API 연동용 M2M 계정",
            "enabled": true
        }
    }
]
```

### 역할별 기본 권한 매핑

```python
# acct/fixtures/initial_role_permissions.json
# 예시: Doctor 역할의 권한
[
    {"role_key": "DOCTOR", "perm_key": "patient.view"},
    {"role_key": "DOCTOR", "perm_key": "patient.edit"},
    {"role_key": "DOCTOR", "perm_key": "order.create"},
    {"role_key": "DOCTOR", "perm_key": "order.view"},
    {"role_key": "DOCTOR", "perm_key": "order.edit"},
    {"role_key": "DOCTOR", "perm_key": "report.sign"},
    {"role_key": "DOCTOR", "perm_key": "ai_result.view"},
    {"role_key": "DOCTOR", "perm_key": "ai_result.approve"},

    # RIB 역할의 권한
    {"role_key": "RIB", "perm_key": "dicom.upload"},
    {"role_key": "RIB", "perm_key": "dicom.view"},
    {"role_key": "RIB", "perm_key": "study.create"},
    {"role_key": "RIB", "perm_key": "study.edit"},

    # Lab 역할의 권한
    {"role_key": "LAB", "perm_key": "lab_test.create"},
    {"role_key": "LAB", "perm_key": "lab_test.view"},
    {"role_key": "LAB", "perm_key": "lab_result.create"},
    {"role_key": "LAB", "perm_key": "lab_result.edit"},

    # Nurse 역할의 권한
    {"role_key": "NURSE", "perm_key": "patient.view"},
    {"role_key": "NURSE", "perm_key": "vitals.create"},
    {"role_key": "NURSE", "perm_key": "vitals.edit"},
    {"role_key": "NURSE", "perm_key": "nursing_note.create"},

    # Patient 역할의 권한
    {"role_key": "PATIENT", "perm_key": "patient.view_self"},
    {"role_key": "PATIENT", "perm_key": "appointment.create"},
    {"role_key": "PATIENT", "perm_key": "questionnaire.submit"},

    # External 역할의 권한
    {"role_key": "EXTERNAL", "perm_key": "fhir.read"},
    {"role_key": "EXTERNAL", "perm_key": "fhir.write"}
]
```

---

## 부록 D: 역할별 개발 체크리스트

### Backend 개발자 체크리스트

**UC1 - ACCT 모듈**
- [ ] 7개 역할 모델 정의 및 마이그레이션
- [ ] Role-Permission 매핑 로직 구현
- [ ] JWT 토큰에 역할 정보 포함
- [ ] 역할별 권한 체크 Decorator 구현
- [ ] 역할별 데이터 필터링 QuerySet 구현
- [ ] 초기 역할/권한 Fixture 작성
- [ ] 역할 변경 감사 로그 기록

**권한 체크 미들웨어**
- [ ] @require_role('DOCTOR') 데코레이터
- [ ] @require_permission('patient.edit') 데코레이터
- [ ] 역할별 자동 QuerySet 필터링
- [ ] API Rate Limiting (External 역할 강화)

### Frontend 개발자 체크리스트

**React Web (7개 역할 전체 지원)**
- [ ] 로그인 응답에서 역할 정보 파싱 (7개 역할)
- [ ] 역할별 메뉴 동적 렌더링 (Admin, Doctor, RIB, Lab, Nurse, Patient, External)
- [ ] 역할별 버튼/필드 show/hide
- [ ] 역할별 라우팅 가드 (React Router)
- [ ] 역할 아이콘/배지 표시 (UI)
- [ ] 권한 없는 기능 클릭 시 안내 메시지
- [ ] Admin 전용 관리자 패널
- [ ] Doctor 전용 판독문 서명 UI
- [ ] RIB 전용 DICOM 업로드 UI
- [ ] Lab 전용 검사 결과 입력 UI
- [ ] Nurse 전용 바이탈/간호 기록 UI
- [ ] Patient 전용 본인 데이터 조회 UI (Web)
- [ ] External 전용 FHIR 대시보드

**Flutter Mobile (Patient 역할만)**
- [ ] **역할 제한**: Patient 역할만 로그인 허용
- [ ] **다른 역할 차단**: Admin, Doctor 등 로그인 시 에러 메시지
- [ ] Self Access 필터링 (본인 데이터만)
- [ ] 환자 프로필 조회
- [ ] 진료 내역 타임라인
- [ ] 예약 신청/취소
- [ ] 문진표 작성
- [ ] 푸시 알림 수신 (FCM)
- [ ] 생체 인증 (지문, Face ID)
- [ ] 자동 로그아웃 (5분 무활동)
- [ ] 고령 환자 고려 UI (큰 글씨, 간단한 네비게이션)
- [ ] DICOM 썸네일 뷰어 (읽기 전용)

### Database 개발자 체크리스트

**스키마 설계**
- [ ] ACCT_ROLES 테이블 생성 (7개 역할)
- [ ] ACCT_PERMISSIONS 테이블 생성
- [ ] ACCT_USER_ROLES 매핑 테이블
- [ ] ACCT_ROLE_PERMS 매핑 테이블
- [ ] 역할 변경 이력 테이블 (선택)
- [ ] 인덱스 생성 (user_id, role_key)

**초기 데이터**
- [ ] 7개 역할 INSERT
- [ ] 기본 권한 정의 INSERT
- [ ] 관리자 계정 생성 (ADMIN 역할)
- [ ] 테스트 계정 생성 (각 역할별 1개씩)

---

**문서 작성**: Claude AI
**작성일**: 2025-12-19
**버전**: 1.4

**주요 변경 사항**
- v1.0: 초기 업무계획서 작성
- v1.1: 역할 기반 권한 정보 추가 (7개 역할)
- v1.2: React/Flutter 대상 사용자 명확화
  - React Web: 7개 역할 전체 지원 (Admin, Doctor, RIB, Lab, Nurse, Patient, External)
  - Flutter Mobile: Patient 역할 전용 (환자 앱)
- v1.3: 인프라 및 DevOps 정보 추가
  - Docker 컨테이너 구성
  - RabbitMQ 비동기 메시징 (AI, FHIR)
  - Cloudflare + Nginx 보안
  - Prometheus + Grafana 모니터링
  - Orthanc, OpenEMR, HAPI FHIR 연동
  - AI Team, DevOps Team 추가
- v1.4: Frontend 기술 스택 확정 (TypeScript, Tailwind CSS, Zustand)
  - React Web: TypeScript 5.x 적용 (타입 안정성)
  - 스타일링: Tailwind CSS 3.x (역할별 테마 색상)
  - 상태 관리: Zustand (경량, 역할별 스토어 분리)
  - UI 컴포넌트: shadcn/ui (Tailwind 기반)
  - 폼 관리: React Hook Form + Zod
  - 테스트: Vitest, Playwright

**관련 문서**
- 상세 인프라 구성: [02_세부 계획서.md](02_세부 계획서.md)
- 1달 작업 순서: [03_개발_작업_순서.md](03_개발_작업_순서.md)
