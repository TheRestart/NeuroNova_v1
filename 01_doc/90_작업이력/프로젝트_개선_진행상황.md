# 프로젝트 개선 진행 상황

**작성일**: 2025-12-31
**목적**: 전체적인 관점에서 문서, 구조, 기획 개선 작업 추적
**참조**: 사용자 요청 "전체적인 관점에서 문서, 구조, 기획적으로 개선할 부분이 있을까?"

---

## 📋 개선 작업 개요

총 **10개 개선 영역**, **3단계 우선순위**로 분류:
- **즉시 실행 (1주일)**: 6개 항목 ✅ **완료**
- **단기 실행 (2주일)**: 5개 항목 🔄 **대기**
- **중장기 실행 (1개월)**: 5개 항목 🔵 **계획**

---

## ✅ 즉시 실행 (1주일) - 완료

### 1. 비밀번호 규칙 프로덕션 대비 ✅
**상태**: 완료 (2025-12-31)

**문제점**:
- 테스트 비밀번호가 너무 단순 (`admin123!@#`)
- Python escape sequence 경고 발생
- 로그인 인증 실패 (401 Unauthorized)

**해결 방법**:
- 특수문자 완전 제거: `admin123!@#` → `admin123`
- create_test_users.py 버그 수정 (password 미전달 문제)
- 6개 문서 업데이트 (코드 + 문서 일관성 확보)

**결과물**:
- [PASSWORD_CHANGE_PLAN.md](PASSWORD_CHANGE_PLAN.md)
- create_test_users.py 수정 완료
- 5개 문서 업데이트 완료

**다음 단계** (서버 필요):
- Phase 2: 기존 사용자 삭제 및 신규 생성
- Phase 3: 브라우저 로그인 테스트

---

### 2. 작업 이력 파일 이동 ✅
**상태**: 완료 (2025-12-31)

**문제점**:
- 작업 이력 파일들이 루트 디렉토리에 혼재
- PASSWORD_CHANGE_PLAN.md (루트)
- OLD_오류정리_antigra_1230.md (01_doc/)

**해결 방법**:
- 01_doc/90_작업이력/ 디렉토리 생성
- 관련 파일 이동 및 정리

**결과물**:
```
01_doc/90_작업이력/
├── PASSWORD_CHANGE_PLAN.md (이동 완료)
├── OLD_오류정리_antigra_1230.md (이동 완료)
├── GIT_COMMIT_CONVENTION.md (신규 작성)
└── 프로젝트_개선_진행상황.md (이 문서)
```

---

### 3. DICOM 샘플 데이터 다운로드 링크 README ✅
**상태**: 완료 (2025-12-31)

**문제점**:
- sample_dicoms 디렉토리 비어있음
- DICOM 데이터 다운로드 방법 불명확
- RIS/OHIF 기능 테스트 불가

**해결 방법**:
- sample_dicoms/README.md 작성 (282줄)
- 3개 주요 데이터 소스 문서화:
  1. TCIA (The Cancer Imaging Archive)
  2. OpenNeuro
  3. Kaggle Medical Imaging
- 시나리오별 추천 데이터셋 정리
- 빠른 시작 가이드 및 트러블슈팅

**결과물**:
- [sample_dicoms/README.md](../../NeuroNova_02_back_end/02_django_server/sample_dicoms/README.md)
- sample_dicoms/.gitignore (DICOM 파일 제외)

**추천 데이터셋**:
| 데이터셋 | 크기 | 모달리티 | 활용 시나리오 |
|---------|------|---------|-------------|
| Brain-Tumor-Progression (TCIA) | 500MB | MRI | 뇌종양 진단 |
| LIDC-IDRI (TCIA) | 1GB (샘플 10명) | CT | 폐암 검진 |
| RSNA Intracranial Hemorrhage (Kaggle) | 500MB (샘플 100개) | CT | 응급실 뇌출혈 |

**다음 단계** (수동 작업):
- 사용자가 직접 데이터셋 다운로드
- Orthanc PACS에 업로드
- OHIF Viewer 테스트

---

### 4. Git 커밋 메시지 규칙 문서화 ✅
**상태**: 완료 (2025-12-31)

**문제점**:
- 커밋 메시지 일관성 부족
- 팀원 간 커밋 스타일 상이

**해결 방법**:
- Conventional Commits 형식 채택
- Type, Scope, Subject, Body, Footer 정의
- 좋은 예시 / 나쁜 예시 비교

**결과물**:
- [GIT_COMMIT_CONVENTION.md](GIT_COMMIT_CONVENTION.md) (300+줄)

**주요 Type**:
- `feat`: 새로운 기능 추가
- `fix`: 버그 수정
- `docs`: 문서 수정
- `refactor`: 코드 리팩토링
- `test`: 테스트 추가/수정
- `chore`: 빌드/설정 파일 수정

**예시**:
```
feat(UC03): Add medication prescription API

- Implement POST /api/ocs/prescriptions/ endpoint
- Add PrescriptionSerializer with drug code validation
- Integrate with pharmacy system via FHIR

Closes #34
```

**도구 추천**:
- Commitlint (커밋 메시지 검증)
- Commitizen (대화형 커밋 도구)

---

### 5. 비밀번호 복잡도 체크리스트 (배포 전) ✅
**상태**: 완료 (2025-12-31)

**문제점**:
- 프로덕션 배포 전 보안 점검 항목 부재
- DEBUG=False, SECRET_KEY 환경변수 등 필수 설정 누락 위험

**해결 방법**:
- 8개 카테고리 보안 체크리스트 작성
- Phase별 배포 절차 정의

**결과물**:
- [13_배포전_보안_체크리스트.md](../13_배포전_보안_체크리스트.md) (440줄)

**8개 카테고리**:
1. **인증 및 권한**: 비밀번호 정책, JWT 토큰, ENABLE_SECURITY
2. **환경 변수**: SECRET_KEY, DB 비밀번호, Orthanc 비밀번호
3. **Django 보안 설정**: DEBUG=False, ALLOWED_HOSTS, CORS
4. **데이터베이스 보안**: 백업 자동화, 외부 접근 차단
5. **네트워크 보안**: 방화벽, HTTPS, SSL/TLS
6. **로깅 및 모니터링**: 민감 정보 마스킹, 접근 로그 보관
7. **코드 보안**: 의존성 취약점, SQL Injection, XSS 방지
8. **파일 및 정적 자산**: 업로드 파일 검증, DICOM 파일 검증

**Critical 항목**:
- [ ] DEBUG = False
- [ ] SECRET_KEY 환경변수 설정
- [ ] ALLOWED_HOSTS 설정
- [ ] DB 비밀번호 변경
- [ ] JWT 토큰 만료 시간 단축 (24h → 1h)
- [ ] HTTPS 인증서 설치

**배포 4단계**:
1. Phase 1: 설정 확인 (5개 항목)
2. Phase 2: 보안 점검 (5개 항목)
3. Phase 3: 모니터링 설정 (3개 항목)
4. Phase 4: 최종 검증 (4개 항목)

---

### 6. 요구사항 명세 재정리 (사용자 스토리 + NFR) ✅
**상태**: 완료 (2025-12-31)

**문제점**:
- 기능 요구사항이 Use Case 수준에서만 정의
- 비기능 요구사항(NFR) 부재
- Acceptance Criteria 불명확

**해결 방법**:
- 사용자 스토리 문서 작성 (UC02-UC09)
- 비기능 요구사항(NFR) 문서 작성

**결과물**:
- [05_사용자_스토리.md](../05_사용자_스토리.md) (500+줄)
- [06_비기능_요구사항.md](../06_비기능_요구사항.md) (400+줄)

#### 사용자 스토리 (05_사용자_스토리.md)

**구조**:
```
As a [역할],
I want to [기능],
So that [목적/이유].

Acceptance Criteria (AC):
- [ ] AC1: 구체적인 인수 조건
- [ ] AC2: ...

Business Rules:
- 비즈니스 규칙 및 제약사항
```

**17개 User Story**:
| Story | Use Case | 역할 | 기능 |
|-------|---------|------|------|
| Story 1 | UC02 | 간호사 | 신규 환자 등록 |
| Story 2 | UC02 | 의사 | 환자 검색 |
| Story 3 | UC02 | 간호사 | 환자 정보 수정 |
| Story 4 | UC03 | 의사 | 약물 처방 생성 |
| Story 5 | UC03 | 환자 | 처방 내역 조회 |
| Story 6 | UC04 | 의사 | 검사 오더 생성 |
| Story 7 | UC04 | 검사실 기사 | 검사 결과 입력 |
| Story 8 | UC05 | 의사 | 영상검사 오더 생성 |
| Story 9 | UC05 | 의사 | DICOM 이미지 조회 (OHIF) |
| Story 10 | UC06 | 의사 | 뇌출혈 AI 분석 요청 |
| Story 11 | UC06 | 관리자 | AI 추론 이력 조회 |
| Story 12 | UC07 | 의사 | SOAP Note 작성 |
| Story 13 | UC07 | 의사 | 타임라인 조회 |
| Story 14 | UC08 | 의사 | 역할별 대시보드 |
| Story 15 | UC08 | 관리자 | 통계 위젯 |
| Story 16 | UC09 | 관리자 | OpenEMR 환자 동기화 |
| Story 17 | UC09 | 방사선사 | Orthanc PACS 이미지 조회 |

**Performance Requirements**:
- API 평균 응답 시간: 200ms 이하
- API 최대 응답 시간: 1000ms 이하
- DICOM 이미지 로딩: 10초 이하
- AI 추론: 30초 이하
- 최소 동시 사용자: 100명
- 목표 동시 사용자: 500명

#### 비기능 요구사항 (06_비기능_요구사항.md)

**7개 NFR 카테고리**:

1. **Performance (성능)**:
   - 응답 시간 목표 (P50, P95, P99)
   - 처리량 (TPS - Transactions Per Second)
   - DB 쿼리 성능 (Slow Query < 500ms)

2. **Availability (가용성)**:
   - Uptime 목표: 99% (연간 다운타임 3.65일)
   - RPO (Recovery Point Objective): 24시간
   - RTO (Recovery Time Objective): 4시간
   - 백업 주기: 매일 오전 3시
   - 백업 보관: 30일 (일일), 12개월 (월말)

3. **Security (보안)**:
   - 비밀번호 정책: 최소 12자, 영문+숫자+특수문자
   - JWT 토큰 만료: Access 1시간, Refresh 7일
   - 데이터 암호화: AES-256 (민감정보), TLS 1.3 (전송)
   - 접근 제어: RBAC (Role-Based Access Control)
   - 로그 보관: 3년 (접근 로그, 수정/삭제 로그)

4. **Scalability (확장성)**:
   - Phase 1 (MVP): 100명 (Django 2대, MySQL 1대)
   - Phase 2 (운영 1년): 500명 (Django 4대, Master-Slave)
   - Phase 3 (확장): 1000명 (Auto-Scaling, MySQL Cluster)
   - 데이터 증가율: 환자 50건/일, 처방 200건/일, DICOM 1GB/일

5. **Usability (사용성)**:
   - 페이지 로딩: 3초 이내
   - 모바일 대응: 반응형 디자인
   - 접근성: WCAG 2.1 Level AA
   - 브라우저 지원: Chrome, Edge, Safari (최신 2버전)

6. **Maintainability (유지보수성)**:
   - 테스트 커버리지: 80% 이상
   - 코드 복잡도: Cyclomatic Complexity < 10
   - 배포 시간: 10분 이내
   - 롤백 시간: 5분 이내

7. **Compliance (규정 준수)**:
   - 개인정보보호법 준수
   - 의료법 제21조 (전자의무기록 위변조 방지)
   - 의료법 제22조 (의무기록 보존 10년)
   - HIPAA (선택)

**NFR 우선순위**:
- **High** (즉시): API 응답 < 1000ms, 비밀번호 12자, HTTPS, 백업 자동화, 테스트 커버리지 80%
- **Medium** (3개월): 동시 500명, Read Replica, Prometheus+Grafana, Blue-Green Deployment
- **Low** (6개월): Multi-Factor Auth, Auto-Scaling, ELK Stack, SonarQube

**검증 계획**:
```bash
# 성능 테스트 (Locust)
locust -f tests/load_test.py --users 100 --spawn-rate 10

# 보안 테스트 (OWASP ZAP)
docker run -t owasp/zap2docker-stable zap-baseline.py -t http://localhost:8000

# 가용성 테스트 (Chaos Engineering)
docker kill neuronova-django-dev  # Failover 30초 이내
```

---

## 🔄 단기 실행 (2주일) - 대기 중

### 7. 핵심 경로 통합 테스트 작성 🔜
**상태**: 대기 (서버 기동 후)

**목표**: 회귀 테스트 자동화

**작업 내용**:
1. 핵심 시나리오 정의
   - 환자 등록 → 진료 → 처방 생성
   - 검사 오더 → 결과 입력 → 의사 확인
   - DICOM 업로드 → OHIF Viewer 조회

2. Pytest 통합 테스트 작성
   ```python
   # tests/integration/test_prescription_workflow.py
   def test_prescription_workflow(api_client, doctor_user, patient):
       # 1. 처방 생성
       response = api_client.post('/api/ocs/prescriptions/', {...})
       assert response.status_code == 201

       # 2. 처방 조회
       response = api_client.get(f'/api/ocs/prescriptions/{prescription_id}/')
       assert response.data['medication'] == 'Aspirin 100mg'
   ```

3. CI/CD 파이프라인 통합

**예상 소요**: 3-4일

**관련 문서**: [04_테스트_전략.md](../04_테스트_전략.md)

---

### 8. 구조화 로깅 적용 🔜
**상태**: 대기

**목표**: JSON 형식 로깅, ELK Stack 준비

**작업 내용**:
1. python-json-logger 설치
   ```bash
   pip install python-json-logger
   ```

2. settings.py 로깅 설정
   ```python
   LOGGING = {
       'formatters': {
           'json': {
               '()': 'pythonjsonlogger.jsonlogger.JsonFormatter',
               'format': '%(asctime)s %(name)s %(levelname)s %(message)s'
           }
       }
   }
   ```

3. 로그 필드 표준화
   - `timestamp`, `level`, `user_id`, `action`, `resource`, `result`

**예상 소요**: 1-2일

---

### 9. Pre-commit Hook 설정 🔜
**상태**: 대기

**목표**: 코드 품질 자동 검증

**작업 내용**:
1. .pre-commit-config.yaml 작성
   ```yaml
   repos:
   - repo: https://github.com/psf/black
     hooks:
     - id: black
   - repo: https://github.com/PyCQA/flake8
     hooks:
     - id: flake8
   ```

2. 팀원 설치 가이드
   ```bash
   pip install pre-commit
   pre-commit install
   ```

**예상 소요**: 1일

---

### 10. 통합 테스트 환경 구성 🔜
**상태**: 대기

**목표**: Pytest + Factory Boy

**작업 내용**:
1. Factory Boy 설치
   ```bash
   pip install factory-boy
   ```

2. Factory 클래스 작성
   ```python
   # tests/factories.py
   class PatientFactory(factory.django.DjangoModelFactory):
       class Meta:
           model = Patient

       name = factory.Faker('name')
       date_of_birth = factory.Faker('date_of_birth')
   ```

3. conftest.py 공통 Fixture

**예상 소요**: 2-3일

---

### 11. Data Seeding 계층화 🔜
**상태**: 대기

**목표**: dev / demo 데이터 분리

**작업 내용**:
1. seed_dev_data.py
   - 개발용 테스트 데이터 (최소한)
   - 환자 10명, 처방 50건, 검사 30건

2. seed_demo_scenario.py
   - 데모/발표용 시나리오 데이터
   - 뇌출혈 응급 시나리오
   - 일반 진료 시나리오

3. --reset 플래그
   ```bash
   python manage.py seed_dev_data --reset
   ```

**예상 소요**: 2일

---

## 🔵 중장기 실행 (1개월) - 계획 단계

### 12. 문서 디렉토리 재구성 📅
**상태**: 계획

**목표**: 카테고리별 분류

**제안 구조**:
```
01_doc/
├── 00_시작하기/
│   ├── README.md
│   ├── REF_CLAUDE_ONBOARDING_QUICK.md
│   └── 사용방법_설명문서.md
├── 10_요구사항/
│   ├── 01_요구사항_정의서.md
│   ├── 05_사용자_스토리.md
│   └── 06_비기능_요구사항.md
├── 20_설계/
│   ├── 02_시스템_아키텍처.md
│   ├── 03_데이터베이스_스키마.md
│   └── REF_CLAUDE_CONTEXT.md
├── 30_구현/
│   ├── 10_API_명세.md
│   └── 11_프론트엔드_가이드.md
├── 40_테스트/
│   ├── 04_테스트_전략.md
│   └── 38_코드_정적_분석_보고서.md
├── 50_배포/
│   ├── 12_배포_가이드_GCP.md
│   └── 13_배포전_보안_체크리스트.md
├── 60_운영/
│   ├── 14_로깅_전략.md
│   └── 15_성능_최적화.md
└── 90_작업이력/
    ├── LOG_작업이력.md
    ├── GIT_COMMIT_CONVENTION.md
    ├── PASSWORD_CHANGE_PLAN.md
    └── OLD_오류정리_antigra_1230.md
```

**예상 소요**: 1일

---

### 13. CI/CD 파이프라인 구축 📅
**상태**: 계획

**목표**: GitHub Actions 자동화

**작업 내용**:
1. .github/workflows/ci.yml
   ```yaml
   name: CI
   on: [push, pull_request]
   jobs:
     test:
       runs-on: ubuntu-latest
       steps:
       - uses: actions/checkout@v3
       - name: Run tests
         run: pytest
   ```

2. .github/workflows/cd.yml
   - Docker 이미지 빌드
   - GCP Cloud Run 배포

**예상 소요**: 3-4일

---

### 14. Prometheus + Grafana 대시보드 📅
**상태**: 계획 (현재 컨테이너는 실행 중)

**목표**: 메트릭 시각화

**작업 내용**:
1. Prometheus 메트릭 수집 확인
2. Grafana 대시보드 작성
   - API 응답 시간 (P50, P95, P99)
   - 요청 수 (TPS)
   - 에러율
   - CPU/Memory 사용률

3. 알림 규칙 설정
   - API 에러율 > 5%
   - CPU > 80% (5분 지속)

**예상 소요**: 2-3일

---

### 15. 성능 테스트 환경 구축 📅
**상태**: 계획

**목표**: Locust 부하 테스트

**작업 내용**:
1. locustfile.py 작성
   ```python
   class CDSSUser(HttpUser):
       @task
       def view_patients(self):
           self.client.get("/api/emr/patients/")
   ```

2. 목표 TPS 측정
   - 환자 등록: 10 TPS
   - 처방 생성: 20 TPS

3. 병목 지점 파악

**예상 소요**: 2일

---

### 16. 자동 백업/복구 스크립트 📅
**상태**: 계획

**목표**: Cron 작업 자동화

**작업 내용**:
1. backup_cdss_db.sh
   ```bash
   #!/bin/bash
   DATE=$(date +%Y%m%d_%H%M%S)
   docker exec neuronova-cdss-mysql mysqldump -u root -p$MYSQL_ROOT_PASSWORD cdss_db > /backups/cdss_db_$DATE.sql
   ```

2. Cron 등록
   ```
   0 3 * * * /usr/local/bin/backup_cdss_db.sh
   ```

3. S3 업로드 (선택)

**예상 소요**: 1일

---

## 📊 진행 상황 요약

| 단계 | 항목 수 | 완료 | 진행 중 | 대기 | 계획 |
|------|---------|------|---------|------|------|
| **즉시 실행 (1주일)** | 6 | ✅ 6 | 0 | 0 | 0 |
| **단기 실행 (2주일)** | 5 | 0 | 0 | 🔜 5 | 0 |
| **중장기 실행 (1개월)** | 5 | 0 | 0 | 0 | 📅 5 |
| **전체** | **16** | **6 (37.5%)** | **0** | **5 (31.3%)** | **5 (31.3%)** |

---

## 🎯 가장 시급한 3가지 (현재 시점)

### 1. DICOM 샘플 데이터 다운로드 및 업로드 🔴
**이유**: RIS/OHIF 기능 시연 불가

**현재 상태**: README 작성 완료, 실제 데이터 없음

**다음 단계**:
1. TCIA Brain-Tumor-Progression 다운로드 (500MB)
2. sample_dicoms/brain_mri_001/ 디렉토리에 배치
3. Django 서버 기동 후 upload_sample_dicoms.py 실행
4. OHIF Viewer 테스트 (http://localhost:3001/ris)

---

### 2. 비밀번호 검증 및 로그인 테스트 🔴
**이유**: 사용자 로그인 불가 상태

**현재 상태**: 코드 수정 완료, 검증 미완료

**다음 단계** (서버 필요):
1. 기존 테스트 사용자 삭제
   ```bash
   docker exec neuronova-django-dev python manage.py shell -c "
   from acct.models import User
   User.objects.filter(username__in=['admin', 'doctor', 'nurse', 'patient', 'radiologist', 'labtech']).delete()
   "
   ```

2. 신규 사용자 생성
   ```bash
   docker exec neuronova-django-dev python manage.py create_test_users
   ```

3. 비밀번호 검증
   ```bash
   docker exec neuronova-django-dev python manage.py shell -c "
   from acct.models import User
   admin = User.objects.get(username='admin')
   print('Password check:', admin.check_password('admin123'))
   "
   ```

4. React 로그인 테스트 (http://localhost:3001)

---

### 3. 핵심 경로 통합 테스트 작성 🟡
**이유**: 회귀 테스트 자동화 부재

**현재 상태**: 계획만 존재

**다음 단계**:
1. 핵심 시나리오 정의 (환자 등록 → 진료 → 처방)
2. Pytest 통합 테스트 작성
3. CI/CD 파이프라인 통합 (선택)

---

## 📝 다음 작업 권장 순서

### 서버 기동 전 (지금 가능)
- [x] ~~문서 정리 (완료)~~
- [x] ~~보안 체크리스트 (완료)~~
- [x] ~~사용자 스토리 + NFR (완료)~~

### 서버 기동 후 (우선순위순)
1. 🔴 **비밀번호 검증 및 로그인 테스트** (30분)
2. 🔴 **DICOM 샘플 데이터 다운로드** (수동 작업, 1-2시간)
3. 🟡 **핵심 경로 통합 테스트 작성** (3-4일)
4. 🟡 **구조화 로깅 적용** (1-2일)
5. 🟡 **Pre-commit Hook 설정** (1일)

---

## 🔗 관련 문서

- [LOG_작업이력.md](../../LOG_작업이력.md)
- [작업_계획_요약.md](../../작업_계획_요약.md)
- [PASSWORD_CHANGE_PLAN.md](PASSWORD_CHANGE_PLAN.md)
- [GIT_COMMIT_CONVENTION.md](GIT_COMMIT_CONVENTION.md)
- [13_배포전_보안_체크리스트.md](../13_배포전_보안_체크리스트.md)
- [05_사용자_스토리.md](../05_사용자_스토리.md)
- [06_비기능_요구사항.md](../06_비기능_요구사항.md)

---

**작성**: Claude AI
**최종 업데이트**: 2025-12-31
**버전**: 1.0
