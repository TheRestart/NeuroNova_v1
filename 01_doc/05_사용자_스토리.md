# 사용자 스토리 (User Stories)

**목적**: NeuroNova CDSS 기능 요구사항을 사용자 관점으로 정의
**대상**: 개발자, 기획자, QA 엔지니어
**최종 수정일**: 2025-12-31

---

## 📋 개요

이 문서는 NeuroNova CDSS의 각 Use Case를 사용자 스토리 형식으로 정의합니다.

### 사용자 스토리 형식
```
As a [역할],
I want to [기능],
So that [목적/이유].
```

### Acceptance Criteria (AC)
각 스토리마다 구체적인 인수 조건을 정의하여 완료 기준을 명확히 합니다.

---

## 👤 사용자 역할 정의

| 역할 | 코드 | 설명 |
|------|------|------|
| 관리자 | `admin` | 시스템 전체 관리, 사용자 계정 관리 |
| 의사 | `doctor` | 환자 진료, 처방, 진단서 작성 |
| 간호사 | `nurse` | 환자 등록, 바이탈 기록, 처치 |
| 환자 | `patient` | 본인 의료 기록 조회 |
| 방사선사 | `radiologist` (rib) | 영상 검사 촬영, RIS 관리 |
| 검사실 기사 | `labtech` (lab) | 검체 검사, LIS 관리 |
| 외부 시스템 | `external` | EMR, PACS 연동 (API 전용) |

---

## UC02: 환자 등록 및 조회 (Patient Registration)

### Story 1: 신규 환자 등록

**As a** 간호사,
**I want to** 신규 환자의 인적사항을 등록하고,
**So that** 의사가 진료를 시작할 수 있도록 환자 기본 정보를 제공할 수 있다.

#### Acceptance Criteria (AC):
- [ ] **AC1**: 필수 필드 입력 (이름, 생년월일, 성별, 연락처)
- [ ] **AC2**: 환자 식별번호(PID) 자동 생성 (형식: `PID-YYYYMMDD-XXXX`)
- [ ] **AC3**: 중복 환자 검증 (이름 + 생년월일 조합으로 경고)
- [ ] **AC4**: 등록 완료 후 3초 이내에 환자 상세 페이지로 이동
- [ ] **AC5**: 등록 실패 시 명확한 오류 메시지 표시 (예: "연락처 형식이 올바르지 않습니다")

#### Business Rules:
- 생년월일은 오늘 이전 날짜만 허용
- 연락처는 010-XXXX-XXXX 형식 권장 (하이픈 자동 삽입)
- 환자 식별번호는 중복 불가 (DB Unique Constraint)

---

### Story 2: 환자 검색

**As a** 의사,
**I want to** 환자 이름 또는 식별번호로 빠르게 검색하고,
**So that** 진료를 시작하기 전에 환자의 과거 병력을 확인할 수 있다.

#### Acceptance Criteria (AC):
- [ ] **AC1**: 이름 부분 검색 지원 (예: "김" 입력 시 "김철수", "김영희" 모두 검색)
- [ ] **AC2**: 환자 식별번호(PID) 완전 일치 검색
- [ ] **AC3**: 검색 결과 3초 이내 표시 (최대 100명)
- [ ] **AC4**: 검색 결과에 환자 기본 정보 표시 (이름, 성별, 나이, 최근 방문일)
- [ ] **AC5**: 검색 결과 없을 시 "검색 결과가 없습니다" 메시지 표시

#### Performance Requirements:
- 평균 응답 시간: 500ms 이하
- 최대 응답 시간: 3000ms 이하
- 동시 검색 요청 처리: 최소 20명

---

### Story 3: 환자 정보 수정

**As a** 간호사,
**I want to** 등록된 환자의 연락처 정보를 수정하고,
**So that** 환자에게 검사 결과를 정확히 전달할 수 있다.

#### Acceptance Criteria (AC):
- [ ] **AC1**: 연락처, 주소, 비상 연락처 수정 가능
- [ ] **AC2**: 이름, 생년월일, 성별은 수정 불가 (별도 관리자 승인 필요)
- [ ] **AC3**: 수정 이력 자동 기록 (수정자, 수정 시간, 변경 전/후 값)
- [ ] **AC4**: 수정 완료 후 "저장되었습니다" 성공 메시지 표시
- [ ] **AC5**: 동시 수정 충돌 방지 (Optimistic Locking)

---

## UC03: 전자처방 (Electronic Prescription - OCS)

### Story 4: 약물 처방 생성

**As a** 의사,
**I want to** 환자에게 약물을 처방하고 용법/용량을 기록하며,
**So that** 약국에서 정확한 약을 조제할 수 있다.

#### Acceptance Criteria (AC):
- [ ] **AC1**: 약물 검색 (약품명, 성분명, 약가 코드)
- [ ] **AC2**: 용법/용량/투여 일수 입력 (예: "1일 3회, 1회 1정, 7일")
- [ ] **AC3**: 약물 상호작용 경고 (Contraindication 체크)
- [ ] **AC4**: 처방 저장 후 처방전 PDF 자동 생성
- [ ] **AC5**: 전자서명 적용 (의사 면허번호 포함)

#### Business Rules:
- 마약류 처방 시 별도 인증 필요
- 임산부/수유부 금기 약물 경고
- 동일 성분 중복 처방 방지

---

### Story 5: 처방 내역 조회

**As a** 환자,
**I want to** 나의 처방 이력을 시간순으로 조회하고,
**So that** 어떤 약을 복용했는지 기록을 확인할 수 있다.

#### Acceptance Criteria (AC):
- [ ] **AC1**: 최근 3개월 처방 내역 기본 표시
- [ ] **AC2**: 기간 필터링 (1개월, 3개월, 6개월, 1년, 전체)
- [ ] **AC3**: 처방전 PDF 다운로드 버튼
- [ ] **AC4**: 처방 약물별 복약 지도 링크
- [ ] **AC5**: 페이지네이션 (1페이지 20건)

---

## UC04: 임상검사 (Laboratory Information System - LIS)

### Story 6: 검사 오더 생성

**As a** 의사,
**I want to** 환자에게 혈액검사, 소변검사 등을 오더하고,
**So that** 검사실에서 검체를 접수하고 검사를 진행할 수 있다.

#### Acceptance Criteria (AC):
- [ ] **AC1**: 검사 항목 선택 (혈액검사, 소변검사, 조직검사 등)
- [ ] **AC2**: 검사 세부 항목 체크박스 (예: CBC - WBC, RBC, Hb, Hct)
- [ ] **AC3**: 긴급 검사 플래그 (STAT Order)
- [ ] **AC4**: 검사 오더 번호 자동 생성 (형식: `LAB-YYYYMMDD-XXXX`)
- [ ] **AC5**: 검사실로 알림 전송 (WebSocket 또는 Polling)

#### Business Rules:
- STAT 오더는 15분 이내 검체 접수 필수
- 금식 필요 검사 시 환자에게 자동 안내 메시지

---

### Story 7: 검사 결과 입력

**As a** 검사실 기사,
**I want to** 검사 결과를 입력하고 정상 범위 여부를 자동 판정하며,
**So that** 의사가 빠르게 이상 소견을 파악할 수 있다.

#### Acceptance Criteria (AC):
- [ ] **AC1**: 검사 항목별 수치 입력 (예: WBC 7.2 x10^3/μL)
- [ ] **AC2**: 정상 범위 자동 판정 (Normal / High / Low)
- [ ] **AC3**: Critical Value 알림 (예: K+ > 6.0 mEq/L 시 즉시 의사에게 알림)
- [ ] **AC4**: 검사 결과 저장 후 의사에게 완료 알림
- [ ] **AC5**: 검사 결과지 PDF 자동 생성

#### Performance Requirements:
- 검사 결과 입력 후 1초 이내 저장
- Critical Value 알림 3초 이내 전송

---

## UC05: 영상검사 (Radiology Information System - RIS)

### Story 8: 영상검사 오더 생성

**As a** 의사,
**I want to** 환자에게 X-ray, CT, MRI 검사를 오더하고,
**So that** 방사선사가 촬영을 진행할 수 있다.

#### Acceptance Criteria (AC):
- [ ] **AC1**: 검사 종류 선택 (X-ray, CT, MRI, Ultrasound)
- [ ] **AC2**: 촬영 부위 선택 (예: Chest PA, Brain CT, Abdomen MRI)
- [ ] **AC3**: 조영제 사용 여부 체크
- [ ] **AC4**: 임상 정보 입력 (검사 목적, 의심 진단명)
- [ ] **AC5**: RIS 오더 번호 자동 생성 (형식: `RIS-YYYYMMDD-XXXX`)

#### Business Rules:
- 조영제 사용 시 환자 알러지 이력 자동 체크
- 임산부 X-ray 촬영 시 경고 메시지

---

### Story 9: DICOM 이미지 조회 (OHIF Viewer)

**As a** 의사,
**I want to** DICOM 뷰어로 환자의 CT/MRI 이미지를 조회하고,
**So that** 병변을 확인하고 진단을 내릴 수 있다.

#### Acceptance Criteria (AC):
- [ ] **AC1**: OHIF Viewer 통합 (버전 3.8.0 이상)
- [ ] **AC2**: DICOM 이미지 로딩 10초 이내
- [ ] **AC3**: 기본 도구 제공 (Window/Level, Zoom, Pan, Measurement)
- [ ] **AC4**: MPR (Multi-Planar Reconstruction) 지원
- [ ] **AC5**: 이미지 다운로드 (JPEG/PNG 변환)

#### Performance Requirements:
- DICOM 이미지 로딩: 평균 5초, 최대 10초
- Viewport 전환: 200ms 이내

---

## UC06: AI 모델 추론 (AI Inference)

### Story 10: 뇌출혈 AI 분석 요청

**As a** 의사,
**I want to** CT 이미지를 AI 모델로 분석하여 뇌출혈 여부를 판정하고,
**So that** 응급 상황에서 빠른 진단 결정을 내릴 수 있다.

#### Acceptance Criteria (AC):
- [ ] **AC1**: DICOM 이미지 업로드 (Drag & Drop 지원)
- [ ] **AC2**: AI 추론 시작 후 30초 이내 결과 반환
- [ ] **AC3**: 뇌출혈 분류 (정상, 경막하출혈, 경막외출혈, 지주막하출혈 등)
- [ ] **AC4**: 신뢰도 점수 표시 (0-100%, 80% 이상 시 "높음")
- [ ] **AC5**: Heat Map 오버레이 (병변 위치 시각화)

#### Business Rules:
- AI 결과는 참고용이며 최종 진단은 의사 책임
- 신뢰도 50% 미만 시 "재검토 필요" 경고

---

### Story 11: AI 추론 이력 조회

**As a** 관리자,
**I want to** AI 모델의 추론 이력과 성능 지표를 조회하고,
**So that** 모델 정확도를 모니터링하고 개선점을 파악할 수 있다.

#### Acceptance Criteria (AC):
- [ ] **AC1**: 추론 이력 테이블 (환자 ID, 추론 시간, 결과, 신뢰도)
- [ ] **AC2**: 일별/월별 추론 건수 통계
- [ ] **AC3**: 평균 신뢰도 그래프
- [ ] **AC4**: 오진 사례 필터링 (의사 피드백 반영)
- [ ] **AC5**: CSV 다운로드

---

## UC07: 진료 기록 (Patient Record)

### Story 12: SOAP Note 작성

**As a** 의사,
**I want to** SOAP 형식으로 진료 기록을 작성하고,
**So that** 표준화된 포맷으로 환자 상태를 문서화할 수 있다.

#### Acceptance Criteria (AC):
- [ ] **AC1**: SOAP 섹션 분리 (Subjective, Objective, Assessment, Plan)
- [ ] **AC2**: 템플릿 지원 (내과, 외과, 소아과 등 진료과별)
- [ ] **AC3**: 자동 저장 (30초마다)
- [ ] **AC4**: ICD-10 진단 코드 자동 완성
- [ ] **AC5**: 진료 기록 전자서명

#### Business Rules:
- 진료 기록은 24시간 이내 작성 필수 (규정 준수)
- 수정 시 이전 버전 자동 보관 (Audit Trail)

---

### Story 13: 타임라인 조회

**As a** 의사,
**I want to** 환자의 모든 의료 기록을 시간 순서로 조회하고,
**So that** 진료 흐름을 한눈에 파악할 수 있다.

#### Acceptance Criteria (AC):
- [ ] **AC1**: 타임라인 뷰 (최신순, 과거순 정렬)
- [ ] **AC2**: 이벤트 유형별 아이콘 (진료, 처방, 검사, 영상)
- [ ] **AC3**: 날짜 필터링 (오늘, 1주일, 1개월, 3개월, 전체)
- [ ] **AC4**: 이벤트 클릭 시 상세 내용 팝업
- [ ] **AC5**: 무한 스크롤 (Lazy Loading)

---

## UC08: 대시보드 (Dashboard)

### Story 14: 역할별 대시보드

**As a** 의사,
**I want to** 나의 오늘 진료 환자 목록과 대기 중인 검사 결과를 확인하고,
**So that** 우선순위를 정하고 효율적으로 업무를 처리할 수 있다.

#### Acceptance Criteria (AC):
- [ ] **AC1**: 오늘 진료 환자 수 (위젯)
- [ ] **AC2**: 대기 중인 검사 결과 알림 (빨간 뱃지)
- [ ] **AC3**: STAT 오더 긴급 알림 (상단 고정)
- [ ] **AC4**: 최근 5건 진료 기록 바로가기
- [ ] **AC5**: 위젯 재배치 (Drag & Drop)

#### Business Rules:
- 대시보드는 역할별로 자동 구성 (doctor, nurse, rib, lab 각각 다름)

---

### Story 15: 통계 위젯

**As a** 관리자,
**I want to** 일별 환자 방문 수, 검사 건수, 처방 건수를 차트로 확인하고,
**So that** 병원 운영 현황을 한눈에 파악할 수 있다.

#### Acceptance Criteria (AC):
- [ ] **AC1**: 일별 환자 방문 수 (Line Chart)
- [ ] **AC2**: 검사 종류별 건수 (Pie Chart)
- [ ] **AC3**: 진료과별 처방 건수 (Bar Chart)
- [ ] **AC4**: 기간 선택 (최근 7일, 30일, 90일)
- [ ] **AC5**: 차트 데이터 CSV 다운로드

---

## UC09: 외부 연동 (External Integration)

### Story 16: OpenEMR 환자 동기화

**As a** 시스템 관리자,
**I want to** OpenEMR에서 환자 정보를 자동으로 동기화하고,
**So that** 두 시스템 간 데이터 불일치를 방지할 수 있다.

#### Acceptance Criteria (AC):
- [ ] **AC1**: 30분마다 자동 동기화 (Celery Beat)
- [ ] **AC2**: 신규 환자 자동 가져오기
- [ ] **AC3**: 환자 정보 업데이트 (연락처, 주소 변경 시)
- [ ] **AC4**: 동기화 실패 시 슬랙 알림
- [ ] **AC5**: 동기화 이력 로그 (성공/실패 건수)

---

### Story 17: Orthanc PACS 이미지 조회

**As a** 방사선사,
**I want to** Orthanc PACS에서 DICOM 이미지를 검색하고,
**So that** NeuroNova RIS에서 바로 이미지를 조회할 수 있다.

#### Acceptance Criteria (AC):
- [ ] **AC1**: DICOMweb API 연동 (QIDO-RS, WADO-RS)
- [ ] **AC2**: Study 목록 검색 (환자 이름, Study Date)
- [ ] **AC3**: 썸네일 미리보기 (JPEG 변환)
- [ ] **AC4**: OHIF Viewer로 바로 열기 버튼
- [ ] **AC5**: 이미지 다운로드 (ZIP 압축)

---

## 📊 Performance Requirements (NFR)

### 응답 시간
- API 평균 응답 시간: **200ms 이하**
- API 최대 응답 시간: **1000ms 이하**
- DICOM 이미지 로딩: **10초 이하**
- AI 추론: **30초 이하**

### 동시 사용자
- 최소 동시 사용자: **100명**
- 목표 동시 사용자: **500명**

### 가용성
- 목표 Uptime: **99% 이상** (연간 다운타임 3.65일 이하)
- 일일 백업: **매일 오전 3시**
- RPO (Recovery Point Objective): **24시간**
- RTO (Recovery Time Objective): **4시간**

---

## 📝 작성 이력

- **2025-12-31**: 초안 작성 (UC02-UC09 사용자 스토리 정의)
- **버전**: 1.0

---

**작성**: Claude AI
**검토 필요**: 각 Use Case별 Acceptance Criteria 검증 필요
