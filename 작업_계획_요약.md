# NeuroNova CDSS 작업 계획 요약

**작성일**: 2025-12-30
**현재 상태**: Phase 2 완료, 백엔드 코드 복구 완료
**다음 작업**: 데이터 사전 업로드 (프롬.md 지시사항)

---

## 🎯 현재 상황

### ✅ 완료된 작업
- Phase 2 완료 (테스트 전략, 로깅 전략, 성능 최적화 문서화)
- 전체 UC01-UC09 구현
- GCP 배포 가이드 완성
- React 테스트 클라이언트 구현
- 문서 재구성 (50개 → 44개)
- 코드 정적 분석 완료 ([38_코드_정적_분석_보고서.md](01_doc/38_코드_정적_분석_보고서.md))

### 📁 백엔드 복구 완료
```
NeuroNova_02_back_end/
├── 01_ai_core/          ✅
├── 02_django_server/    ✅ (acct, emr, ocs, lis, ris, ai, fhir, audit)
├── 05_orthanc_pacs/     ✅
├── 06_hapi_fhir/        ✅
└── 07_redis/            ✅
```

---

## 🚀 작업 계획

### Phase 1: 즉시 작업 (1-2일) ⭐⭐⭐

#### 작업 1: 마스터 데이터 시딩 (최우선)

**목표**: 진단/약물/검사 마스터 데이터 업로드

**작업 내용**:
1. 데이터 수집
   - ICD-10 진단 코드 100개
   - 약물 코드 200개
   - 검사 항목 50개

2. CSV/JSON 파일 생성
   ```
   NeuroNova_02_back_end/02_django_server/data/
   ├── diagnosis_master.json
   ├── medication_master.json
   └── lab_test_master.json
   ```

3. Management Command 작성
   ```bash
   python manage.py seed_master_data
   ```

**예상 소요**: 4-6시간 (데이터 수집 포함)

**관련 문서**: [16_데이터_시딩_가이드.md](01_doc/16_데이터_시딩_가이드.md)

---

#### 작업 2: Foreign Key 마이그레이션 준비

**목표**: CharField user_id → ForeignKey 전환 준비

**영향 범위**:
- `emr.Encounter.doctor_id`
- `emr.Order.ordered_by`
- `emr.Order.executed_by`

**작업 단계**:
1. 백업 생성
2. 마이그레이션 스크립트 작성
3. Dry-run 검증
4. 적용 (서버 가동 후)

**예상 소요**: 2-4시간

---

#### 작업 3: 환경 변수 검증 로직 추가

**목표**: 필수 환경 변수 누락 방지

**작업 내용**:
```python
# settings.py
def require_env(key, default=None):
    value = os.getenv(key, default)
    if value is None:
        raise EnvironmentError(f"Required environment variable '{key}' not set")
    return value

SECRET_KEY = require_env('DJANGO_SECRET_KEY')
```

**예상 소요**: 1-2시간

---

### Phase 2: 우선 작업 (3-5일) ⭐⭐

#### 작업 4: N+1 쿼리 제거

**목표**: ViewSet 쿼리 최적화

**적용 대상**:
- `emr.viewsets` (Encounter, Order)
- `ris.views` (RadiologyStudy)
- `ai.views` (AIJob)

**방법**:
```python
def get_queryset(self):
    return Encounter.objects.select_related('patient').all()
```

**예상 소요**: 2-3시간

---

#### 작업 5: 인덱스 최적화

**목표**: 자주 조회되는 필드 인덱스 추가

**추가 대상**:
- `PatientCache.ssn`
- `Order.status` + `order_type` (복합)
- `AIJob.status` + `created_at` (복합)

**예상 소요**: 2-3시간

---

#### 작업 6: Serializer 검증 강화

**목표**: 입력 데이터 검증 로직 보강

**작업 내용**:
- 전화번호 형식 검증
- 이메일 형식 검증
- 주민등록번호 체크섬 검증

**예상 소요**: 2-3시간

---

### Phase 3: 개선 작업 (1주일) ⭐

#### 작업 7: 로깅 체계 고도화
#### 작업 8: 테스트 커버리지 향상
#### 작업 9: 문서 업데이트

---

## 📋 체크리스트

### 서버 불필요 (즉시 가능) ✅

- [x] 코드 정적 분석 완료
- [x] 마스터 데이터 CSV/JSON 파일 준비
  - [x] medication_master.json (30개)
  - [x] lab_test_master.json (50개)
  - [x] 진단 데이터 (100개 ICD-10) 기존 존재
- [x] Management Command 스크립트 작성 (`seed_master_data.py`)
- [x] 환경 변수 검증 로직 추가 (`require_env()` 함수)
- [x] `.env.example` 업데이트
- [x] 공통 검증 유틸리티 생성 (`utils/validators.py`)
- [x] EMR Serializer 리팩토링 (공통 validators 사용)
- [ ] Foreign Key 마이그레이션 스크립트 작성 (dry-run) - 다음 작업

### 서버 필요 🔄

- [ ] 마스터 데이터 시딩 실행
- [ ] Django Debug Toolbar 설치 및 쿼리 분석
- [ ] 마이그레이션 적용
- [ ] 성능 벤치마크 테스트

---

## 🎯 우선순위

1. **마스터 데이터 시딩** (프롬.md 지시) ← 최우선
2. 환경 변수 검증
3. Foreign Key 마이그레이션
4. 성능 최적화 (N+1 쿼리)
5. 테스트 커버리지

---

## 📊 예상 일정

| Phase | 작업 | 예상 기간 | 서버 필요 |
|-------|------|-----------|----------|
| 1 | 마스터 데이터 시딩 | 4-6시간 | ❌ → ✅ |
| 1 | FK 마이그레이션 준비 | 2-4시간 | ❌ |
| 1 | 환경 변수 검증 | 1-2시간 | ❌ |
| 2 | N+1 쿼리 제거 | 2-3시간 | ✅ |
| 2 | 인덱스 최적화 | 2-3시간 | ✅ |
| 2 | Serializer 검증 | 2-3시간 | ❌ → ✅ |
| **총계** | | **약 2주** | |

---

## 📝 다음 작업

**즉시 완료 (2025-12-30 23:50)** ✅:
1. ~~마스터 데이터 CSV/JSON 파일 준비~~ ✅
2. ~~Management Command 스크립트 작성~~ ✅
3. ~~환경 변수 검증 로직 추가~~ ✅
4. ~~공통 검증 유틸리티 생성~~ ✅

**원본 PC 복귀 후 (우선순위 순)**:
1. **마스터 데이터 시딩 실행** ⭐⭐⭐
   ```bash
   python manage.py seed_master_data
   ```
2. **Django 서버 기동 및 환경 변수 검증 확인**
3. **N+1 쿼리 분석** (Django Debug Toolbar 설치)
4. **Foreign Key 마이그레이션 스크립트 작성** (dry-run)
5. 인덱스 최적화 적용
6. 성능 벤치마크 테스트

---

## 📖 관련 문서

- [38_코드_정적_분석_보고서.md](01_doc/38_코드_정적_분석_보고서.md) - 상세 분석 결과
- [16_데이터_시딩_가이드.md](01_doc/16_데이터_시딩_가이드.md) - 데이터 업로드 가이드
- [27_데이터_검증_정책.md](01_doc/27_데이터_검증_정책.md) - 검증 정책
- [30_성능_최적화_가이드.md](01_doc/30_성능_최적화_가이드.md) - 성능 최적화
- [LOG_작업이력.md](01_doc/LOG_작업이력.md) - 전체 작업 기록

---

**작성**: Claude AI
**최종 업데이트**: 2025-12-30
