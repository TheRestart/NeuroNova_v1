@startuml
' File: uc4_lis.puml
left to right direction

actor Doctor as d
actor Nurse as n
actor LabTech as lt
' actor "EMR/LIS/FHIR" as ext  ' 외부 시스템 액터는 제거

rectangle "Django CDSS\n(UC4: LIS-lite)" {

  ' 입력/저장
  usecase "UC4-1-1 결과 Raw 수신" as UC411
  usecase "UC4-1-2 결과 Parsing/Normalize" as UC412
  usecase "UC4-1-3 검사 결과 저장" as UC413
  usecase "UC4-1-4 검사 결과 목록 조회" as UC414
  usecase "UC4-1-5 검사 결과 상세 조회" as UC415

  ' 해석
  usecase "UC4-2-1 기준치 로딩" as UC421
  usecase "UC4-2-2 비정상 판단" as UC422
  usecase "UC4-2-3 Critical 판단" as UC423
  usecase "UC4-2-4 Interpretation 생성" as UC424

  ' Alert
  usecase "UC4-3-1 Abnormal Alert 트리거" as UC431
  usecase "UC4-3-2 Critical Alert 트리거" as UC432

  ' FHIR/Timeline 연계
  usecase "UC4-4-1 FHIR Observation 매핑" as UC441
  usecase "UC4-4-2 FHIR Observation 전송" as UC442
  usecase "UC4-4-3 검사결과 Timeline 이벤트 생성" as UC443
}

' 결과 입력 (LabTech가 UI에서 입력/업로드)
lt --> UC411

UC411 ..> UC412 : <<include>>
UC412 ..> UC413 : <<include>>

' 해석 파이프라인 (내부 UC)
UC413 ..> UC421 : <<include>>
UC421 ..> UC422 : <<include>>
UC422 ..> UC423 : <<include>>
UC423 ..> UC424 : <<include>>

' Alert 트리거 (내부 로직)
UC431 ..> UC422 : <<include>>
UC432 ..> UC423 : <<include>>

' 조회 (사용자 UC)
d --> UC414
d --> UC415
n --> UC414
n --> UC415

' FHIR/Timeline 연계 (내부 UC)
UC441 ..> UC413 : <<include>>
UC442 ..> UC441 : <<include>>
UC443 ..> UC413 : <<include>>

' 외부 EMR/LIS/FHIR는 데이터 연동 대상 시스템으로만 설명
note right of UC441
  External Systems: EMR / LIS / FHIR
  - Django CDSS가 결과를 FHIR Observation으로 매핑 및 전송
  - 외부 시스템이 UC를 직접 트리거하지 않으므로
    Usecase Actor로는 표현하지 않음
end note

@enduml